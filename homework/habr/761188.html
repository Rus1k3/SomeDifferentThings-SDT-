<!DOCTYPE html>
<html lang="ru" data-vue-meta="%7B%22lang%22:%7B%22ssr%22:%22ru%22%7D%7D">
<head >
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,maximum-scale=1,user-scalable=0">
  <meta name="referrer" content="unsafe-url">
  <title>P2P-форум с нуля | от NAT hole punching до автономной и полностью децентрализованной сети / Хабр</title>
  <style>
    /* cyrillic-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSxf6TF0.woff2) format('woff2');
      unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F;
    }

    /* cyrillic */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveQhf6TF0.woff2) format('woff2');
      unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116;
    }

    /* latin-ext */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveSBf6TF0.woff2) format('woff2');
      unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF;
    }

    /* latin */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/s/firasans/v11/va9B4kDNxMZdWfMOD5VnZKveRhf6.woff2) format('woff2');
      unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD;
    }

    /* non-breaking hyphen */
    @font-face {
      font-family: 'Fira Sans';
      font-style: normal;
      font-weight: 500;
      font-display: swap;
      src: url(https://fonts.gstatic.com/l/font?kit=KFOlCnqEu92Fr1MmEU9vBh0_IsHAlmrO6g&skey=ee881451c540fdec&v=v29) format('woff2');
      unicode-range: U+02011;
    }
  </style>
  <link rel="preload" href="https://assets.habr.com/habr-web/css/chunk-vendors.0da14ebf.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/chunk-vendors.62e21544.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/css/app.04c2974e.css" as="style"><link rel="preload" href="https://assets.habr.com/habr-web/js/app.5e6fa0f9.js" as="script"><link rel="preload" href="https://assets.habr.com/habr-web/js/7298.c8f1d73c.js" as="script">
  <link rel="stylesheet" href="https://assets.habr.com/habr-web/css/chunk-vendors.0da14ebf.css"><link rel="stylesheet" href="https://assets.habr.com/habr-web/css/app.04c2974e.css">
  <script>window.i18nFetch = new Promise((res, rej) => {
          const xhr = new XMLHttpRequest();
          xhr.open('GET', '/js/i18n/ru-compiled.7af0b043442455352b71a8d77759e80f.json');
          xhr.responseType = 'json';
          xhr.onload = function(e) {
            if (this.status === 200) {
              res({ru: xhr.response});
            } else {
              rej(e);
            }
          };
          xhr.send();
        });</script>
  
  <script data-vue-meta="ssr" type="application/ld+json" data-vmid="ldjson-schema">{"@context":"http:\/\/schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/habr.com\/ru\/companies\/ruvds\/articles\/761188\/"},"headline":"P2P-форум с нуля | от NAT hole punching до автономной и полностью децентрализованной сети","datePublished":"2023-10-02T12:00:01+03:00","dateModified":"2023-10-02T12:51:29+03:00","author":{"@type":"Person","name":"Andрeй ✅"},"publisher":{"@type":"Organization","name":"Habr","logo":{"@type":"ImageObject","url":"https:\/\/habrastorage.org\/webt\/a_\/lk\/9m\/a_lk9mjkccjox-zccjrpfolmkmq.png"}},"description":"Многие, кто работают с интернет-сокетами в любой сфере IT, задаются вопросом о&nbsp;пробросе портов. Связано это с тем, что практически во всех домашних\/общественных...","url":"https:\/\/habr.com\/ru\/companies\/ruvds\/articles\/761188\/#post-content-body","about":["c_ruvds","h_p2p","h_programming","h_network_technologies","h_network_hardware","f_develop","f_admin","f_popsci"],"image":["https:\/\/habr.com\/share\/publication\/761188\/dc2014b9191dc9141dbe0746a3b4e114\/","https:\/\/habrastorage.org\/webt\/go\/c6\/fb\/goc6fbxehf6l6rs6ihvnw5mmzy8.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/9d0\/5cc\/d7f\/9d05ccd7f8d094bf11c465bce5a31c35.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/dfb\/6e2\/dcb\/dfb6e2dcbbbf0da859fb48c9b207ec44.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/7dc\/221\/10e\/7dc22110e3b7ebd066822f89721ff616.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/dcc\/d20\/948\/dccd209484c3a3ae8cc4dad708bb284d.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/926\/fd0\/9a6\/926fd09a660ca1bacfa93c7b3f18ca00.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/6e1\/e0e\/813\/6e1e0e81328a8ae4818cd8ffd87f7134.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/d54\/ab6\/e9c\/d54ab6e9cb36f45ca8feb98bef4b8a46.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/94e\/048\/8e7\/94e0488e73dada360316e8d4639f297e.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/5ac\/41b\/ec1\/5ac41bec16497fec1fbdd48eb7815187.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/034\/2a4\/6bc\/0342a46bc10d56745bbd8979638b4e41.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/003\/2f6\/928\/0032f69289df30917cefdc741fe8b91f.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/24d\/eb3\/40a\/24deb340a3da19493ffb7f1bc2c190c9.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/942\/0a9\/523\/9420a9523c27131aee2e44139fd1ed72.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/777\/2d7\/da5\/7772d7da5edb6388ed7466c9144d9a7e.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/4d6\/f44\/447\/4d6f44447b16e024d7add7900069dd32.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/8f3\/d87\/cd3\/8f3d87cd3448914b0fe1bc232931e52a.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/cb6\/ea4\/a58\/cb6ea4a58a041c66dd75dc5df69b28b8.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/e8f\/2ab\/8f8\/e8f2ab8f83c296c115c701bf42c98bfd.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/652\/378\/ce0\/652378ce0bcb57e6476dc824207cd350.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/922\/16e\/40e\/92216e40e0a374f5f03e7fcae5566758.png","https:\/\/habrastorage.org\/r\/w1560\/getpro\/habr\/upload_files\/3ce\/f5c\/428\/3cef5c428a7ab78d8c22732fc9438a70.jpg","https:\/\/habrastorage.org\/webt\/ru\/hh\/ob\/ruhhobvxnh2haqrwru6ejkipwcs.png","https:\/\/habrastorage.org\/webt\/tp\/sk\/z-\/tpskz-7w7a8e74isoowuep40xeg.png"]}</script>
  <style>.grecaptcha-badge{visibility: hidden;}</style>
  <meta name="habr-version" content="2.144.0">
  
  <meta data-vue-meta="ssr" property="fb:app_id" content="444736788986613"><meta data-vue-meta="ssr" property="fb:pages" content="472597926099084"><meta data-vue-meta="ssr" name="twitter:card" content="summary_large_image"><meta data-vue-meta="ssr" name="twitter:site" content="@habr_com"><meta data-vue-meta="ssr" property="og:site_name" content="Хабр" data-vmid="og:site_name"><meta data-vue-meta="ssr" property="og:title" content="P2P-форум с нуля | от NAT hole punching до автономной и полностью децентрализованной сети" data-vmid="og:title"><meta data-vue-meta="ssr" name="twitter:title" content="P2P-форум с нуля | от NAT hole punching до автономной и полностью децентрализованной сети" data-vmid="twitter:title"><meta data-vue-meta="ssr" name="aiturec:title" content="P2P-форум с нуля | от NAT hole punching до автономной и полностью децентрализованной сети" data-vmid="aiturec:title"><meta data-vue-meta="ssr" name="description" content="Многие, кто работают с интернет-сокетами в любой сфере IT, задаются вопросом о  пробросе портов . Связано это с тем, что практически во всех домашних/общественных/корпоративных роутерах реализован..." data-vmid="description"><meta data-vue-meta="ssr" itemprop="description" content="Многие, кто работают с интернет-сокетами в любой сфере IT, задаются вопросом о  пробросе портов . Связано это с тем, что практически во всех домашних/общественных/корпоративных роутерах реализован..." data-vmid="description:itemprop"><meta data-vue-meta="ssr" property="og:description" content="Многие, кто работают с интернет-сокетами в любой сфере IT, задаются вопросом о  пробросе портов . Связано это с тем, что практически во всех домашних/общественных/корпоративных роутерах реализован..." data-vmid="og:description"><meta data-vue-meta="ssr" name="twitter:description" content="Многие, кто работают с интернет-сокетами в любой сфере IT, задаются вопросом о  пробросе портов . Связано это с тем, что практически во всех домашних/общественных/корпоративных роутерах реализован..." data-vmid="twitter:description"><meta data-vue-meta="ssr" property="aiturec:description" content="Многие, кто работают с интернет-сокетами в любой сфере IT, задаются вопросом о  пробросе портов . Связано это с тем, что практически во всех домашних/общественных/корпоративных роутерах реализован..." data-vmid="aiturec:description"><meta data-vue-meta="ssr" itemprop="image" content="https://habrastorage.org/webt/lu/3o/fx/lu3ofxdzbsu1jqvgd0ojccnstdg.png" data-vmid="image:itemprop"><meta data-vue-meta="ssr" property="og:image" content="https://habrastorage.org/webt/lu/3o/fx/lu3ofxdzbsu1jqvgd0ojccnstdg.png" data-vmid="og:image"><meta data-vue-meta="ssr" property="og:image:width" content="1200" data-vmid="og:image:width"><meta data-vue-meta="ssr" property="og:image:height" content="630" data-vmid="og:image:height"><meta data-vue-meta="ssr" property="aiturec:image" content="https://habrastorage.org/webt/lu/3o/fx/lu3ofxdzbsu1jqvgd0ojccnstdg.png" data-vmid="aiturec:image"><meta data-vue-meta="ssr" name="twitter:image" content="https://habrastorage.org/webt/lu/3o/fx/lu3ofxdzbsu1jqvgd0ojccnstdg.png" data-vmid="twitter:image"><meta data-vue-meta="ssr" property="vk:image" content="https://habrastorage.org/webt/lu/3o/fx/lu3ofxdzbsu1jqvgd0ojccnstdg.png?format=vk" data-vmid="vk:image"><meta data-vue-meta="ssr" property="aiturec:item_id" content="761188" data-vmid="aiturec:item_id"><meta data-vue-meta="ssr" property="aiturec:datetime" content="2023-10-02T09:00:01.000Z" data-vmid="aiturec:datetime"><meta data-vue-meta="ssr" content="https://habr.com/ru/companies/ruvds/articles/761188/" property="og:url" data-vmid="og:url"><meta data-vue-meta="ssr" property="og:type" content="article" data-vmid="og:type"><meta data-vue-meta="ssr" property="og:locale" content="ru_RU" data-vmid="og:locale"><meta data-vue-meta="ssr" name="keywords" content="ruvds_статьи, python, ip, p2p-сети, overlay, network, peer-to-peer, nat, mikrotik, socket, holepunch">
  <link data-vue-meta="ssr" href="https://habr.com/ru/rss/publications/761188/?fl=ru" type="application/rss+xml" title="" rel="alternate" name="rss"><link data-vue-meta="ssr" href="https://habr.com/ru/companies/ruvds/articles/761188/" rel="canonical" data-vmid="canonical"><link data-vue-meta="ssr" rel="image_src" href="https://habrastorage.org/webt/lu/3o/fx/lu3ofxdzbsu1jqvgd0ojccnstdg.png" data-vmid="image:href">
  <meta name="apple-mobile-web-app-status-bar-style" content="#303b44">
  <meta name="msapplication-TileColor" content="#629FBC">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="16x16"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-16.png"
  >
  <link
    rel="shortcut icon"
    type="image/png"
    sizes="32x32"
    href="https://assets.habr.com/habr-web/img/favicons/favicon-32.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="76x76"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-76.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="120x120"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="152x152"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-152.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="180x180"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-180.png"
  >
  <link
    rel="apple-touch-icon"
    type="image/png"
    sizes="256x256"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-256.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1136x640.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2436x1125.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1792x828.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_828x1792.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1334x750.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2208x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1125x2436.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1242x2208.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2732x2048.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2688x1242.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2224x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_750x1334.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x2732.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2388x1668.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2224.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_640x1136.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1668x2388.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_2048x1536.png"
  >
  <link
    rel="apple-touch-startup-image"
    media="screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)"
    href="https://assets.habr.com/habr-web/img/splashes/splash_1536x2048.png"
  >
  <link
    rel="mask-icon"
    color="#77a2b6"
    href="https://assets.habr.com/habr-web/img/favicons/apple-touch-icon-120.svg"
  >
  <link
    crossorigin="use-credentials"
    href="/manifest.webmanifest"
    rel="manifest"
  >
  <script async src="https://unpkg.com/pwacompat" crossorigin="anonymous"></script>
  <script>window.yaContextCb = window.yaContextCb || []</script>
  <script src="https://yandex.ru/ads/system/context.js" async></script>
</head>
<body>


<div id="app" data-server-rendered="true" data-async-called="true"><div class="tm-layout__wrapper"><!----> <div></div> <div class="tm-feature tm-feature"><!----></div> <header class="tm-header"><div class="tm-page-width"><div class="tm-header__container"><div class="tm-header__burger-nav"><button type="button" class="tm-header__button tm-header__button_burger"><svg height="16" width="16" class="tm-svg-img tm-header__icon tm-header__icon-burger"><title>Меню</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#header-burger"></use></svg></button></div> <span class="tm-header__logo-wrap"><a href="/ru/" class="tm-header__logo tm-header__logo_ru"><svg height="16" width="16" class="tm-svg-img tm-header__icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a> <span class="tm-header__beta-sign" style="display:none;">β</span></span> <!----> <div class="tm-header-user-menu tm-header_user-menu"><a href="/ru/search/" class="tm-header-user-menu__item tm-header-user-menu__search"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_search"><title>Поиск</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#search"></use></svg></a> <!----> <!----> <!----> <div class="tm-header-user-menu__item"><button data-test-id="menu-toggle-guest" class="tm-header-user-menu__toggle"><svg height="24" width="24" class="tm-svg-img tm-header-user-menu__icon tm-header-user-menu__icon_white"><title>Профиль</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#header-user"></use></svg></button> <!----></div> <DIV class="v-portal" style="display:none;"></DIV></div></div></div></header> <div class="tm-layout"><div class="tm-page-progress-bar"></div> <!----> <!----> <div class="tm-page-width"></div> <main class="tm-layout__container"><div hl="ru" companyName="ruvds" data-async-called="true" class="tm-page"><div class="tm-page-width"><div class="tm-page__header"><div class="tm-company-card__branding tm-company-article__branding tm-company-card__branding_loading"><div class="tm-company-card__branding-placeholder"><!----></div> <a href="https://ruvds.com/ru/windows/?utm_source=habr&amp;utm_medium=banner&amp;utm_campaign=promo&amp;utm_content=link&amp;?erid=LjN8KAR3S"><img src="//habrastorage.org/getpro/habr/branding/0fd/0cd/3f6/0fd0cd3f63dac0cb6ac8359cac986779.jpg" width="100%" class="tm-company-card__branding-image"></a></div></div> <div class="tm-page__wrapper"><div class="tm-page__main tm-page__main_has-sidebar"><div class="pull-down"><!----> <div class="pull-down__header" style="height:0px;"><div class="pull-down__content" style="bottom:10px;"><svg height="24" width="24" class="tm-svg-img pull-down__icon pull-down__arrow"><title>Обновить</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#pull-arrow"></use></svg></div></div> <div class="tm-article-presenter"> <div class="tm-article-presenter__body"><div class="tm-misprint-area"><div class="tm-misprint-area__wrapper"><article class="tm-article-presenter__content tm-article-presenter__content_narrow"><div class="tm-article-presenter__header"> <div class="tm-article-snippet tm-article-presenter__snippet tm-article-snippet"><div class="tm-article-snippet__meta-container"><div class="tm-article-snippet__meta"><span class="tm-user-info tm-article-snippet__author"><a href="/ru/users/CodeDroidX/" title="CodeDroidX" class="tm-user-info__userpic"><div class="tm-entity-image"><img alt height="32" src="//habrastorage.org/r/w64/getpro/habr/avatars/b3e/776/b95/b3e776b954216ebac21f19d4a1623889.png" width="32" class="tm-entity-image__pic"></div></a> <span class="tm-user-info__user tm-user-info__user_appearance-default"><a href="/ru/users/CodeDroidX/" class="tm-user-info__username">
      CodeDroidX
      <!----></a> <span class="tm-article-datetime-published"><time datetime="2023-10-02T09:00:01.000Z" title="2023-10-02, 12:00">2  окт   в 12:00</time></span></span></span></div> <!----></div> <h1 lang="ru" class="tm-title tm-title_h1"><span>P2P-форум с нуля | от NAT hole punching до автономной и полностью децентрализованной сети</span></h1> <div class="tm-article-snippet__stats"><div class="tm-article-complexity tm-article-complexity_complexity-medium"><span class="tm-svg-icon__wrapper tm-article-complexity__icon"><svg height="24" width="24" class="tm-svg-img tm-svg-icon"><title>Уровень сложности</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#complexity-medium"></use></svg></span> <span class="tm-article-complexity__label">
    Средний
  </span></div> <div class="tm-article-reading-time"><span class="tm-svg-icon__wrapper tm-article-reading-time__icon"><svg height="24" width="24" class="tm-svg-img tm-svg-icon"><title>Время на прочтение</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#clock"></use></svg></span> <span class="tm-article-reading-time__label">
    32 мин
  </span></div> <span class="tm-icon-counter tm-data-icons__item"><svg height="24" width="24" class="tm-svg-img tm-icon-counter__icon"><title>Количество просмотров</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#counter-views"></use></svg> <span class="tm-icon-counter__value">6.1K</span></span></div> <div class="tm-publication-hubs__container"><div class="tm-publication-hubs"><span class="tm-publication-hub__link-container"><a href="/ru/companies/ruvds/articles/" class="router-link-active tm-publication-hub__link"><span>Блог компании RUVDS.com</span> <!----></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/p2p/" class="tm-publication-hub__link"><span>Децентрализованные сети</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/programming/" class="tm-publication-hub__link"><span>Программирование</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/network_technologies/" class="tm-publication-hub__link"><span>Сетевые технологии</span> <span title="Профильный хаб" class="tm-article-snippet__profiled-hub">*</span></a></span><span class="tm-publication-hub__link-container"><a href="/ru/hubs/network_hardware/" class="tm-publication-hub__link"><span>Сетевое оборудование</span> <!----></a></span></div></div> <div class="tm-article-snippet__labels-container"><div class="tm-article-snippet__labels"><div class="tm-publication-label tm-publication-label_variant-tutorial"><span>
    Туториал
  </span></div> </div></div> <!----> <!----></div></div> <!----> <div data-gallery-root="" lang="ru" class="tm-article-body"><div></div> <div id="post-content-body"><div><div class="article-formatted-body article-formatted-body article-formatted-body_version-1"><div xmlns="http://www.w3.org/1999/xhtml"><a href="https://habr.com/ru/companies/ruvds/articles/761188/"><div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/webt/go/c6/fb/goc6fbxehf6l6rs6ihvnw5mmzy8.png" data-src="https://habrastorage.org/webt/go/c6/fb/goc6fbxehf6l6rs6ihvnw5mmzy8.png"/></div></a><br/>
Многие, кто работают с интернет-сокетами в любой сфере IT, задаются вопросом о <i>пробросе портов</i>. Связано это с тем, что практически во всех домашних/общественных/корпоративных роутерах реализован механизм <a href="https://ru.wikipedia.org/wiki/NAT">NAT</a>, который перекрывает прямой доступ к устройствам в этих подсетях извне, общаясь с внешним интернетом от их имени.<br/>
<br/>
У NAT есть киллер-фича — он представляет собой идеальный <i><a href="https://ru.wikipedia.org/wiki/%D0%9C%D0%B5%D0%B6%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B9_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD">фаервол</a></i>: атаки извне не могут использовать порты локальных устройств напрямую, следовательно, это решает проблему <a href="https://ru.wikipedia.org/wiki/%D0%A3%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D1%8B%D0%B5_%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D0%B5_%D0%B0%D1%82%D0%B0%D0%BA%D0%B8">атак на сетевую уязвимость ОС</a>.<br/>
<br/>
Но, это доставляет и неудобства, например, если ты захочешь подключиться или хотя бы увидеть устройство <i>за NAT</i> в благих целях, то ты чисто теоретически не сможешь это сделать — <i>у него относительно тебя нет IP-адреса.</i><br/>
<br/>
Разнообразные сервисы работают на серверах, т. е. имеют некую ноду, которая имеет белый адрес в интернете (находится не за NAT). Все пользователи же подключаются к этому единому серверу. В таком случае проблема «невидимости» пользователей отпадает. Однако чисто серверное взаимодействие ограничивает скорость участников, так ещё и не отказоустойчиво. Если сервер упадёт, то все клиенты отправятся за ним (считаем, что это одноклеточный сервис не на всяких там kubernetes).<br/>
<br/>
Как вы уже могли были догадаться, даже в реалиях, когда практически все устройства находятся за NATами, <strong><font color="#3AC1EF">P2P реален</font></strong>. Когда вы являетесь участником bittorrent-раздачи, трансфер больших данных осуществляется напрямую. Как это работает? Поиск ответа на этот вопрос завёл меня в глубокие дебри, разгребая которые я написал оверлейную <a href="https://ru.wikipedia.org/wiki/%D0%9E%D0%B4%D0%BD%D0%BE%D1%80%D0%B0%D0%BD%D0%B3%D0%BE%D0%B2%D0%B0%D1%8F_%D1%81%D0%B5%D1%82%D1%8C">p2p-сеть</a>, где <a href="https://ru.wikipedia.org/wiki/BitTorrent-%D1%82%D1%80%D0%B5%D0%BA%D0%B5%D1%80">трекерами</a> являются сами её участники. Интересно? Тогда добро пожаловать под кат.<a name="habracut"></a><br/>
<br/>
Есть концепт, использующийся во многих готовых решениях, называющийся <strong><font color="#3AC1EF">NAT hole punching</font></strong>. Он позволяет общаться двум устройствам, находящимся за NATами, зная лишь внешние адреса NAT друг друга. Но ведь за одним преобразователем может быть огромное количество устройств — как же тогда это возможно?<br/>
<br/>
<h2><font color="#3AC1EF">Дисклеймер</font></h2><br/>
В дальнейшем я буду намеренно оперировать немного искажёнными понятиями для простоты восприятия их человеком совершенно незнакомым с <a href="https://ru.wikipedia.org/wiki/%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D0%B0%D1%8F_%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C_OSI">сетевой моделью OSI</a>, транспортными протоколами и их особенностями.<br/>
<br/>
К моему удивлению, простым поиском я не нашел практически никаких исчерпывающих статей или готовых скриптов, которые бы объясняли hole punching, тем более в ru сегменте. Если же вы любите зрить в корень вопроса или считаете себя уже достаточно опытным в сетевых технологиях, могу посоветовать <a href="https://bford.info/pub/net/p2pnat/">этот материал (en)</a> — на него опирался и я сам, когда изучал данный вопрос. Если вас действительно заинтересует этот стек после прочтения моей статьи и данного материала, то могу предложить ещё и эту весьма грамотную статью: <a href="https://tailscale.com/blog/how-nat-traversal-works/">How NAT traversal works</a>.<br/>
<br/>
<blockquote>P.S. Если же вы не уверены в своем техническом английском, то представляю вам <a href="https://habr.com/ru/articles/763164/">этот перевод</a>, который я предложил написать своему более умелому в технической адаптации языка другу.</blockquote><br/>
Эта статья, в свою очередь, призвана доказать, что с практической точки зрения с NAT hole punching всё не так запутано и сложно, как может показаться при поиске информации на эту тему.<br/>
Будет реализован алгоритм работы P2P сети для неограниченного количества участников, которая позволит им общаться в формате форума.<br/>
<br/>
Статья получилась немного перегруженной вложенностями (спойлерами). В противном случае это был бы отвратительный моно-лонгрид, кои я всей душой осуждаю. Теперь вы знаете, на что идёте. Удачи!<br/>
<br/>
<h2><font color="#3AC1EF">Оглавление</font></h2><br/>
<ul>
<li><a href="#KNR">Как NAT работает</a><br/>
<ul>
<li><a href="#UPNP">Кто такой UPnP и почему он мёртв</a></li>
</ul><br/>
</li>
<li><a href="#HOLE">Пробиваем дыры в NAT</a><br/>
<ul>
<li><a href="#PNCH">Есть пробитие!</a></li>
<li><a href="#STUN">Зачем нам нужен STUN?</a></li>
</ul><br/>
</li>
<li><a href="#PRJC">Проектируем сеть</a></li>
<li><a href="#FUNC">Продумываем логику</a></li>
<li><a href="#PYTH">Реализуем</a><br/>
<ul>
<li><a href="#TOOL">Пишем необходимые инструменты</a></li>
<li><a href="#PROT">Реализуем протоколы взаимодействия в нашей сети</a></li>
<li><a href="#UI">Визуализация дерева и UI</a></li>
</ul><br/>
</li>
<li><a href="#TEST">Тестируем</a><br/>
<ul>
<li><a href="#CONC">Подводим итоги</a></li>
</ul><br/>
</li>
</ul><a name="KNR"></a><div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/9d0/5cc/d7f/9d05ccd7f8d094bf11c465bce5a31c35.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/9d0/5cc/d7f/9d05ccd7f8d094bf11c465bce5a31c35.png"/></div><br/>
<h2><font color="#3AC1EF">Матчасть NAT</font></h2><br/>
<i>Если вы не нуждаетесь в подобном и подробном объяснении, листайте сразу до следующего заголовка.</i><br/>
<br/>
<strong><font color="#3AC1EF">NAT</font></strong> (от <a href="https://ru.wikipedia.org/wiki/%D0%90%D0%BD%D0%B3%D0%BB%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D1%8F%D0%B7%D1%8B%D0%BA">англ.</a> Network Address Translation — «преобразование сетевых адресов») — это механизм в <a href="https://ru.wikipedia.org/wiki/%D0%9A%D0%BE%D0%BC%D0%BF%D1%8C%D1%8E%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%8F_%D1%81%D0%B5%D1%82%D1%8C">сетях</a> <a href="https://ru.wikipedia.org/wiki/%D0%A1%D1%82%D0%B5%D0%BA_%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%BE%D0%B2_TCP/IP">TCP/IP</a>, позволяющий преобразовывать <a href="https://ru.wikipedia.org/wiki/IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81">IP-адреса</a> транзитных <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%B0%D0%BA%D0%B5%D1%82_(%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D0%B5_%D1%82%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D0%B8)">пакетов</a>.<br/>
<br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/dfb/6e2/dcb/dfb6e2dcbbbf0da859fb48c9b207ec44.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/dfb/6e2/dcb/dfb6e2dcbbbf0da859fb48c9b207ec44.png"/></div><br/>
Простыми словами — NAT это такая программа в твоем роутере, которая позволяет тебе, будучи в его подсети, общаться с внешним миром <strong><font color="#3AC1EF">от имени роутера.</font></strong> Так как у роутера <strong><font color="#3AC1EF">есть внешний адрес</font></strong>, уникальный для интернета, а <strong><font color="#3AC1EF">у тебя его нет</font></strong>.<br/>
<br/>
Так выглядит твой обычный запрос до DNS Google:<br/>
<br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/7dc/221/10e/7dc22110e3b7ebd066822f89721ff616.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/7dc/221/10e/7dc22110e3b7ebd066822f89721ff616.png"/></div><br/>
Однако пообщаться так с компьютером друга, находящимся за своим NAT, не выйдет. Его роутер просто не может знать, кому ты адресовал пакет в его подсети, следовательно, и передавать он его никому не станет. Само собой, это можно исправить. Друг может «<i>пробросить порт</i>» на своем роутере. Он зайдёт на веб-майку роутера по адресу, например <code>192.168.0.1</code>, и потыкает там кнопки по гайду для какой-нибудь игры. Это создаст для его NAT новое <strong><font color="#3AC1EF">правило</font></strong> о соединении конкретного порта («логической дырки») снаружи роутера с портом конкретного компьютера за ним.<br/>
<br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/dcc/d20/948/dccd209484c3a3ae8cc4dad708bb284d.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/dcc/d20/948/dccd209484c3a3ae8cc4dad708bb284d.png"/></div><br/>
Увы, это не всегда возможно. Наш условный друг может быть в кафе/общаге/на работе (не иметь административного доступа к настройкам роутера). Для этого был придуман <a href="https://ru.wikipedia.org/wiki/UPnP"><strong>UPnP</strong></a>.<a name="UPNP"></a><br/>
<br/>
<a href="https://ru.wikipedia.org/wiki/UPnP"><strong>UPnP</strong></a>-пакет — специальный запрос к роутеру, который просит его пробросить порт самостоятельно. Однако роутер должен ожидать такой запрос и быть правильно настроен. Но технология эта не прижилась в массах. Постоянно включенный UPnP на роутере даёт пользователям возможность сделать сеть уязвимой, так что он отключен по умолчанию практически на всех маршрутизаторах с завода -> он не является универсальным решением.<br/>
<br/>
<blockquote>Скорее всего, UPnP отключен на вашем роутере, что не мешает работать торрент-клиентам.</blockquote><br/>
<img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/926/fd0/9a6/926fd09a660ca1bacfa93c7b3f18ca00.png" align="left" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/926/fd0/9a6/926fd09a660ca1bacfa93c7b3f18ca00.png"/>Для решения этой задачи нужно присмотреться к самому NAT.<br/>
Вот, он замаскировал твой пакет под пакет твоего роутера и отправил его наружу, верно?<br/>
<br/>
Но когда ты делаешь запрос к Google (пару иллюстраций назад), твой компьютер ведь получает ответ от него — значит NAT может работать и в обратную сторону?<br/>
<br/>
Дело в том, что NAT оставляет лазейку для получения ответа.<br/>
<br/>
<blockquote>Лазейкой или дыркой я далее буду называть сессию NAT для примитивности объяснения.</blockquote><br/>
<img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/6e1/e0e/813/6e1e0e81328a8ae4818cd8ffd87f7134.png" align="left" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/6e1/e0e/813/6e1e0e81328a8ae4818cd8ffd87f7134.png"/>По сути это временный проброс порта до твоего компьютера, однако с ограничением: проброс сработает только для пакетов, отправленных с того же адреса, на который был отправлен твой пакет-инициатор проброса.<br/>
<br/>
Другими словами, в нашем примере пробросом может пользоваться только Google, для которого ты сам по сути открыл эту дыру, отправив ему исходящий пакет.<br/>
<br/>
Это и есть сессия NAT. На самом деле, много описанное мной здесь будет актуально для большинства существующих на данный момент спецификаций трансляции, но исключения всё же имеются. Вдаваться в подробности я не стану, скажу лишь, что описанный далее способ будет точно актуален для большинства провайдеров (и даже операторов мобильной связи!).<br/>
<br/>
<blockquote>Кстати, NAT может быть в подсети другого NAT и подобная вложенность может содержать сколь угодно уровней (см. <a href="https://en.m.wikipedia.org/wiki/Carrier-grade_NAT">CG-NAT</a>).<br/>
<br/>
Однако это тоже не должно стать проблемой для описанного далее метода.</blockquote><br/>
<a name="HOLE"></a><div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/d54/ab6/e9c/d54ab6e9cb36f45ca8feb98bef4b8a46.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/d54/ab6/e9c/d54ab6e9cb36f45ca8feb98bef4b8a46.png"/></div><br/>
<h2><font color="#3AC1EF">Пробиваем дыры в NAT</font></h2><br/>
В нашем примере Google имел статичный белый адрес с заранее проброшенным портом. Но как заставить таким образом соединиться два устройства за NATами?<br/>
<br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/94e/048/8e7/94e0488e73dada360316e8d4639f297e.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/94e/048/8e7/94e0488e73dada360316e8d4639f297e.png"/></div><br/>
<br/>
Попробуем что-то сделать, основываясь на имеющихся у нас данных…<br/>
<br/>
<ol>
<li>Ты отправляешь пакет на белый адрес роутера друга, он транслируется NAT и исходит из порта на твоем роутере №X (ты его не знаешь!).<br/>
</li>
<li><strong><font color="#3AC1EF">Пакет разбивается о железный файрвол роутера друга снаружи.</font></strong></li>
<li>Туннель временно поднят на твоём внешнем порту X, но его номер никто не знает.<br/>
</li>
</ol><br/>
Ситуация кажется тупиковой, но есть ещё одна интересная способность сессии, созданной в NAT — если сейчас сессия настроена, например, на приём от google.com во внешний порт роутера X, то ты можешь послать изнутри пакет, используя <i>эту же сессию</i> на другой адрес (допустим, <code>123.123.123.123</code>). Сессия изменит настройки и станет принимать пакеты от него, при этом приходить они будут всё ещё в старый порт на локальном компьютере.<br/>
<a name="PNCH"></a><br/>
Представим себе некий адрес <code>1.2.3.4</code>, видимый из интернета, и готовый принимать подключения.<br/>
<br/>
<ol>
<li>Ты отправляешь пакет на <code>1.2.3.4</code>, создавая тем самым сессию, открытую на внешнем порту X.<br/>
</li>
<li>1.2.3.4 видит твой внешний порт X, когда принимает пакет (друг не видел, ведь пакет не дошёл).<br/>
</li>
<li>Владелец <code>1.2.3.4</code> неким образом сообщает тебе твой внешний порт данной сессии X.<br/>
</li>
<li>Ты отправляешь пакет на адрес друга, используя тот же локальный порт на ПК, что и для пакета к <code>1.2.3.4</code>. Это заставляет пакет идти через уже имеющуюся сессию NAT.<br/>
</li>
<li>Твоя сессия NAT теперь будет принимать пакеты не от <code>1.2.3.4</code>, а от твоего друга.<br/>
</li>
<li><strong><font color="#3AC1EF">Пакет разбивается о железный файрвол роутера друга снаружи.</font></strong></li>
<li>Кажется, что всё как в прошлой попытке, однако сейчас мы знаем X за счёт помощи от <code>1.2.3.4</code>,<br/>
</li>
<li>Друг делает эти же шаги, но уже обращаясь к нашему адресу в порт X, который будет открыт вместе с сессией NAT ещё несколько секунд и настроен на приём пакетов от друга (в шаге 5).<br/>
</li>
<li><strong><font color="#3AC1EF">Пакет друга доходит до нашего локального компьютера!</font></strong></li>
<li>Мы видим внешний порт друга Y (аналогично X) в заголовке полученного пакета и теперь можем общаться в обе стороны сквозь трансляторы. Победа!<br/>
</li>
</ol><br/>
<a name="STUN"></a>Осталось найти готового к благим делам <code>1.2.3.4</code>, и, удивительно, он существует. И зовут этих добряков <strong><font color="#3AC1EF">STUN</font></strong>-серверами.<br/>
<br/>
<a href="https://ru.wikipedia.org/wiki/STUN"><strong>STUN-сервер</strong></a> - это сервер, который отвечает на все входящие пакеты адресом и портом X, из которого они были отправлены. Это позволяет определить свой внешний <a href="https://ru.wikipedia.org/wiki/IP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81">IP-адрес</a> и внешний порт X своей сессии NAT.<br/>
<br/>
Их есть великое множество в открытом доступе, и составить запрос к любому из них не составляет проблемы — это мы ещё реализуем. Тут можно найти актуальный список открытых url, на которых подняты STUN: <a href="https://gist.github.com/mondain/b0ec1cf5f60ae726202e">https://gist.github.com/mondain/b0ec1cf5f60ae726202e</a>.<br/>
<br/>
Мы будем использовать <a href="http://stun.ekiga.net/">stun.ekiga.net</a>, но чуть позже.<br/>
<br/>
<blockquote>Мой скромный гайд по данной технологии на этом подходит к концу — далее идёт проектирование и написание конкретного кейса. <a name="PRJC"></a>Повторюсь, что если вы осознали вышесказанное без особых проблем или просто хотите знать больше нюансов, то вам <a href="https://habr.com/ru/articles/763164/">сюда</a>.</blockquote><br/>
<h2><font color="#3AC1EF">Топология сети</font></h2><br/>
Наша <a href="https://ru.wikipedia.org/wiki/%D0%9E%D0%B2%D0%B5%D1%80%D0%BB%D0%B5%D0%B9%D0%BD%D0%B0%D1%8F_%D1%81%D0%B5%D1%82%D1%8C">оверлейная сеть</a> будет представлять из себя неограниченное количество нод, соединённых друг с другом посредством udp-туннелей, созданных между их NAT.<br/>
<br/>
Сеть <b><font color="#3AC1EF">НЕ</font></b> будет анонимной, так как сторонний наблюдатель может <i>отследить первоисточник</i> сообщения, если, конечно, наблюдал за сетью достаточно долго.<br/>
<br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Однако идея схожа с задачей на базе очередей</b>
                        <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/5ac/41b/ec1/5ac41bec16497fec1fbdd48eb7815187.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/5ac/41b/ec1/5ac41bec16497fec1fbdd48eb7815187.png"/></div><br/>
<br/>
Если вкратце, мы моментально обрабатываем всё, что приходит нам, но отправляем сообщения только раз в некоторый период T. Если отправлять по одному сообщению сразу всем (пусть даже с мусором), и так будут делать все участники сети, то факт и момент передачи чего-либо не будет известен стороннему наблюдателю.<br/>
<br/>
<blockquote><strong>Мусорный (ложный) трафик</strong> является неотъемлемой частью теоретически доказуемых анонимных сетей.</blockquote><br/>
<br/>
Оригинал: <a href="https://habr.com/ru/articles/753902/">https://habr.com/ru/articles/753902/</a>.<br/>
</div>
                    </div><br/>
Таким образом, наша сеть могла бы быть анонимной, если бы каждая нода, помимо полезного трафика слала ещё и мусор всем, но я, пожалуй, откажусь от данной условности в угоду разгрузки канала, но и <i>не стану называть сеть анонимной</i>.<a name="FUNC"></a><br/>
<br/>
<h2><font color="#3AC1EF">Маршрутизация</font></h2><br/>
Для полной автономности и децентрализованности сети я не стану использовать выделенные серверы, трекеры и т. д. Изначальная идея такова, что все участники равноправны, и никакое третье лицо с белым адресом им не нужно (кроме STUN).<br/>
<br/>
Предположим, что есть две ноды <strong><font color="#3AC1EF">(I)</font></strong> и <strong><font color="#3AC1EF">(II)</font></strong>, они обмениваются информацией, в том числе списками своих подключений. В это же время активна некая нода<strong><font color="#3AC1EF"> (III)</font></strong>, которая оказалась подключённой к <strong><font color="#3AC1EF">(I)<br/>
</font></strong>. Нода <strong><font color="#3AC1EF">(II) </font></strong>узнала от<strong><font color="#3AC1EF"> (I), </font></strong>что есть некая<strong><font color="#3AC1EF"> (III).</font></strong> Стабилизация сети будет происходить при помощи взаимной маршрутизации. Дальнейшие действия можно описать простой схемой.<br/>
<br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/034/2a4/6bc/0342a46bc10d56745bbd8979638b4e41.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/034/2a4/6bc/0342a46bc10d56745bbd8979638b4e41.png"/></div><br/>
<ul>
<li>0. Пассивный обмен информацией и списками подключений — будет иллюстрирован позже.<br/>
</li>
<li>1. <b><font color="#3AC1EF">(II)</font></b> отправляет запрос на установление соединения к <b><font color="#3AC1EF">(III)</font></b>, но не может это сделать напрямую, и просит об этом <strong><font color="#3AC1EF">(I)</font></strong>.</li>
<li>2. <b><font color="#3AC1EF">(I)</font></b> перенаправляет этот запрос.</li>
<li>3. <strong><font color="#3AC1EF">(III)</font></strong> получает запрос и инициализирует HOLE PUNCH к <strong><font color="#3AC1EF">(II)</font></strong>, однако пробрасывается новый случайный порт и его пока не знает <strong><font color="#3AC1EF">(II)</font></strong>, зато сам <strong><font color="#3AC1EF">(III)</font></strong> узнал его от STUN.</li>
<li>4. <strong><font color="#3AC1EF">(III) </font></strong>отправляет ответ на запрос <strong><font color="#3AC1EF">(II)</font></strong> с актуальным PUNCHED-портом, перенаправляя его через <strong><font color="#3AC1EF">(I)</font></strong>.</li>
<li>5. <strong><font color="#3AC1EF">(I)</font></strong> перенаправляет этот ответ.</li>
<li>6. <strong><font color="#3AC1EF">(II)</font></strong> получает ответ и инициализирует HOLE PUNCH к <strong><font color="#3AC1EF">(III) </font></strong>на известный порт, полученный в ответе, таким образом, порты взаимно проброшены.</li>
<li>7. Теперь <strong><font color="#3AC1EF">(III)</font></strong> имеет полноправное соединение с <strong><font color="#3AC1EF">(II)</font></strong>, и начинается пассивный обмен информацией, как в шаге<strong><font color="#3AC1EF"> 0</font></strong>.</li>
</ul><br/>
<blockquote>Есть правда один нюанс — к такой сети невозможно легко присоединиться извне. Вся она основана на взаимных подключениях. Следовательно, если ты хочешь войти в сеть, ты должен найти кого-то, кто уже в ней состоит, и в ручном режиме соединиться с ним (по взаимному согласию). Далее всё сработает автоматически по схеме, приведённой выше.</blockquote><br/>
<h3><font color="#3AC1EF">Что мы имеем?</font></h3><br/>
Мы получили теоретически рабочую оверлейную сеть, где устройства могут общаться друг с другом без каких-либо препятствий, как если бы они находились в одной LAN (за исключением свободы выбора порта).<br/>
<br/>
Принцип обмена сообщениями<br/>
<br/>
<ul>
<li>Каждое сообщение является обычной строкой.<br/>
</li>
<li>Каждое сообщение имеет известный и однозначный <a href="https://ru.wikipedia.org/wiki/%D0%A5%D0%B5%D1%88-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F">хеш</a>.<br/>
</li>
<li>Reply на чужое сообщение осуществляется по его хешу.<br/>
<ul>
<li>Получается некое подобие <a href="https://habr.com/ru/articles/127864/">LinkedList </a>или <a href="https://ru.wikipedia.org/wiki/%D0%91%D0%BB%D0%BE%D0%BA%D1%87%D0%B5%D0%B9%D0%BD">блокчейна</a>.<br/>
</li>
</ul><br/>
</li>
<li>Весь форум — это один большой python <a href="https://python-scripts.com/sets">set (aka множество)</a>:<br/>
<ul>
<li>Двух одинаковых сообщений быть не может.<br/>
</li>
<li>Каждый участник синхронизирует свое множество с чужими.<br/>
</li>
</ul><br/>
</li>
<li>Структуру форума можно визуализировать как дерево, где узлы это сообщения.<br/>
<ul>
<li>Отвечая на чужое сообщение, ты создаешь новую ветку от него.<br/>
</li>
<li>Продолжая цепочку ответов, ты удлиняешь одну из веток.<br/>
</li>
</ul><br/>
</li>
</ul>Поскольку каждый участник хранит у себя свою версию содержимого форума, им нужно как-то договариваться об истинной версии. Но, тут всё просто: <i>истинная версия</i> набора сообщений — это <i>та, которая больше</i>. Другими словами, если у кого-то из твоих соседей имеются сообщения, которых нет у тебя, то ты должен их скачать и дописать себе.<br/>
<br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/003/2f6/928/0032f69289df30917cefdc741fe8b91f.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/003/2f6/928/0032f69289df30917cefdc741fe8b91f.png"/></div><i><font color="#999999">Примерная схема синхронизации данных</font></i><br/>
<br/>
<ul>
<li>Каждый участник хранит сет сообщений и информацию о существующих сессиях.<br/>
</li>
</ul><br/>
Подбираясь к реализации, скажу, что можно просто <i>суммировать свой сет сообщений с чужим</i>.<br/>
<br/>
Не забываем, что сессия NAT умрёт, если через неё несколько минут не будут передаваться данные, так что нужна будет пассивная отправка Keep Alive-пакетов.<br/>
<br/>
На этом можно закончить планирование и перейти к написанию <a href="https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%BA%D0%BE%D0%BD%D1%86%D0%B5%D0%BF%D1%86%D0%B8%D0%B8">Proof of Concept</a>-инструментов на Python для подтверждения теории практикой.<br/>
<br/>
<div style="text-align:center;"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/24d/eb3/40a/24deb340a3da19493ffb7f1bc2c190c9.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/24d/eb3/40a/24deb340a3da19493ffb7f1bc2c190c9.png"/></div><a name="PYTH"></a><br/>
<h2><font color="#3AC1EF">Реализация на Python</font></h2><br/>
Заранее прошу прощения у всех, кто читает с телефона. Весь код проекта вышел достаточно массивным, так что я не смогу комментировать каждую строку отдельно. Будут приводиться логически разделённые куски, которые будет не очень удобно анализировать целиком через маленькое окошко фрейма с кодом по центру вашего небольшого экрана.<br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Импорт библиотек, логгер и небольшие формальности</b>
                        <div class="spoiler_text"><pre><code class="python">from pathlib import Path
import time
import os
import sys


def cls():
    os.system("cls" if os.name == "nt" else "clear")


try:
    scriptname = Path(__file__).name
except:
    scriptname = "CnC.py"
try:
    verfrom = time.ctime(os.path.getmtime(__file__))
except:
    verfrom = "!No time!"


import threading
import socket
import random
import hashlib
import json
import logging
import pdb


class Debug(pdb.Pdb):
    def __init__(self, *args, **kwargs):
        super(Debug, self).__init__(*args, **kwargs)
        self.prompt = "CnC Debug Shell >>> "

    def shell(self):
        self.set_trace()


debug = Debug()
# logging.warn(f"Event logging is enabled. You can see it in {scriptname}.log")
logging.basicConfig(
    format="%(asctime)s %(message)s", level=logging.DEBUG, filename=f"{scriptname}.log"
)
logging.info("Hello world!")
logging.getLogger().setLevel(logging.DEBUG)</code></pre><br/>
</div>
                    </div><a name="TOOL"></a><br/>
Теперь нужно подготовить простые функции для упрощения дальнейшей жизни:<br/>
<br/>
<pre><code class="python">def dat_to_bytes(diction: dict) -> bytes:
    return json.dumps(diction).encode("cp866")


def bytes_to_dat(byte: bytes) -> dict:
    return json.loads(byte.decode("cp866"))


def checksum(b):
    return hashlib.blake2s(b, digest_size=4).hexdigest()


_alreadyused = set()


def randomport():
    global _alreadyused
    p = random.randint(16000, 65535)
    while p in _alreadyused:
        p = random.randint(16000, 65535)
    _alreadyused.update({p})
    return p</code></pre><br/>
Первые две превращают словарь в байты, и обратно.<br/>
<br/>
Далее идёт взятие хэша и функция, дающая каждый раз уникальный порт.<br/>
<br/>
Функция STUN() принимает локальный порт как обязательный аргумент и отправляет из него STUN request на сервер <a href="http://stun.ekiga.net/">stun.ekiga.net</a>.<br/>
<br/>
Запрос представляет из себя фиксированную последовательность байт, так что я не вдаваясь в подробности дампнул его из <a href="https://www.wireshark.org">Wireshark</a>.<br/>
<br/>
Возвращает функция тот самый порт X из начала статьи.<br/>
<br/>
<pre><code class="python">def STUN(port, host="stun.ekiga.net"):
    logging.debug(f"STUN request via {host}")
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.bind(("0.0.0.0", port))
    sock.setblocking(0)
    server = socket.gethostbyname(host)
    work = True
    while work:
        sock.sendto(
            b"\x00\x01\x00\x00!\x12\xa4B\xd6\x85y\xb8\x11\x030\x06xi\xdfB",
            (server, 3478),
        )
        for i in range(20):
            try:
                ans, addr = sock.recvfrom(2048)
                work = False
                break
            except:
                time.sleep(0.01)

    sock.close()
    return socket.inet_ntoa(ans[28:32]), int.from_bytes(ans[26:28], byteorder="big")</code></pre><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Пара вспомогательных функций для кодировки ip:port в одно число</b>
                        <div class="spoiler_text"><pre><code class="python">def addr2int(ip, port: int):
    binport = bin(port)[2:].rjust(16, "0")
    binip = "".join([bin(int(i))[2:].rjust(8, "0") for i in ip.split(".")])
    return int(binip + binport, 2)


def int2addr(num):
    num = bin(num)[2:].rjust(48, "0")
    print(num)
    num = [
        str(int(i, 2))
        for i in [num[0:8], num[8:16], num[16:24], num[24:32], num[32:48]]
    ]
    return ".".join(num[0:4]), int(num[4])</code></pre><br/>
</div>
                    </div><br/>
Dump и Load будут сохранять/загружать текущий чекпоинт сети:<br/>
<br/>
<pre><code class="python">def data_dump():
    with open(f"{scriptname}.chat-savefile.json", "w") as f:
        json.dump(data, f)


def data_load():
    global data
    try:
        with open(f"{scriptname}.chat-savefile.json", "r") as f:
            data = json.load(f)
    except:
        logging.error(f"No save file exists! New one created")
        with open(f"{scriptname}.chat-savefile.json", "w") as f:
            json.dump({}, f)</code></pre><br/>
<h3><font color="#3AC1EF">▍ Основной код ноды</font></h3><br/>
Класс, описывающий поведение сессии с другой нодой:<br/>
<br/>
<pre><code class="python">class Session:
    def __init__(self):
        # self.prefix="IDL"
        self.immortal = False
        self.local_port = randomport()
        for i in range(10):
            self.public_ip, self.public_port = STUN(self.local_port)
        self.socket = None
        self.client = None
        self.thread = None
        logging.info(f'"{self.public_ip}",{self.public_port}')

    def make_connection(self, ip, port, timeout=10):
        logging.debug(f"Start waiting for handshake with {ip}:{port}")
        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        sock.bind(("0.0.0.0", self.local_port))
        sock.setblocking(0)
        while True:
            sock.sendto(b"Con. Request!", (ip, port))
            time.sleep(2)
            try:
                ans, addr = sock.recvfrom(9999)
                sock.sendto(b"Con. Request!", (ip, port))
                sock.close()
                sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
                sock.bind(("0.0.0.0", self.local_port))
                sock.setblocking(0)
                self.client = (ip, port)
                self.socket = sock
                logging.debug(f"Hole with {self.client} punched!")
                break
            except Exception as e:
                assert timeout > 0
                timeout -= 1
                logging.debug(f"No handshake with {ip}:{port} yet...")</code></pre><br/>
Из важного — тут происходит стабилизация туннеля в NAT. Вам может резать глаза строка <code>for i in range(10): self.public_ip, self.public_port = STUN(self.local_port)</code>, которая повторяет запрос к STUN 10 РАЗ. Это является вынужденным костылём для увеличения срока жизни NAT-сессии, ведь зачастую роутеры создают её с небольшим временем жизни (порядка 10 секунд) и вы с «другом» можете просто не успеть синхронизировать подключения. При этом таймаут до смерти сессии растёт при прохождении через неё пакетов, для этого, собственно, и нужен спам STUN-запросами. <a name="PROT"></a><br/>
<br/>
<h3><font color="#3AC1EF">▍ Протоколы</font></h3><br/>
Дальше случится очень много кода — это реализация описанных в первой части статьи механизмов взаимодействия между клиентами.<br/>
<br/>
Введу такое понятие, как «протокол». Определяться он будет первыми 3 байтами UDP-пакета и определять, с какой целью оно было нам отправлено.<br/>
<br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Реализация протоколов</b>
                        <div class="spoiler_text"><blockquote><b>Внимание</b>: <i>Впереди может быть очень длинный if-elif-else, который можно было бы заменить на match или замутить нечто высокоуровневое, масштабируемое и абстрактное. Как вы уже могли догадаться, автор не стал этого делать...</i></blockquote><br/>
Описываем цикл жизни ноды:<br/>
<br/>
<pre><code class="python">def backlife_cycle(self, freq=1):
    global sessions
    if self.immortal:
        logging.warning(f"{self.client} session beacame immortal")
        self.life_cycle = aegis(self.life_cycle)
    th = threading.Thread(target=self.life_cycle, args=(freq,))
    th.start()
    self.thread = th
    logging.warning(f"Session with {self.client} stabilized!")
    # sessions.append(self)

def life_cycle(self, freq=1):
    global data
    global sessions
    global pool
    c = 0
    while 1:
        if len(pool):
            pref = pool.pop(0)
        else:
            pref = b"KPL"

        self.socket.sendto(pref, self.client)  # Keep-alive
        time.sleep(max(random.gauss(1 / freq, 3), 0))

        while True:
            try:
                ans, reply_addr = self.socket.recvfrom(9999)
                logging.debug(
                    f"{self.client[0]}: Recieved {ans[:3].decode('cp866')} from {reply_addr}: {ans}"
                )
            except:
                break
</code></pre><br/>
Каждая итерация её жизненного цикла отправляет KPL (Keep Alive) пакет. Теперь опишем поведение при получении KPL-пакета.<br/>
<br/>
На каждый из них нам реагировать, само собой, не стоит.<br/>
<br/>
<ul>
<li>Раз в 10 полученных KPL мы будем запрашивать синхронизацию датасетов. </li>
<li>Раз в 33 полученных KPL мы будем запрашивать синхронизацию подключений.</li>
</ul><br/>
<pre><code class="python">if ans[:3] == b"KPL":
    c += 1
    if c % 10 == 0:
        logging.debug(
            f"{self.client[0]}: Requesting Datagram     {c//10}"
        )
        self.socket.sendto(b"RQD", self.client)
        c += 1
    elif c % 33 == 0:
        logging.debug(
            f"{self.client[0]}: Requesting Session List {c//33}"
        )
        self.socket.sendto(b"RQS", self.client)
        c += 1
</code></pre><br/>
Поротоколы, необходимые для частичной синхронизации при помощи сравнения хешей.<br/>
По умолчанию я их не использовал, так как мои тесты не заходили дальше 4 устройств и десятка сообщений. Не могу быть уверен, что они отказоустойчивы, так что пока они отключены.<br/>
<br/>
<pre><code class="python">
# ----------------------------------------Hashes (keys) sync (disabled now)----------------------------------------
elif ans[:3] == b"RQH":
    logging.debug(f"{self.client[0]}: Sending hashes")
    self.socket.sendto(
        b"HAS" + dat_to_bytes(list(data.keys())), self.client
    )

elif ans[:3] == b"HAS":
    missed_messages.update(
        set(bytes_to_dat(ans[3:])) - set(data.keys())
    )
</code></pre><br/>
Непосредственно протоколы синхронизации сообщений:<br/>
<br/>
<pre><code class="python"># ----------------------------------------Data sync----------------------------------------
elif ans[:3] == b"RQD":
    if ans[3:] != b"":
        logging.debug(f"{self.client[0]}: Sending specific datagram")
        n = {}
        r = set(bytes_to_dat(ans[3:]))
        for i in r:
            if i in data:
                n.update({i: data[i]})
        logging.debug(f"{self.client[0]}: Sending {n}")
        self.socket.sendto(b"DAT" + dat_to_bytes(n), self.client)
    else:
        logging.debug(f"{self.client[0]}: Sending datagram")
        self.socket.sendto(b"DAT" + dat_to_bytes(data), self.client)

elif ans[:3] == b"DAT":
    data.update(bytes_to_dat(ans[3:]))
</code></pre><br/>
Обмен списками подключений и подключение к ещё одному случайному участнику, с которым у нас пока нет сессии:<br/>
<br/>
<pre><code class="python"># ----------------------------------------IP list sync-------------------------------------
elif ans[:3] == b"RQS":
    logging.debug(f"{self.client[0]}: Sending Session List")
    sess = [i.client[0] if i.client else None for i in sessions]
    sess = set(sess)
    sess = sess - {None}
    sess = list(sess)
    sess.remove(self.client[0])
    self.socket.sendto(b"SES" + dat_to_bytes(sess), self.client)

elif ans[:3] == b"SES":
    sess = [i.client[0] if i.client else None for i in sessions]
    sess = set(sess)
    sess = sess - {None}
    logging.debug(
        f"{self.client[0]}: My sessions: {sess} Recieved: {set(bytes_to_dat(ans[3:]))} New: {list(set(bytes_to_dat(ans[3:]))-sess)}"
    )
    uncon = list(set(bytes_to_dat(ans[3:])) - sess)
    if not uncon:
        continue
    adr = random.choice(uncon)
    s = Session()
    sessions.append(s)
    self.socket.sendto(
        b"HOP"
        + socket.inet_aton(adr)
        + b"CON"
        + s.public_ip.encode("cp866")
        + b":"
        + str(s.public_port).encode("cp866"),
        self.client,
    )
</code></pre><br/>
Для маршрутизации внутри сети я использую протокол, который назвал HOP. Он предпологает, что каждый готов послужить ретранслятором для другого.<br/>
<br/>
Допустим, есть пакет <b>X</b>, в котором есть заголовок (id протокола) и данные. <br/>
Мы хотим его отправить на <code>2.2.2.2</code>, но не имеем с ним сессии. Для этого мы узнаём, кто же с ним эту самую сессию имеет (допустим <code>3.3.3.3</code>). Мы отправляем к <code>3.3.3.3</code> пакет с таким содержанием: <code>HOP+2.2.2.2+X</code>.<br/>
<br/>
Описываем принцип работы HOP:<br/>
<pre><code class="python"># ----------------------------------------HOP Tracking-------------------------------------
elif ans[:3] == b"HOP":
    sess = [i.client[0] if i.client else None for i in sessions]

    ip = socket.inet_ntoa(ans[3:7])
    if ip in sess:
        s = sessions[sess.index(ip)]
        s.socket.sendto(ans[7:], s.client)

elif ans[:3] == b"CON":
    s = Session()
    adr, prt = ans[3:].decode("cp866").split(":")
    self.socket.sendto(
        b"HOP"
        + socket.inet_aton(adr)
        + b"RDY"
        + prt.encode("cp866")
        + b":"
        + s.public_ip.encode("cp866")
        + b":"
        + str(s.public_port).encode("cp866"),
        self.client,
    )
    try:
        s.make_connection(adr, int(prt))
        s.backlife_cycle(1)
        sessions.append(s)
    except:
        logging.error(f"{self.client[0]}: Connect initiation timeout!")

elif ans[:3] == b"RDY":
    myprt, adr, prt = ans[3:].decode("cp866").split(":")
    sess = [i.public_port for i in sessions]

    if int(myprt) in sess:
        s = sessions[sess.index(int(myprt))]
        try:
            s.make_connection(adr, int(prt))
            s.backlife_cycle(1)
        except:
            logging.error(
                f"{self.client[0]}: Connect stabilization timeout!"
            )
            sessions.remove(s)
</code></pre><br/>
Последний блок кода — отключенный механизм трекинга, который я писал до того, как придумал HOP. Извиняюсь за то, что вы его тут видите)<br/>
<br/>
<pre><code class="python"># ----------------------------------------Disabled Trash-----------------------------------
elif ans[:3] == b"TRK":
    adr, prt = ans[3:].decode("cp866").split(",")
    sess = [i.client[0] for i in sessions]
    sess.remove(self.client[0])
    s = sessions[sess.index(adr)]

    s.socket.sendto(
        b"CN0"
        + f"{self.client[0].encode('cp866')}:{prt.encode('cp866')}",
        s.client,
    )

elif ans[:3] == b"CN0":
    s = Session()
    self.socket.sendto(
        b"CN1"
        + f"{s.public_ip.encode('cp866')}:{str(s.public_port).encode('cp866')}",
        self.client,
    )
    adr, prt = ans[3:].decode("cp866").split(":")
    s.make_connection(adr, int(prt))
    sessions.append(s)
elif ans[:3] == b"TRK":
    pass
</code></pre><br/>
Закрываем врата в ад из бесконечного <b>elif</b>, обрабатывая любой мусор, который мы можем случайно получить при помощи <b>else</b>.<br/>
<br/>
<pre><code class="python">else:
    logging.warning(f"{self.client[0]}: Malformed! !!!{ans}!!!")
</code></pre></div>
                    </div><br/>
<i>В сухом остатке:</i> в этом сниппете обрабатываются протоколы взаимодействия, такие как:<br/>
<ol>
<li><b><font color="#3AC1EF">KPL </font></b> — Keep Alive<br/>
</li>
<li><b><font color="#3AC1EF">RQH </font></b> — Request hashes<br/>
</li>
<li><b><font color="#3AC1EF">HAS </font></b> — Пакет с хэшами<br/>
</li>
<li><b><font color="#3AC1EF">RQD </font></b> — Request dataset<br/>
</li>
<li><b><font color="#3AC1EF">DAT </font></b> — пакет с сообщениями<br/>
</li>
<li><b><font color="#3AC1EF">RQS </font></b> — Request Sessions<br/>
</li>
<li><b><font color="#3AC1EF">SES </font></b> — пакет с сессиями<br/>
</li>
<li><b><font color="#3AC1EF">HOP </font></b> — Заголовок, который означает, что пакет нужно перенаправить (после него идёт адрес и любой другой пакет)<br/>
</li>
<li><b><font color="#3AC1EF">CON </font></b> — Запрос подключения<br/>
</li>
<li><b><font color="#3AC1EF">RDY </font></b> — Ответ о готовности к взаимному подключению<br/>
</li>
</ol><br/>
<h3><font color="#3AC1EF">▍ Интерфейс</font></h3><br/>
<a name="UI"></a>Теперь осталось завернуть этот функционал в красивый консольный интерфейс и по максимуму убрать ручной ввод кода пользователем.<br/>
<br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Код милого интерфейса и визуализации сообщений в виде дерева</b>
                        <div class="spoiler_text">Для начала выведем пользователю базовую информацию. Делаем что-то вроде экрана загрузки.<br/>
<br/>
<pre><code class="python">def silent():
    logging.disable()


logging.warning(
    f"Logger for DEBUG is running! to diable it run {scriptname.split('.')[0]}.silent()"
)
print(
    f" Welcome to {scriptname} version from {verfrom} - event logging here: {scriptname}.log"
)
print(
    f"   Your Python version is {'.'.join([str(i) for i in sys.version_info[0:3]])}, branch {sys.version_info[3].upper()}"
)
try:
    c = STUN(12346)
    print(f"     Internet connection is stable on {socket.gethostname()}!")
    if 1:
        import requests

        r2 = requests.get(f"http://ipinfo.io/{c[0]}").json()["org"]
        print(
            f"       Gray  (local)  IP is {socket.gethostbyname(socket.gethostname())}"
        )
        print(f"       While (public) IP is {c[0]} - {r2}")
    else:
        print(
            f"       Gray  (local)  IP is {socket.gethostbyname(socket.gethostname())}"
        )
        print(f"       While (public) IP is {c[0]}")
except Exception as e:
    logging.critical(e)
    print(f" No internet connection found! I cant work offline!")
</code></pre><br/>
Функция для рекурсивного отображения нашей структуры (дерева):<br/>
<br/>
<pre><code class="python">
import re

def get_tree(data):
    data = data.copy()
    data.update({"00000000": "Root"})
    # data.update({"11111111":"Root"})
    data.update({"ffffffff": "Lost"})
    dct = {}

    for key, message in data.items():
        if key + ": " + message not in dct:
            dct.update({key + ": " + message: []})

    for key, message in data.items():
        rep = [i[1:] for i in re.findall("@+[a-z0-9]{8}", message)]

        if len(rep) > 0:
            rep = rep[0]
        else:
            rep = "00000000"

        if rep not in data:
            rep = "ffffffff"
        if rep + ": " + data[rep] in dct:
            dct[rep + ": " + data[rep]].append(key + ": " + message)
        else:
            pass
            # dct.update({rep+": "+data[rep]:[key+": "+message]})
    # print(dct)
    dct["00000000: Root"].remove("00000000: Root")
    for k, v in list(dct.items()).copy():
        if v == []:
            dct.pop(k)
    return dct
</code></pre><br/>
Пишем <b>MAIN</b> с самим интерфейсом:<br/>
<br/>
<pre><code class="python">
if __name__ == "__main__":
    data_load()
    print()
    inp = input(
        "You must to connect with one node (friend), which is already in net. (Press Enter when you and your friend are ready)"
    )
    s = Session()
    print()
    print(f"Send this to your friend {addr2int(s.public_ip,int(s.public_port))}")
    print()
    i, p = int2addr(int(input("Input the number from your friend: ")))
    print("Waiting for your friend")
    s.make_connection(i, p)
    sessions.append(s)
    s.backlife_cycle(1)
    while 1:
        print()
        print("╔════════════> Connect &amp; Chan Panel &lt;═════════════")
        print("╟> Type and enter your post")
        print("╟> (Empty input + Enter) to see Root")
        print("╟> ($00000000) to see specific thread")
        print("╟> (!) for new connection")
        print("╟> (#) to save checkpoint")
        print("╟> (`) dev console")
        print("╚══════════════════════════>")
        inp = input("Input: ")
        print("&lt;════════════> Connect &amp; Chan Info &lt;════════════>")
        print(
            f" Connected Nodes: {len(sessions)} | Size of Chan tree: {len(dat_to_bytes(data))} bytes\n"
        )

        if inp == "":
            ptree("00000000: Root", get_tree(data))

        elif inp == "!":
            s = Session()
            print(
                f"Send this to your friend {addr2int(s.public_ip,int(s.public_port))}"
            )
            print()
            inp = input("Input the number from your friend (Empty to cancel): ")
            if inp:
                i, p = int2addr(int(inp))
                print("Waiting for your friend")
                try:
                    s.make_connection(i, p)
                    sessions.append(s)
                    s.backlife_cycle(1)
                except:
                    print("Timeout(")
        elif inp == "`":
            try:
                debug.shell()
            except:
                pass
        elif inp == "#":
            data_dump()
        elif inp[0] == "$":
            if inp[1:] in data:
                ptree(f"{inp[1:]}: {data[inp[1:]]}", get_tree(data))
            else:
                print(f"There is no message with id [{inp[1:]}]")
        elif inp:
            data_add(inp)
        else:
            ptree("00000000: Root", get_tree(data))
        input("\n\nEnter to reload page")
        cls()</code></pre><br/>
</div>
                    </div><a name="TEST"></a><br/>
Кажется, всё готово. Теперь создаём сессию в <a href="https://colab.research.google.com/">google colab</a>, которая будет играть роль нашего друга (тут должна быть шутка про отсутствие реальных).<br/>
<br/>
<h2><font color="#3AC1EF">Демонстрация</font></h2><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Вот что видит каждый пользователь после запуска</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/942/0a9/523/9420a9523c27131aee2e44139fd1ed72.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/942/0a9/523/9420a9523c27131aee2e44139fd1ed72.png"/><br/>
</div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Обмениваемся номерами с устройством, которое уже состоит в сети</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/777/2d7/da5/7772d7da5edb6388ed7466c9144d9a7e.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/777/2d7/da5/7772d7da5edb6388ed7466c9144d9a7e.png"/><br/>
</div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Так выглядит интерфейс управления</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/4d6/f44/447/4d6f44447b16e024d7add7900069dd32.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/4d6/f44/447/4d6f44447b16e024d7add7900069dd32.png"/><br/>
</div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Попробуем написать что-нибудь</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/8f3/d87/cd3/8f3d87cd3448914b0fe1bc232931e52a.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/8f3/d87/cd3/8f3d87cd3448914b0fe1bc232931e52a.png"/><br/>
</div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Видим, что друг получил данные</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/cb6/ea4/a58/cb6ea4a58a041c66dd75dc5df69b28b8.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/cb6/ea4/a58/cb6ea4a58a041c66dd75dc5df69b28b8.png"/><br/>
</div>
                    </div><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Ответим на уже существующее сообщение</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/e8f/2ab/8f8/e8f2ab8f83c296c115c701bf42c98bfd.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/e8f/2ab/8f8/e8f2ab8f83c296c115c701bf42c98bfd.png"/><br/>
</div>
                    </div><br/>
И ещё отправим сообщение в ответ на фейковый 12312312 хэш.<br/>
<br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Видим, что наш друг видит оба (а потерянное сообщение прикрепилось к ветке Lost):</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/652/378/ce0/652378ce0bcb57e6476dc824207cd350.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/652/378/ce0/652378ce0bcb57e6476dc824207cd350.png"/><br/>
</div>
                    </div><br/>
<blockquote>Если мы рано или поздно скачаем сообщение с хэшем 12312312, то оно станет родительским для нашего.</blockquote><br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Можно посмотреть конкретный трэд вместо Root:</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/922/16e/40e/92216e40e0a374f5f03e7fcae5566758.png" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/922/16e/40e/92216e40e0a374f5f03e7fcae5566758.png"/><br/>
</div>
                    </div><br/>
<br/>
Я пробовал подключать три и более пользователей. Через некоторое время каждый был подключен к каждому и они обменивались сообщениями — мне кажется, что это успех.<br/>
<br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Логи ноды (я же зачем-то перенёс всё на логгер, верно?)</b>
                        <div class="spoiler_text"><pre><code class="bash">2023-07-27 21:05:30,651 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:05:34,622 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:05:34,622 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:05:37,502 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:05:37,502 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:05:37,502 34.74.93.102: Requesting Datagram     60
2023-07-27 21:05:37,502 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:05:37,502 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:05:39,647 34.74.93.102: Recieved DAT from ('34.74.93.102', 26698): b'DAT{"54b2b91c": "hello", "f41fe2a9": "Reply to @54b2b91c!", "894df995": "Malformed, lol @12345678", "1508abcd": "text", "0f0961d5": "#"}'
2023-07-27 21:05:39,647 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:05:44,532 34.74.93.102: Recieved RQD from ('34.74.93.102', 26698): b'RQD'
2023-07-27 21:05:44,532 34.74.93.102: Sending datagram
2023-07-27 21:05:44,532 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:05:48,152 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:05:53,749 34.74.93.102: Recieved RQD from ('34.74.93.102', 26698): b'RQD'
2023-07-27 21:05:53,749 34.74.93.102: Sending datagram
2023-07-27 21:05:53,749 34.74.93.102: Recieved RQS from ('34.74.93.102', 26698): b'RQS'
2023-07-27 21:05:53,749 34.74.93.102: Sending Session List
2023-07-27 21:05:53,750 34.74.93.102: Recieved RQD from ('34.74.93.102', 26698): b'RQD'
2023-07-27 21:05:53,750 34.74.93.102: Sending datagram
2023-07-27 21:05:53,750 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:01,225 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:03,857 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:03,857 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:03,857 34.74.93.102: Requesting Datagram     61
2023-07-27 21:06:07,235 34.74.93.102: Recieved DAT from ('34.74.93.102', 26698): b'DAT{"54b2b91c": "hello", "f41fe2a9": "Reply to @54b2b91c!", "894df995": "Malformed, lol @12345678", "1508abcd": "text", "0f0961d5": "#"}'
2023-07-27 21:06:07,235 34.74.93.102: Recieved RQD from ('34.74.93.102', 26698): b'RQD'
2023-07-27 21:06:07,235 34.74.93.102: Sending datagram
2023-07-27 21:06:07,235 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:11,860 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:11,860 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:14,504 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:24,636 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:24,636 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:24,636 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:24,636 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:28,006 34.74.93.102: Recieved RQD from ('34.74.93.102', 26698): b'RQD'
2023-07-27 21:06:28,006 34.74.93.102: Sending datagram
2023-07-27 21:06:28,006 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:28,006 34.74.93.102: Requesting Datagram     62
2023-07-27 21:06:28,007 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:28,007 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:28,007 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:37,933 34.74.93.102: Recieved DAT from ('34.74.93.102', 26698): b'DAT{"54b2b91c": "hello", "f41fe2a9": "Reply to @54b2b91c!", "894df995": "Malformed, lol @12345678", "1508abcd": "text", "0f0961d5": "#"}'
2023-07-27 21:06:37,933 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:37,933 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:37,933 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:37,933 34.74.93.102: Requesting Session List 19
2023-07-27 21:06:37,933 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:37,933 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'
2023-07-27 21:06:37,933 34.74.93.102: Requesting Datagram     63
2023-07-27 21:06:47,334 34.74.93.102: Recieved SES from ('34.74.93.102', 26698): b'SES["34.147.33.206"]'
2023-07-27 21:06:47,334 34.74.93.102: My sessions: {'34.74.93.102'} Recieved: {'34.147.33.206'} New: ['34.147.33.206']
2023-07-27 21:06:47,334 STUN request via stun.ekiga.net</code></pre><br/>
Видим практическое подтверждение всего, что было сказано раньше. Ноды обмениваются KPL, периодически сверяя датасеты и списки сессий.<br/>
</div>
                    </div><a name="CONC"></a><br/>
<h2><font color="#3AC1EF">As conclusion</font></h2><br/>
<img src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/3ce/f5c/428/3cef5c428a7ab78d8c22732fc9438a70.jpg" alt="image" data-src="https://habrastorage.org/r/w1560/getpro/habr/upload_files/3ce/f5c/428/3cef5c428a7ab78d8c22732fc9438a70.jpg" data-blurred="true"/><br/>
<br/>
Под конец можно сказать, что результат получился даже лучше, чем я изначально рассчитывал. Простая пробрасывалка портов превратилась в полноценное юзабельное приложение. На самом деле, ещё есть что доработать и прикрутить — совершенству нет предела. Как минимум можно распространять вместе со своим ip ещё и публичный ключ от асимметричной пары и передавать данные не в сыром виде, а зашифрованные этой парой так, чтобы прочитать их мог только желаемый получатель (только ваш друг). Можно прикрутить интерфейс поверх какого-нибудь <a href="https://www.electronjs.org/">electron</a>а и получить готовое десктопное приложение…<br/>
<br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Весь исходный код CnC.py</b>
                        <div class="spoiler_text"><pre><code class="python">from pathlib import Path
import time
import os
import sys


def cls():
    os.system("cls" if os.name == "nt" else "clear")


try:
    scriptname = Path(__file__).name
except:
    scriptname = "CnC.py"
try:
    verfrom = time.ctime(os.path.getmtime(__file__))
except:
    verfrom = "!No time!"


import threading
import socket
import random
import hashlib
import json
import logging
import pdb


class Debug(pdb.Pdb):
    def __init__(self, *args, **kwargs):
        super(Debug, self).__init__(*args, **kwargs)
        self.prompt = "CnC Debug Shell >>> "

    def shell(self):
        self.set_trace()


debug = Debug()
# logging.warn(f"Event logging is enabled. You can see it in {scriptname}.log")
logging.basicConfig(
    format="%(asctime)s %(message)s", level=logging.DEBUG, filename=f"{scriptname}.log"
)
logging.info("Hello world!")
logging.getLogger().setLevel(logging.DEBUG)


def get_files():
    matches = []
    for root, dirs, files in os.walk(os.getcwd()):
        for file in files:
            if file.endswith(".html"):
                matches.append(os.path.splitext(file)[0])
    return matches


def dat_to_bytes(diction: dict) -> bytes:
    return json.dumps(diction).encode("cp866")


def bytes_to_dat(byte: bytes) -> dict:
    return json.loads(byte.decode("cp866"))


def checksum(b):
    return hashlib.blake2s(b, digest_size=4).hexdigest()


_alreadyused = set()


def randomport():
    global _alreadyused
    p = random.randint(16000, 65535)
    while p in _alreadyused:
        p = random.randint(16000, 65535)
    _alreadyused.update({p})
    return p


def aegis(f):
    def wr():
        while 1:
            try:
                f()
                break
            except Exception as e:
                logging.critical(e)

    return wr


def STUN(port, host="stun.ekiga.net"):
    logging.debug(f"STUN request via {host}")
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.bind(("0.0.0.0", port))
    sock.setblocking(0)
    server = socket.gethostbyname(host)
    work = True
    while work:
        sock.sendto(
            b"\x00\x01\x00\x00!\x12\xa4B\xd6\x85y\xb8\x11\x030\x06xi\xdfB",
            (server, 3478),
        )
        for i in range(20):
            try:
                ans, addr = sock.recvfrom(2048)
                work = False
                break
            except:
                time.sleep(0.01)

    sock.close()
    return socket.inet_ntoa(ans[28:32]), int.from_bytes(ans[26:28], byteorder="big")


def addr2int(ip, port: int):
    binport = bin(port)[2:].rjust(16, "0")
    binip = "".join([bin(int(i))[2:].rjust(8, "0") for i in ip.split(".")])
    return int(binip + binport, 2)


def int2addr(num):
    num = bin(num)[2:].rjust(48, "0")
    print(num)
    num = [
        str(int(i, 2))
        for i in [num[0:8], num[8:16], num[16:24], num[24:32], num[32:48]]
    ]
    return ".".join(num[0:4]), int(num[4])


pool = []  # Pool for commands to any session (like RQD to initiate data update)

missed_messages = (
    set()
)  # Storage for hashes of required but missed messages (to request them later)

data = {}
sessions = []


def mass_command(c):
    global pool
    pool.append(c)


def data_add(item):
    data.update({checksum(item.encode("cp866")): item})


def data_dump():
    with open(f"{scriptname}.chat-savefile.json", "w") as f:
        json.dump(icm2.data, f)


def data_load():
    global data
    try:
        with open(f"{scriptname}.chat-savefile.json", "r") as f:
            data = json.load(f)
    except:
        logging.error(f"No save file exists! New one created")
        with open(f"{scriptname}.chat-savefile.json", "w") as f:
            json.dump({}, f)


class Session:
    def __init__(self):
        # self.prefix="IDL"
        self.immortal = False
        self.local_port = randomport()
        for i in range(10):
            self.public_ip, self.public_port = STUN(self.local_port)
        self.socket = None
        self.client = None
        self.thread = None
        logging.info(f'"{self.public_ip}",{self.public_port}')

    def make_connection(self, ip, port, timeout=10):
        logging.debug(f"Start waiting for handshake with {ip}:{port}")
        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        sock.bind(("0.0.0.0", self.local_port))
        sock.setblocking(0)
        while True:
            sock.sendto(b"Con. Request!", (ip, port))
            time.sleep(2)
            try:
                ans, addr = sock.recvfrom(9999)
                sock.sendto(b"Con. Request!", (ip, port))
                sock.close()
                sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
                sock.bind(("0.0.0.0", self.local_port))
                sock.setblocking(0)
                self.client = (ip, port)
                self.socket = sock
                logging.debug(f"Hole with {self.client} punched!")
                break
            except Exception as e:
                assert timeout > 0
                timeout -= 1
                logging.debug(f"No handshake with {ip}:{port} yet...")

    def backlife_cycle(self, freq=1):
        global sessions
        if self.immortal:
            logging.warning(f"{self.client} session beacame immortal")
            self.life_cycle = aegis(self.life_cycle)
        th = threading.Thread(target=self.life_cycle, args=(freq,))
        th.start()
        self.thread = th
        logging.warning(f"Session with {self.client} stabilized!")
        # sessions.append(self)

    def life_cycle(self, freq=1):
        global data
        global sessions
        global pool
        c = 0
        while 1:
            if len(pool):
                pref = pool.pop(0)
            else:
                pref = b"KPL"

            self.socket.sendto(pref, self.client)  # Keep-alive
            time.sleep(max(random.gauss(1 / freq, 3), 0))

            while True:
                try:
                    ans, reply_addr = self.socket.recvfrom(9999)
                    logging.debug(
                        f"{self.client[0]}: Recieved {ans[:3].decode('cp866')} from {reply_addr}: {ans}"
                    )
                except:
                    break

                if ans[:3] == b"KPL":
                    c += 1
                    if c % 10 == 0:
                        logging.debug(
                            f"{self.client[0]}: Requesting Datagram     {c//10}"
                        )
                        self.socket.sendto(b"RQD", self.client)
                        c += 1
                    elif c % 33 == 0:
                        logging.debug(
                            f"{self.client[0]}: Requesting Session List {c//33}"
                        )
                        self.socket.sendto(b"RQS", self.client)
                        c += 1

                # ----------------------------------------Hashes (keys) sync (disabled now)----------------------------------------
                elif ans[:3] == b"RQH":
                    logging.debug(f"{self.client[0]}: Sending hashes")
                    self.socket.sendto(
                        b"HAS" + dat_to_bytes(list(data.keys())), self.client
                    )

                elif ans[:3] == b"HAS":
                    missed_messages.update(
                        set(bytes_to_dat(ans[3:])) - set(data.keys())
                    )

                # ----------------------------------------Data sync----------------------------------------
                elif ans[:3] == b"RQD":
                    if ans[3:] != b"":
                        logging.debug(f"{self.client[0]}: Sending specific datagram")
                        n = {}
                        r = set(bytes_to_dat(ans[3:]))
                        for i in r:
                            if i in data:
                                n.update({i: data[i]})
                        logging.debug(f"{self.client[0]}: Sending {n}")
                        self.socket.sendto(b"DAT" + dat_to_bytes(n), self.client)
                    else:
                        logging.debug(f"{self.client[0]}: Sending datagram")
                        self.socket.sendto(b"DAT" + dat_to_bytes(data), self.client)

                elif ans[:3] == b"DAT":
                    data.update(bytes_to_dat(ans[3:]))

                # ----------------------------------------IP list sync-------------------------------------
                elif ans[:3] == b"RQS":
                    logging.debug(f"{self.client[0]}: Sending Session List")
                    sess = [i.client[0] if i.client else None for i in sessions]
                    sess = set(sess)
                    sess = sess - {None}
                    sess = list(sess)
                    sess.remove(self.client[0])
                    self.socket.sendto(b"SES" + dat_to_bytes(sess), self.client)

                elif ans[:3] == b"SES":
                    sess = [i.client[0] if i.client else None for i in sessions]
                    sess = set(sess)
                    sess = sess - {None}
                    logging.debug(
                        f"{self.client[0]}: My sessions: {sess} Recieved: {set(bytes_to_dat(ans[3:]))} New: {list(set(bytes_to_dat(ans[3:]))-sess)}"
                    )
                    uncon = list(set(bytes_to_dat(ans[3:])) - sess)
                    if not uncon:
                        continue
                    adr = random.choice(uncon)
                    s = Session()
                    sessions.append(s)
                    self.socket.sendto(
                        b"HOP"
                        + socket.inet_aton(adr)
                        + b"CON"
                        + s.public_ip.encode("cp866")
                        + b":"
                        + str(s.public_port).encode("cp866"),
                        self.client,
                    )
                # ----------------------------------------HOP Tracking-------------------------------------
                elif ans[:3] == b"HOP":
                    sess = [i.client[0] if i.client else None for i in sessions]

                    ip = socket.inet_ntoa(ans[3:7])
                    if ip in sess:
                        s = sessions[sess.index(ip)]
                        s.socket.sendto(ans[7:], s.client)

                elif ans[:3] == b"CON":
                    s = Session()
                    adr, prt = ans[3:].decode("cp866").split(":")
                    self.socket.sendto(
                        b"HOP"
                        + socket.inet_aton(adr)
                        + b"RDY"
                        + prt.encode("cp866")
                        + b":"
                        + s.public_ip.encode("cp866")
                        + b":"
                        + str(s.public_port).encode("cp866"),
                        self.client,
                    )
                    try:
                        s.make_connection(adr, int(prt))
                        s.backlife_cycle(1)
                        sessions.append(s)
                    except:
                        logging.error(f"{self.client[0]}: Connect initiation timeout!")

                elif ans[:3] == b"RDY":
                    myprt, adr, prt = ans[3:].decode("cp866").split(":")
                    sess = [i.public_port for i in sessions]

                    if int(myprt) in sess:
                        s = sessions[sess.index(int(myprt))]
                        try:
                            s.make_connection(adr, int(prt))
                            s.backlife_cycle(1)
                        except:
                            logging.error(
                                f"{self.client[0]}: Connect stabilization timeout!"
                            )
                            sessions.remove(s)

                # ----------------------------------------Disabled Trash-----------------------------------
                elif ans[:3] == b"TRK":
                    adr, prt = ans[3:].decode("cp866").split(",")
                    sess = [i.client[0] for i in sessions]
                    sess.remove(self.client[0])
                    s = sessions[sess.index(adr)]

                    s.socket.sendto(
                        b"CN0"
                        + f"{self.client[0].encode('cp866')}:{prt.encode('cp866')}",
                        s.client,
                    )

                elif ans[:3] == b"CN0":
                    s = Session()
                    self.socket.sendto(
                        b"CN1"
                        + f"{s.public_ip.encode('cp866')}:{str(s.public_port).encode('cp866')}",
                        self.client,
                    )
                    adr, prt = ans[3:].decode("cp866").split(":")
                    s.make_connection(adr, int(prt))
                    sessions.append(s)
                elif ans[:3] == b"TRK":
                    pass
                else:
                    logging.warning(f"{self.client[0]}: Malformed! !!!{ans}!!!")


# It is like a legacy code, bruh: (https://stackoverflow.com/questions/51903172/how-to-display-a-tree-in-python-similar-to-msdos-tree-command)
def ptree(start, tree, indent_width=4):
    def _ptree(start, parent, tree, grandpa=None, indent=""):
        if parent != start:
            if grandpa is None:  # Ask grandpa kids!
                print(parent, end="")
            else:
                print(parent)
        if parent not in tree:
            return 
        for child in tree[parent][:-1]:
            print(indent + "├" + "─" * indent_width, end="")
            _ptree(start, child, tree, parent, indent + "│" + " " * 4)
        child = tree[parent][-1]
        print(indent + "└" + "─" * indent_width, end="")
        _ptree(start, child, tree, parent, indent + " " * 5)  # 4 -> 5

    parent = start
    print(start)
    _ptree(start, parent, tree)


def silent():
    logging.disable()


logging.warning(
    f"Logger for DEBUG is running! to diable it run {scriptname.split('.')[0]}.silent()"
)
print(
    f" Welcome to {scriptname} version from {verfrom} - event logging here: {scriptname}.log"
)
print(
    f"   Your Python version is {'.'.join([str(i) for i in sys.version_info[0:3]])}, branch {sys.version_info[3].upper()}"
)
try:
    c = STUN(12346)
    print(f"     Internet connection is stable on {socket.gethostname()}!")
    if 1:
        import requests

        r2 = requests.get(f"http://ipinfo.io/{c[0]}").json()["org"]
        print(
            f"       Gray  (local)  IP is {socket.gethostbyname(socket.gethostname())}"
        )
        print(f"       While (public) IP is {c[0]} - {r2}")
    else:
        print(
            f"       Gray  (local)  IP is {socket.gethostbyname(socket.gethostname())}"
        )
        print(f"       While (public) IP is {c[0]}")
except Exception as e:
    logging.critical(e)
    print(f" No internet connection found! I cant work offline!")


import re


def get_tree(data):
    data = data.copy()
    data.update({"00000000": "Root"})
    # data.update({"11111111":"Root"})
    data.update({"ffffffff": "Lost"})
    dct = {}

    for key, message in data.items():
        if key + ": " + message not in dct:
            dct.update({key + ": " + message: []})

    for key, message in data.items():
        rep = [i[1:] for i in re.findall("@+[a-z0-9]{8}", message)]

        if len(rep) > 0:
            rep = rep[0]
        else:
            rep = "00000000"

        if rep not in data:
            rep = "ffffffff"
        if rep + ": " + data[rep] in dct:
            dct[rep + ": " + data[rep]].append(key + ": " + message)
        else:
            pass
            # dct.update({rep+": "+data[rep]:[key+": "+message]})
    # print(dct)
    dct["00000000: Root"].remove("00000000: Root")
    for k, v in list(dct.items()).copy():
        if v == []:
            dct.pop(k)
    return dct


if __name__ == "__main__":
    data_load()
    print()
    inp = input(
        "You must to connect with one node (friend), which is already in net. (Press Enter when you and your friend are ready)"
    )
    s = Session()
    print()
    print(f"Send this to your friend {addr2int(s.public_ip,int(s.public_port))}")
    print()
    i, p = int2addr(int(input("Input the number from your friend: ")))
    print("Waiting for your friend")
    s.make_connection(i, p)
    sessions.append(s)
    s.backlife_cycle(1)
    while 1:
        print()
        print("╔════════════> Connect &amp; Chan Panel &lt;═════════════")
        print("╟> Type and enter your post")
        print("╟> (Empty input + Enter) to see Root")
        print("╟> ($00000000) to see specific thread")
        print("╟> (!) for new connection")
        print("╟> (#) to save checkpoint")
        print("╟> (`) dev console")
        print("╚══════════════════════════>")
        inp = input("Input: ")
        print("&lt;════════════> Connect &amp; Chan Info &lt;════════════>")
        print(
            f" Connected Nodes: {len(sessions)} | Size of Chan tree: {len(dat_to_bytes(data))} bytes\n"
        )

        if inp == "":
            ptree("00000000: Root", get_tree(data))

        elif inp == "!":
            s = Session()
            print(
                f"Send this to your friend {addr2int(s.public_ip,int(s.public_port))}"
            )
            print()
            inp = input("Input the number from your friend (Empty to cancel): ")
            if inp:
                i, p = int2addr(int(inp))
                print("Waiting for your friend")
                try:
                    s.make_connection(i, p)
                    sessions.append(s)
                    s.backlife_cycle(1)
                except:
                    print("Timeout(")
        elif inp == "`":
            try:
                debug.shell()
            except:
                pass
        elif inp == "#":
            data_dump()
        elif inp[0] == "$":
            if inp[1:] in data:
                ptree(f"{inp[1:]}: {data[inp[1:]]}", get_tree(data))
            else:
                print(f"There is no message with id [{inp[1:]}]")
        elif inp:
            data_add(inp)
        else:
            ptree("00000000: Root", get_tree(data))
        input("\n\nEnter to reload page")
        cls()</code></pre><br/>
</div>
                    </div><br/>
Хотя останавливаться тоже нужно уметь. <br/>
<br/>
На этом я, пожалуй, поблагодарю вас за выделенное время на эту статью. Не уверен, что досюда все дочитали, особенно если вникали во весь код и объяснения. Если же ты, мой дорогой читатель, действительно ещё здесь…<br/>
<br/>
<div class="spoiler" role="button" tabindex="0">
                        <b class="spoiler_title">Держи милые обои на рабочий стол</b>
                        <div class="spoiler_text"><img src="https://habrastorage.org/r/w1560/webt/ru/hh/ob/ruhhobvxnh2haqrwru6ejkipwcs.png" data-src="https://habrastorage.org/webt/ru/hh/ob/ruhhobvxnh2haqrwru6ejkipwcs.png"/><br/>
<blockquote>Или тизер следующей моей статьи по ML, тут как знать...</blockquote></div>
                    </div><br/>
Само собой, feedback и здравая критика в комментариях приветствуются. Спасибо!<br/>
<br/>
<blockquote><b><font color="#3AC1EF"><a href="https://t.me/ruvds_community">Telegram-канал с розыгрышами призов, новостями IT и постами о ретроиграх 🕹️</a></font></b></blockquote><a href="http://ruvds.com/ru-rub?utm_source=habr&amp;utm_medium=article&amp;utm_campaign=CodeDroidX&amp;utm_content=p2p_forum_s_nulya_ot_nat_hole_punching_do_avtonomnoj_i_polnostyu_decentralizovannoj_seti"><img src="https://habrastorage.org/r/w1560/webt/tp/sk/z-/tpskz-7w7a8e74isoowuep40xeg.png" data-src="https://habrastorage.org/webt/tp/sk/z-/tpskz-7w7a8e74isoowuep40xeg.png"/></a></div></div></div> <!----> <!----></div> <!----> <!----></div> <!----> <div class="tm-article-presenter__meta"><div class="tm-article-presenter__meta-list tm-separated-list"><span class="tm-separated-list__title">Теги:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bruvds_%D1%81%D1%82%D0%B0%D1%82%D1%8C%D0%B8%5D" class="tm-tags-list__link">ruvds_статьи</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpython%5D" class="tm-tags-list__link">python</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bip%5D" class="tm-tags-list__link">ip</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bp2p-%D1%81%D0%B5%D1%82%D0%B8%5D" class="tm-tags-list__link">p2p-сети</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Boverlay%5D" class="tm-tags-list__link">overlay</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bnetwork%5D" class="tm-tags-list__link">network</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bpeer-to-peer%5D" class="tm-tags-list__link">peer-to-peer</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bnat%5D" class="tm-tags-list__link">nat</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bmikrotik%5D" class="tm-tags-list__link">mikrotik</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bsocket%5D" class="tm-tags-list__link">socket</a></li><li class="tm-separated-list__item"><a href="/ru/search/?target_type=posts&amp;order=relevance&amp;q=%5Bholepunch%5D" class="tm-tags-list__link">holepunch</a></li> <!----></ul></div> <div class="tm-article-presenter__meta-list tm-separated-list"><span class="tm-separated-list__title">Хабы:</span> <ul class="tm-separated-list__list"><li class="tm-separated-list__item"><a href="/ru/companies/ruvds/articles/" class="tm-hubs-list__link router-link-active">Блог компании RUVDS.com</a></li><li class="tm-separated-list__item"><a href="/ru/hubs/p2p/" class="tm-hubs-list__link">Децентрализованные сети</a></li><li class="tm-separated-list__item"><a href="/ru/hubs/programming/" class="tm-hubs-list__link">Программирование</a></li><li class="tm-separated-list__item"><a href="/ru/hubs/network_technologies/" class="tm-hubs-list__link">Сетевые технологии</a></li><li class="tm-separated-list__item"><a href="/ru/hubs/network_hardware/" class="tm-hubs-list__link">Сетевое оборудование</a></li> <!----></ul></div></div></article></div> <!----></div> <div class="tm-article-sticky-panel"><div class="tm-data-icons tm-article-sticky-panel__icons"><div class="tm-article-rating tm-data-icons__item"><div class="tm-votes-meter tm-article-rating__votes-switcher"><svg height="24" width="24" class="tm-svg-img tm-votes-meter__icon tm-votes-meter__icon tm-votes-meter__icon_appearance-article"><title>Всего голосов 68: ↑68 и ↓0</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#counter-rating"></use></svg> <span title="Всего голосов 68: ↑68 и ↓0" class="tm-votes-meter__value tm-votes-meter__value tm-votes-meter__value_positive tm-votes-meter__value_appearance-article tm-votes-meter__value_rating">+68</span></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----> <!----> <button title="Добавить в закладки" type="button" class="bookmarks-button tm-data-icons__item"><span class="tm-svg-icon__wrapper bookmarks-button__icon"><svg height="24" width="24" class="tm-svg-img tm-svg-icon"><title>Добавить в закладки</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#counter-favorite"></use></svg></span> <span title="Количество пользователей, добавивших публикацию в закладки" class="bookmarks-button__counter">
    113
  </span></button> <div title="Поделиться" class="tm-sharing tm-data-icons__item"><button type="button" class="tm-sharing__button"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="tm-sharing__icon"><path fill="currentColor" d="M13.8 13.8V18l7.2-6.6L13.8 5v3.9C5 8.9 3 18.6 3 18.6c2.5-4.4 6-4.8 10.8-4.8z"></path></svg></button> <DIV class="v-portal" style="display:none;"></DIV></div> <div title="Читать комментарии" class="tm-article-comments-counter-link tm-data-icons__item"><a href="/ru/companies/ruvds/articles/761188/comments/" class="tm-article-comments-counter-link__link"><svg height="24" width="24" class="tm-svg-img tm-article-comments-counter-link__icon"><title>Комментарии</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value">
      23
    </span></a> <!----></div> <!----> <DIV class="v-portal" style="display:none;"></DIV></div></div></div>  <div class="tm-article-presenter__footer"><div class="tm-article-blocks"><!----> <div></div> <section class="tm-block tm-block tm-block_spacing-bottom"><!----> <div class="tm-block__body tm-block__body tm-block__body_variant-balanced"><div class="tm-article-author"><div class="tm-article-author__company"><div class="tm-article-author__company-card"><div class="tm-company-snippet"><a href="/ru/companies/ruvds/profile/" class="tm-company-snippet__logo-link"><div class="tm-entity-image"><img alt height="40" src="//habrastorage.org/getpro/habr/company/027/b19/cea/027b19cea984722a8d806edcc56c2c00.png" width="40" class="tm-entity-image__pic"></div></a> <div class="tm-company-snippet__info"><a href="/ru/companies/ruvds/profile/" class="tm-company-snippet__title">RUVDS.com</a> <div class="tm-company-snippet__description">VDS/VPS-хостинг. Скидка 15% по коду <b>HABR15</b></div></div></div> <div class="tm-article-author__buttons"><!----> <!----></div></div> <div class="tm-article-author__company-contacts"><a href="https://telegram.me/ruvds_community" rel="noopener" target="_blank" class="tm-article-author__contact">
      Telegram
    </a><a href="https://vk.com/ru_vds" rel="noopener" target="_blank" class="tm-article-author__contact">
      ВКонтакте
    </a><a href="https://twitter.com/ru_vds" rel="noopener" target="_blank" class="tm-article-author__contact">
      Twitter
    </a></div> <div class="tm-article-author__separator"></div></div> <div class="tm-user-card tm-article-author__user-card tm-user-card tm-user-card_variant-article"><div class="tm-user-card__info-container"><div class="tm-user-card__header"><div class="tm-user-card__header-data"><a href="/ru/users/CodeDroidX/" class="tm-user-card__userpic tm-user-card__userpic_size-40"><div class="tm-entity-image"><img alt src="//habrastorage.org/getpro/habr/avatars/b3e/776/b95/b3e776b954216ebac21f19d4a1623889.png" class="tm-entity-image__pic"></div></a> <div class="tm-user-card__meta"><div title=" 55 голосов " class="tm-counter-container tm-karma tm-karma"><div class="tm-counter-container__header"><div class="tm-karma__votes tm-karma__votes_positive">
      53
    </div></div> <div class="tm-counter-container__footer"><div class="tm-karma__text">
      Карма
    </div> <DIV class="v-portal" style="display:none;"></DIV></div></div> <div title="Рейтинг пользователя" class="tm-counter-container"><div class="tm-counter-container__header"> <div class="tm-votes-lever tm-votes-lever tm-votes-lever_appearance-rating"><!----> <div class="tm-votes-lever__score tm-votes-lever__score tm-votes-lever__score_appearance-rating"><span class="tm-votes-lever__score-counter tm-votes-lever__score-counter tm-votes-lever__score-counter_rating">
        108.1
      </span></div> <!----></div></div> <div class="tm-counter-container__footer"><span class="tm-rating__text tm-rating__text">
      Рейтинг
    </span></div></div></div></div></div> <div class="tm-user-card__info tm-user-card__info tm-user-card__info_variant-article"><div class="tm-user-card__title tm-user-card__title tm-user-card__title_variant-article"><span class="tm-user-card__name tm-user-card__name tm-user-card__name_variant-article">Andрeй ✅</span> <a href="/ru/users/CodeDroidX/" class="tm-user-card__nickname tm-user-card__nickname tm-user-card__nickname_variant-article">
          @CodeDroidX
        </a> <!----></div> <p class="tm-user-card__short-info tm-user-card__short-info tm-user-card__short-info_variant-article">Пользователь</p></div></div> <div class="tm-user-card__buttons tm-user-card__buttons tm-user-card__buttons_variant-article"><!----> <!----> <!----> <!----> <!----></div></div> <div class="tm-article-author__user-contacts"><a href="https://career.habr.com/codedroidx" rel="noopener" target="_blank" class="tm-article-author__contact">
      Хабр Карьера
    </a><a href="https://freelance.habr.com/freelancers/codedroidx" rel="noopener" target="_blank" class="tm-article-author__contact">
      Хабр Фриланс
    </a><a href="https://github.com/CodeDruidX/" rel="noopener" target="_blank" class="tm-article-author__contact">
      Github
    </a><a href="https://telegram.me/tg_droid_x" rel="noopener" target="_blank" class="tm-article-author__contact">
      Telegram
    </a></div></div> <DIV class="v-portal" style="display:none;"></DIV></div> <!----></section>  <div class="tm-article-blocks__comments"><div id="publication-comments" class="tm-article-page-comments"><div class="tm-article-comments-counter-link tm-article-comments-counter-button"><a href="/ru/companies/ruvds/articles/761188/comments/" class="tm-article-comments-counter-link__link tm-article-comments-counter-link__link_button-style"><svg height="24" width="24" class="tm-svg-img tm-article-comments-counter-link__icon tm-article-comments-counter-link__icon_contrasted"><title>Комментарии</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#counter-comments"></use></svg> <span class="tm-article-comments-counter-link__value tm-article-comments-counter-link__value_contrasted">
       Комментарии 23 
    </span></a> <!----></div></div></div>  <section class="tm-block tm-block tm-block_spacing-bottom"><header class="tm-block__header tm-block__header tm-block__header_variant-borderless"><div class="tm-block__header-container"><h2 class="tm-block__title tm-block__title tm-block__title_variant-large">Публикации</h2> </div> <!----></header> <div class="tm-block__body tm-block__body tm-block__body_variant-condensed-slim"><div class="tm-tabs tm-tabs"><div><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_active tm-tabs__tab-link_slim">
        Лучшие за сутки
      </button></span><span class="tm-tabs__tab-item"><button class="tm-tabs__tab-link tm-tabs__tab-link tm-tabs__tab-link_slim">
        Похожие
      </button></span></div> <!----></div> <div class="similar-and-daily__tab-view"><div class="placeholder-wrapper"><!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <div class="tm-placeholder-article-cards"><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div><div class="tm-placeholder-article-card"><div class="tm-placeholder__user"><div class="tm-placeholder__user-pic loads"></div> <div class="tm-placeholder__user-date loads"></div></div> <div class="tm-placeholder-article-card__title"><div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div> <div class="tm-placeholder__line tm-placeholder-article-card__title-line loads"></div></div> <div class="tm-placeholder-article-card__icons tm-placeholder__counters"><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div><div class="tm-placeholder-data-icon"><div class="tm-placeholder__icon tm-placeholder__icon_large loads"></div> <div class="tm-placeholder__line tm-placeholder__line_icon-text"></div></div></div></div></div> <!----> <!----> <!----> <!----></div> <!----></div></div> <!----></section> <div class="placeholder-wrapper"><!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <!----> <div class="tm-placeholder-inset tm-placeholder-vacancies"><div class="tm-placeholder-inset__header"><div class="tm-placeholder__line tm-placeholder__line_inset-header loads"></div></div> <div class="tm-placeholder-inset__body"><ul class="tm-placeholder-list"><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li><li class="tm-placeholder-list__item tm-placeholder-list__item_inset"><div class="tm-placeholder-list__title-container"><div class="tm-placeholder__line tm-placeholder__line_item-title loads"></div></div> <div class="tm-project-block-items__properties"><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span><span class="tm-project-block-items__property-item"><span class="tm-placeholder__line loads" style="width: 100px;"></span></span></div></li></ul></div> <div class="tm-placeholder-inset__footer"><div class="tm-placeholder__line tm-placeholder__line_inset-footer loads"></div></div></div> <!----> <!----> <!----> <!----> <!----> <!----></div> <!----> </div></div></div></div></div> <div class="tm-page__sidebar"><!----></div></div></div></div></main> <!----></div> <!----> <div class="tm-footer"><div class="tm-page-width"><div class="tm-footer__container"><div class="tm-footer__title"><a href="/ru/" class="tm-svg-icon__wrapper tm-footer__title-link router-link-active"><svg height="16" width="16" class="tm-svg-img tm-svg-icon"><title>Хабр</title> <use xlink:href="/img/habr-logo-ru.svg#logo"></use></svg></a></div> <div class="tm-footer__social"><a href="https://www.facebook.com/habrahabr.ru" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="36" width="36" class="tm-svg-img tm-svg-icon"><title>Facebook</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-facebook"></use></svg></a><a href="https://twitter.com/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="36" width="36" class="tm-svg-img tm-svg-icon"><title>Twitter</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-twitter"></use></svg></a><a href="https://vk.com/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="36" width="36" class="tm-svg-img tm-svg-icon"><title>VK</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-vk"></use></svg></a><a href="https://telegram.me/habr_com" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="36" width="36" class="tm-svg-img tm-svg-icon"><title>Telegram</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-telegram"></use></svg></a><a href="https://www.youtube.com/channel/UCd_sTwKqVrweTt4oAKY5y4w" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="36" width="36" class="tm-svg-img tm-svg-icon"><title>Youtube</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-youtube"></use></svg></a><a href="https://dzen.ru/habr" rel="nofollow noopener noreferrer" target="_blank" class="tm-svg-icon__wrapper tm-social-icons__icon"><svg height="36" width="36" class="tm-svg-img tm-svg-icon"><title>Яндекс Дзен</title> <use xlink:href="/img/new-social-icons-sprite.svg#social-logo-dzen"></use></svg></a></div> <DIV class="v-portal" style="display:none;"></DIV> <button class="tm-footer__link"><svg height="16" width="16" class="tm-svg-img tm-footer__icon"><title>Язык</title> <use xlink:href="/img/megazord-v28.2fb1b1c1..svg#lang"></use></svg>
        Настройка языка
      </button> <a href="/ru/feedback/" class="tm-footer__link">
        Техническая поддержка
      </a> <a href="/berserk-mode-nope" class="tm-footer__link">
        Вернуться на старую версию
      </a> <div class="tm-footer-copyright"><span class="tm-copyright"><span class="tm-copyright__years">© 2006–2023, </span> <span class="tm-copyright__name"><a href="https://company.habr.com/" rel="noopener" target="_blank" class="tm-copyright__link">Habr</a></span></span></div></div></div></div> <!----> <!----></div> <div class="vue-portal-target"></div></div>
<script>window.__INITIAL_STATE__={"adblock":{"hasAcceptableAdsFilter":false,"hasAdblock":false},"articlesList":{"articlesList":{"761188":{"id":"761188","timePublished":"2023-10-02T09:00:01+00:00","isCorporative":true,"lang":"ru","titleHtml":"P2P-форум с нуля | от NAT hole punching до автономной и полностью децентрализованной сети","leadData":{"textHtml":"\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fruvds\u002Farticles\u002F761188\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fgo\u002Fc6\u002Ffb\u002Fgoc6fbxehf6l6rs6ihvnw5mmzy8.png\"\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u003E\r\nМногие, кто работают с интернет-сокетами в любой сфере IT, задаются вопросом о \u003Ci\u003Eпробросе портов\u003C\u002Fi\u003E. Связано это с тем, что практически во всех домашних\u002Fобщественных\u002Fкорпоративных роутерах реализован механизм \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FNAT\" rel=\"nofollow noopener noreferrer\"\u003ENAT\u003C\u002Fa\u003E, который перекрывает прямой доступ к устройствам в этих подсетях извне, общаясь с внешним интернетом от их имени.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nУ NAT есть киллер-фича — он представляет собой идеальный \u003Ci\u003E\u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9C%D0%B5%D0%B6%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B9_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD\" rel=\"nofollow noopener noreferrer\"\u003Eфаервол\u003C\u002Fa\u003E\u003C\u002Fi\u003E: атаки извне не могут использовать порты локальных устройств напрямую, следовательно, это решает проблему \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%A3%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D1%8B%D0%B5_%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D0%B5_%D0%B0%D1%82%D0%B0%D0%BA%D0%B8\" rel=\"nofollow noopener noreferrer\"\u003Eатак на сетевую уязвимость ОС\u003C\u002Fa\u003E.\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nНо, это доставляет и неудобства, например, если ты захочешь подключиться или хотя бы увидеть устройство \u003Ci\u003Eза NAT\u003C\u002Fi\u003E в благих целях, то ты чисто теоретически не сможешь это сделать — \u003Ci\u003Eу него относительно тебя нет IP-адреса.\u003C\u002Fi\u003E\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nРазнообразные сервисы работают на серверах, т. е. имеют некую ноду, которая имеет белый адрес в интернете (находится не за NAT). Все пользователи же подключаются к этому единому серверу. В таком случае проблема «невидимости» пользователей отпадает. Однако чисто серверное взаимодействие ограничивает скорость участников, так ещё и не отказоустойчиво. Если сервер упадёт, то все клиенты отправятся за ним (считаем, что это одноклеточный сервис не на всяких там kubernetes).\u003Cbr\u003E\r\n\u003Cbr\u003E\r\nКак вы уже могли были догадаться, даже в реалиях, когда практически все устройства находятся за NATами, \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003EP2P реален\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E. Когда вы являетесь участником bittorrent-раздачи, трансфер больших данных осуществляется напрямую. Как это работает? Поиск ответа на этот вопрос завёл меня в глубокие дебри, разгребая которые я написал оверлейную \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9E%D0%B4%D0%BD%D0%BE%D1%80%D0%B0%D0%BD%D0%B3%D0%BE%D0%B2%D0%B0%D1%8F_%D1%81%D0%B5%D1%82%D1%8C\" rel=\"nofollow noopener noreferrer\"\u003Ep2p-сеть\u003C\u002Fa\u003E, где \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FBitTorrent-%D1%82%D1%80%D0%B5%D0%BA%D0%B5%D1%80\" rel=\"nofollow noopener noreferrer\"\u003Eтрекерами\u003C\u002Fa\u003E являются сами её участники. Интересно? Тогда добро пожаловать под кат.","imageUrl":null,"buttonTextHtml":"Читать дальше &rarr;","image":null},"editorVersion":"1.0","postType":"article","postLabels":[],"author":{"id":"3284927","alias":"CodeDroidX","fullname":"Andрeй ✅","avatarUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Favatars\u002Fb3e\u002F776\u002Fb95\u002Fb3e776b954216ebac21f19d4a1623889.png","speciality":null,"scoreStats":{"score":53,"votesCount":55},"rating":108.1,"relatedData":null,"contacts":[{"title":"Хабр Карьера","url":"https:\u002F\u002Fcareer.habr.com\u002Fcodedroidx","value":"codedroidx","siteTitle":null,"favicon":null},{"title":"Хабр Фриланс","url":"https:\u002F\u002Ffreelance.habr.com\u002Ffreelancers\u002Fcodedroidx","value":"codedroidx","siteTitle":null,"favicon":null},{"title":"Github","url":"https:\u002F\u002Fgithub.com\u002FCodeDruidX\u002F","value":"CodeDruidX","siteTitle":null,"favicon":null},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Ftg_droid_x","value":"tg_droid_x","siteTitle":null,"favicon":null}],"authorContacts":[{"title":"Хабр Карьера","url":"https:\u002F\u002Fcareer.habr.com\u002Fcodedroidx","value":"codedroidx","siteTitle":null,"favicon":null},{"title":"Хабр Фриланс","url":"https:\u002F\u002Ffreelance.habr.com\u002Ffreelancers\u002Fcodedroidx","value":"codedroidx","siteTitle":null,"favicon":null},{"title":"Github","url":"https:\u002F\u002Fgithub.com\u002FCodeDruidX\u002F","value":"CodeDruidX","siteTitle":null,"favicon":null},{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Ftg_droid_x","value":"tg_droid_x","siteTitle":null,"favicon":null}],"paymentDetails":{"paymentYandexMoney":null,"paymentPayPalMe":null,"paymentWebmoney":null},"donationsMethod":null},"statistics":{"commentsCount":23,"favoritesCount":113,"readingCount":6082,"score":68,"votesCount":68,"votesCountPlus":68,"votesCountMinus":0},"hubs":[{"id":"19791","alias":"ruvds","type":"corporative","title":"Блог компании RUVDS.com","titleHtml":"Блог компании RUVDS.com","isProfiled":false,"relatedData":null},{"id":"33","alias":"p2p","type":"collective","title":"Децентрализованные сети","titleHtml":"Децентрализованные сети","isProfiled":true,"relatedData":null},{"id":"359","alias":"programming","type":"collective","title":"Программирование","titleHtml":"Программирование","isProfiled":true,"relatedData":null},{"id":"17123","alias":"network_technologies","type":"collective","title":"Сетевые технологии","titleHtml":"Сетевые технологии","isProfiled":true,"relatedData":null},{"id":"21958","alias":"network_hardware","type":"collective","title":"Сетевое оборудование","titleHtml":"Сетевое оборудование","isProfiled":false,"relatedData":null}],"flows":[{"id":"1","alias":"develop","title":"Разработка","titleHtml":"Разработка"},{"id":"6","alias":"admin","title":"Администрирование","titleHtml":"Администрирование"},{"id":"7","alias":"popsci","title":"Научпоп","titleHtml":"Научпоп"}],"relatedData":null,"textHtml":"\u003Cdiv xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Fcompanies\u002Fruvds\u002Farticles\u002F761188\u002F\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fgo\u002Fc6\u002Ffb\u002Fgoc6fbxehf6l6rs6ihvnw5mmzy8.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fgo\u002Fc6\u002Ffb\u002Fgoc6fbxehf6l6rs6ihvnw5mmzy8.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nМногие, кто работают с интернет-сокетами в любой сфере IT, задаются вопросом о \u003Ci\u003Eпробросе портов\u003C\u002Fi\u003E. Связано это с тем, что практически во всех домашних\u002Fобщественных\u002Fкорпоративных роутерах реализован механизм \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FNAT\"\u003ENAT\u003C\u002Fa\u003E, который перекрывает прямой доступ к устройствам в этих подсетях извне, общаясь с внешним интернетом от их имени.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nУ NAT есть киллер-фича — он представляет собой идеальный \u003Ci\u003E\u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9C%D0%B5%D0%B6%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D0%BE%D0%B9_%D1%8D%D0%BA%D1%80%D0%B0%D0%BD\"\u003Eфаервол\u003C\u002Fa\u003E\u003C\u002Fi\u003E: атаки извне не могут использовать порты локальных устройств напрямую, следовательно, это решает проблему \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%A3%D0%B4%D0%B0%D0%BB%D1%91%D0%BD%D0%BD%D1%8B%D0%B5_%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D0%B5_%D0%B0%D1%82%D0%B0%D0%BA%D0%B8\"\u003Eатак на сетевую уязвимость ОС\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНо, это доставляет и неудобства, например, если ты захочешь подключиться или хотя бы увидеть устройство \u003Ci\u003Eза NAT\u003C\u002Fi\u003E в благих целях, то ты чисто теоретически не сможешь это сделать — \u003Ci\u003Eу него относительно тебя нет IP-адреса.\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nРазнообразные сервисы работают на серверах, т. е. имеют некую ноду, которая имеет белый адрес в интернете (находится не за NAT). Все пользователи же подключаются к этому единому серверу. В таком случае проблема «невидимости» пользователей отпадает. Однако чисто серверное взаимодействие ограничивает скорость участников, так ещё и не отказоустойчиво. Если сервер упадёт, то все клиенты отправятся за ним (считаем, что это одноклеточный сервис не на всяких там kubernetes).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nКак вы уже могли были догадаться, даже в реалиях, когда практически все устройства находятся за NATами, \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003EP2P реален\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E. Когда вы являетесь участником bittorrent-раздачи, трансфер больших данных осуществляется напрямую. Как это работает? Поиск ответа на этот вопрос завёл меня в глубокие дебри, разгребая которые я написал оверлейную \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9E%D0%B4%D0%BD%D0%BE%D1%80%D0%B0%D0%BD%D0%B3%D0%BE%D0%B2%D0%B0%D1%8F_%D1%81%D0%B5%D1%82%D1%8C\"\u003Ep2p-сеть\u003C\u002Fa\u003E, где \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FBitTorrent-%D1%82%D1%80%D0%B5%D0%BA%D0%B5%D1%80\"\u003Eтрекерами\u003C\u002Fa\u003E являются сами её участники. Интересно? Тогда добро пожаловать под кат.\u003Ca name=\"habracut\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсть концепт, использующийся во многих готовых решениях, называющийся \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003ENAT hole punching\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E. Он позволяет общаться двум устройствам, находящимся за NATами, зная лишь внешние адреса NAT друг друга. Но ведь за одним преобразователем может быть огромное количество устройств — как же тогда это возможно?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003E\u003Cfont color=\"#3AC1EF\"\u003EДисклеймер\u003C\u002Ffont\u003E\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nВ дальнейшем я буду намеренно оперировать немного искажёнными понятиями для простоты восприятия их человеком совершенно незнакомым с \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%A1%D0%B5%D1%82%D0%B5%D0%B2%D0%B0%D1%8F_%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8C_OSI\"\u003Eсетевой моделью OSI\u003C\u002Fa\u003E, транспортными протоколами и их особенностями.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nК моему удивлению, простым поиском я не нашел практически никаких исчерпывающих статей или готовых скриптов, которые бы объясняли hole punching, тем более в ru сегменте. Если же вы любите зрить в корень вопроса или считаете себя уже достаточно опытным в сетевых технологиях, могу посоветовать \u003Ca href=\"https:\u002F\u002Fbford.info\u002Fpub\u002Fnet\u002Fp2pnat\u002F\"\u003Eэтот материал (en)\u003C\u002Fa\u003E — на него опирался и я сам, когда изучал данный вопрос. Если вас действительно заинтересует этот стек после прочтения моей статьи и данного материала, то могу предложить ещё и эту весьма грамотную статью: \u003Ca href=\"https:\u002F\u002Ftailscale.com\u002Fblog\u002Fhow-nat-traversal-works\u002F\"\u003EHow NAT traversal works\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EP.S. Если же вы не уверены в своем техническом английском, то представляю вам \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F763164\u002F\"\u003Eэтот перевод\u003C\u002Fa\u003E, который я предложил написать своему более умелому в технической адаптации языка другу.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\nЭта статья, в свою очередь, призвана доказать, что с практической точки зрения с NAT hole punching всё не так запутано и сложно, как может показаться при поиске информации на эту тему.\u003Cbr\u002F\u003E\r\nБудет реализован алгоритм работы P2P сети для неограниченного количества участников, которая позволит им общаться в формате форума.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСтатья получилась немного перегруженной вложенностями (спойлерами). В противном случае это был бы отвратительный моно-лонгрид, кои я всей душой осуждаю. Теперь вы знаете, на что идёте. Удачи!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003E\u003Cfont color=\"#3AC1EF\"\u003EОглавление\u003C\u002Ffont\u003E\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ca href=\"#KNR\"\u003EКак NAT работает\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ca href=\"#UPNP\"\u003EКто такой UPnP и почему он мёртв\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"#HOLE\"\u003EПробиваем дыры в NAT\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ca href=\"#PNCH\"\u003EЕсть пробитие!\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"#STUN\"\u003EЗачем нам нужен STUN?\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"#PRJC\"\u003EПроектируем сеть\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"#FUNC\"\u003EПродумываем логику\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"#PYTH\"\u003EРеализуем\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ca href=\"#TOOL\"\u003EПишем необходимые инструменты\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"#PROT\"\u003EРеализуем протоколы взаимодействия в нашей сети\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"#UI\"\u003EВизуализация дерева и UI\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Ca href=\"#TEST\"\u003EТестируем\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E\u003Ca href=\"#CONC\"\u003EПодводим итоги\u003C\u002Fa\u003E\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Ca name=\"KNR\"\u003E\u003C\u002Fa\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9d0\u002F5cc\u002Fd7f\u002F9d05ccd7f8d094bf11c465bce5a31c35.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9d0\u002F5cc\u002Fd7f\u002F9d05ccd7f8d094bf11c465bce5a31c35.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003E\u003Cfont color=\"#3AC1EF\"\u003EМатчасть NAT\u003C\u002Ffont\u003E\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003EЕсли вы не нуждаетесь в подобном и подробном объяснении, листайте сразу до следующего заголовка.\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003ENAT\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E (от \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%90%D0%BD%D0%B3%D0%BB%D0%B8%D0%B9%D1%81%D0%BA%D0%B8%D0%B9_%D1%8F%D0%B7%D1%8B%D0%BA\"\u003Eангл.\u003C\u002Fa\u003E Network Address Translation — «преобразование сетевых адресов») — это механизм в \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9A%D0%BE%D0%BC%D0%BF%D1%8C%D1%8E%D1%82%D0%B5%D1%80%D0%BD%D0%B0%D1%8F_%D1%81%D0%B5%D1%82%D1%8C\"\u003Eсетях\u003C\u002Fa\u003E \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%A1%D1%82%D0%B5%D0%BA_%D0%BF%D1%80%D0%BE%D1%82%D0%BE%D0%BA%D0%BE%D0%BB%D0%BE%D0%B2_TCP\u002FIP\"\u003ETCP\u002FIP\u003C\u002Fa\u003E, позволяющий преобразовывать \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FIP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81\"\u003EIP-адреса\u003C\u002Fa\u003E транзитных \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9F%D0%B0%D0%BA%D0%B5%D1%82_(%D1%81%D0%B5%D1%82%D0%B5%D0%B2%D1%8B%D0%B5_%D1%82%D0%B5%D1%85%D0%BD%D0%BE%D0%BB%D0%BE%D0%B3%D0%B8%D0%B8)\"\u003Eпакетов\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fdfb\u002F6e2\u002Fdcb\u002Fdfb6e2dcbbbf0da859fb48c9b207ec44.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fdfb\u002F6e2\u002Fdcb\u002Fdfb6e2dcbbbf0da859fb48c9b207ec44.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nПростыми словами — NAT это такая программа в твоем роутере, которая позволяет тебе, будучи в его подсети, общаться с внешним миром \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003Eот имени роутера.\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E Так как у роутера \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003Eесть внешний адрес\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E, уникальный для интернета, а \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003Eу тебя его нет\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nТак выглядит твой обычный запрос до DNS Google:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7dc\u002F221\u002F10e\u002F7dc22110e3b7ebd066822f89721ff616.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F7dc\u002F221\u002F10e\u002F7dc22110e3b7ebd066822f89721ff616.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nОднако пообщаться так с компьютером друга, находящимся за своим NAT, не выйдет. Его роутер просто не может знать, кому ты адресовал пакет в его подсети, следовательно, и передавать он его никому не станет. Само собой, это можно исправить. Друг может «\u003Ci\u003Eпробросить порт\u003C\u002Fi\u003E» на своем роутере. Он зайдёт на веб-майку роутера по адресу, например \u003Ccode\u003E192.168.0.1\u003C\u002Fcode\u003E, и потыкает там кнопки по гайду для какой-нибудь игры. Это создаст для его NAT новое \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003Eправило\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E о соединении конкретного порта («логической дырки») снаружи роутера с портом конкретного компьютера за ним.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fdcc\u002Fd20\u002F948\u002Fdccd209484c3a3ae8cc4dad708bb284d.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fdcc\u002Fd20\u002F948\u002Fdccd209484c3a3ae8cc4dad708bb284d.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nУвы, это не всегда возможно. Наш условный друг может быть в кафе\u002Fобщаге\u002Fна работе (не иметь административного доступа к настройкам роутера). Для этого был придуман \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FUPnP\"\u003E\u003Cstrong\u003EUPnP\u003C\u002Fstrong\u003E\u003C\u002Fa\u003E.\u003Ca name=\"UPNP\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FUPnP\"\u003E\u003Cstrong\u003EUPnP\u003C\u002Fstrong\u003E\u003C\u002Fa\u003E-пакет — специальный запрос к роутеру, который просит его пробросить порт самостоятельно. Однако роутер должен ожидать такой запрос и быть правильно настроен. Но технология эта не прижилась в массах. Постоянно включенный UPnP на роутере даёт пользователям возможность сделать сеть уязвимой, так что он отключен по умолчанию практически на всех маршрутизаторах с завода -\u003E он не является универсальным решением.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EСкорее всего, UPnP отключен на вашем роутере, что не мешает работать торрент-клиентам.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F926\u002Ffd0\u002F9a6\u002F926fd09a660ca1bacfa93c7b3f18ca00.png\" align=\"left\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F926\u002Ffd0\u002F9a6\u002F926fd09a660ca1bacfa93c7b3f18ca00.png\"\u002F\u003EДля решения этой задачи нужно присмотреться к самому NAT.\u003Cbr\u002F\u003E\r\nВот, он замаскировал твой пакет под пакет твоего роутера и отправил его наружу, верно?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНо когда ты делаешь запрос к Google (пару иллюстраций назад), твой компьютер ведь получает ответ от него — значит NAT может работать и в обратную сторону?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДело в том, что NAT оставляет лазейку для получения ответа.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EЛазейкой или дыркой я далее буду называть сессию NAT для примитивности объяснения.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e1\u002Fe0e\u002F813\u002F6e1e0e81328a8ae4818cd8ffd87f7134.png\" align=\"left\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F6e1\u002Fe0e\u002F813\u002F6e1e0e81328a8ae4818cd8ffd87f7134.png\"\u002F\u003EПо сути это временный проброс порта до твоего компьютера, однако с ограничением: проброс сработает только для пакетов, отправленных с того же адреса, на который был отправлен твой пакет-инициатор проброса.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДругими словами, в нашем примере пробросом может пользоваться только Google, для которого ты сам по сути открыл эту дыру, отправив ему исходящий пакет.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЭто и есть сессия NAT. На самом деле, много описанное мной здесь будет актуально для большинства существующих на данный момент спецификаций трансляции, но исключения всё же имеются. Вдаваться в подробности я не стану, скажу лишь, что описанный далее способ будет точно актуален для большинства провайдеров (и даже операторов мобильной связи!).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EКстати, NAT может быть в подсети другого NAT и подобная вложенность может содержать сколь угодно уровней (см. \u003Ca href=\"https:\u002F\u002Fen.m.wikipedia.org\u002Fwiki\u002FCarrier-grade_NAT\"\u003ECG-NAT\u003C\u002Fa\u003E).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОднако это тоже не должно стать проблемой для описанного далее метода.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Ca name=\"HOLE\"\u003E\u003C\u002Fa\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd54\u002Fab6\u002Fe9c\u002Fd54ab6e9cb36f45ca8feb98bef4b8a46.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fd54\u002Fab6\u002Fe9c\u002Fd54ab6e9cb36f45ca8feb98bef4b8a46.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003E\u003Cfont color=\"#3AC1EF\"\u003EПробиваем дыры в NAT\u003C\u002Ffont\u003E\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nВ нашем примере Google имел статичный белый адрес с заранее проброшенным портом. Но как заставить таким образом соединиться два устройства за NATами?\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F94e\u002F048\u002F8e7\u002F94e0488e73dada360316e8d4639f297e.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F94e\u002F048\u002F8e7\u002F94e0488e73dada360316e8d4639f297e.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПопробуем что-то сделать, основываясь на имеющихся у нас данных…\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EТы отправляешь пакет на белый адрес роутера друга, он транслируется NAT и исходит из порта на твоем роутере №X (ты его не знаешь!).\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003EПакет разбивается о железный файрвол роутера друга снаружи.\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003EТуннель временно поднят на твоём внешнем порту X, но его номер никто не знает.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\nСитуация кажется тупиковой, но есть ещё одна интересная способность сессии, созданной в NAT — если сейчас сессия настроена, например, на приём от google.com во внешний порт роутера X, то ты можешь послать изнутри пакет, используя \u003Ci\u003Eэту же сессию\u003C\u002Fi\u003E на другой адрес (допустим, \u003Ccode\u003E123.123.123.123\u003C\u002Fcode\u003E). Сессия изменит настройки и станет принимать пакеты от него, при этом приходить они будут всё ещё в старый порт на локальном компьютере.\u003Cbr\u002F\u003E\r\n\u003Ca name=\"PNCH\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nПредставим себе некий адрес \u003Ccode\u003E1.2.3.4\u003C\u002Fcode\u003E, видимый из интернета, и готовый принимать подключения.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003EТы отправляешь пакет на \u003Ccode\u003E1.2.3.4\u003C\u002Fcode\u003E, создавая тем самым сессию, открытую на внешнем порту X.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E1.2.3.4 видит твой внешний порт X, когда принимает пакет (друг не видел, ведь пакет не дошёл).\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EВладелец \u003Ccode\u003E1.2.3.4\u003C\u002Fcode\u003E неким образом сообщает тебе твой внешний порт данной сессии X.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EТы отправляешь пакет на адрес друга, используя тот же локальный порт на ПК, что и для пакета к \u003Ccode\u003E1.2.3.4\u003C\u002Fcode\u003E. Это заставляет пакет идти через уже имеющуюся сессию NAT.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EТвоя сессия NAT теперь будет принимать пакеты не от \u003Ccode\u003E1.2.3.4\u003C\u002Fcode\u003E, а от твоего друга.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003EПакет разбивается о железный файрвол роутера друга снаружи.\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003EКажется, что всё как в прошлой попытке, однако сейчас мы знаем X за счёт помощи от \u003Ccode\u003E1.2.3.4\u003C\u002Fcode\u003E,\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EДруг делает эти же шаги, но уже обращаясь к нашему адресу в порт X, который будет открыт вместе с сессией NAT ещё несколько секунд и настроен на приём пакетов от друга (в шаге 5).\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003EПакет друга доходит до нашего локального компьютера!\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E\u003C\u002Fli\u003E\r\n\u003Cli\u003EМы видим внешний порт друга Y (аналогично X) в заголовке полученного пакета и теперь можем общаться в обе стороны сквозь трансляторы. Победа!\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Ca name=\"STUN\"\u003E\u003C\u002Fa\u003EОсталось найти готового к благим делам \u003Ccode\u003E1.2.3.4\u003C\u002Fcode\u003E, и, удивительно, он существует. И зовут этих добряков \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003ESTUN\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E-серверами.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FSTUN\"\u003E\u003Cstrong\u003ESTUN-сервер\u003C\u002Fstrong\u003E\u003C\u002Fa\u003E - это сервер, который отвечает на все входящие пакеты адресом и портом X, из которого они были отправлены. Это позволяет определить свой внешний \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002FIP-%D0%B0%D0%B4%D1%80%D0%B5%D1%81\"\u003EIP-адрес\u003C\u002Fa\u003E и внешний порт X своей сессии NAT.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nИх есть великое множество в открытом доступе, и составить запрос к любому из них не составляет проблемы — это мы ещё реализуем. Тут можно найти актуальный список открытых url, на которых подняты STUN: \u003Ca href=\"https:\u002F\u002Fgist.github.com\u002Fmondain\u002Fb0ec1cf5f60ae726202e\"\u003Ehttps:\u002F\u002Fgist.github.com\u002Fmondain\u002Fb0ec1cf5f60ae726202e\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nМы будем использовать \u003Ca href=\"http:\u002F\u002Fstun.ekiga.net\u002F\"\u003Estun.ekiga.net\u003C\u002Fa\u003E, но чуть позже.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EМой скромный гайд по данной технологии на этом подходит к концу — далее идёт проектирование и написание конкретного кейса. \u003Ca name=\"PRJC\"\u003E\u003C\u002Fa\u003EПовторюсь, что если вы осознали вышесказанное без особых проблем или просто хотите знать больше нюансов, то вам \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F763164\u002F\"\u003Eсюда\u003C\u002Fa\u003E.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003E\u003Cfont color=\"#3AC1EF\"\u003EТопология сети\u003C\u002Ffont\u003E\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nНаша \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9E%D0%B2%D0%B5%D1%80%D0%BB%D0%B5%D0%B9%D0%BD%D0%B0%D1%8F_%D1%81%D0%B5%D1%82%D1%8C\"\u003Eоверлейная сеть\u003C\u002Fa\u003E будет представлять из себя неограниченное количество нод, соединённых друг с другом посредством udp-туннелей, созданных между их NAT.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nСеть \u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003EНЕ\u003C\u002Ffont\u003E\u003C\u002Fb\u003E будет анонимной, так как сторонний наблюдатель может \u003Ci\u003Eотследить первоисточник\u003C\u002Fi\u003E сообщения, если, конечно, наблюдал за сетью достаточно долго.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EОднако идея схожа с задачей на базе очередей\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5ac\u002F41b\u002Fec1\u002F5ac41bec16497fec1fbdd48eb7815187.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F5ac\u002F41b\u002Fec1\u002F5ac41bec16497fec1fbdd48eb7815187.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЕсли вкратце, мы моментально обрабатываем всё, что приходит нам, но отправляем сообщения только раз в некоторый период T. Если отправлять по одному сообщению сразу всем (пусть даже с мусором), и так будут делать все участники сети, то факт и момент передачи чего-либо не будет известен стороннему наблюдателю.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cstrong\u003EМусорный (ложный) трафик\u003C\u002Fstrong\u003E является неотъемлемой частью теоретически доказуемых анонимных сетей.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОригинал: \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F753902\u002F\"\u003Ehttps:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F753902\u002F\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nТаким образом, наша сеть могла бы быть анонимной, если бы каждая нода, помимо полезного трафика слала ещё и мусор всем, но я, пожалуй, откажусь от данной условности в угоду разгрузки канала, но и \u003Ci\u003Eне стану называть сеть анонимной\u003C\u002Fi\u003E.\u003Ca name=\"FUNC\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003E\u003Cfont color=\"#3AC1EF\"\u003EМаршрутизация\u003C\u002Ffont\u003E\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nДля полной автономности и децентрализованности сети я не стану использовать выделенные серверы, трекеры и т. д. Изначальная идея такова, что все участники равноправны, и никакое третье лицо с белым адресом им не нужно (кроме STUN).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПредположим, что есть две ноды \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(I)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E и \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(II)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E, они обмениваются информацией, в том числе списками своих подключений. В это же время активна некая нода\u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E (III)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E, которая оказалась подключённой к \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(I)\u003Cbr\u002F\u003E\r\n\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E. Нода \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(II) \u003C\u002Ffont\u003E\u003C\u002Fstrong\u003Eузнала от\u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E (I), \u003C\u002Ffont\u003E\u003C\u002Fstrong\u003Eчто есть некая\u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E (III).\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E Стабилизация сети будет происходить при помощи взаимной маршрутизации. Дальнейшие действия можно описать простой схемой.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F034\u002F2a4\u002F6bc\u002F0342a46bc10d56745bbd8979638b4e41.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F034\u002F2a4\u002F6bc\u002F0342a46bc10d56745bbd8979638b4e41.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003E0. Пассивный обмен информацией и списками подключений — будет иллюстрирован позже.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E1. \u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003E(II)\u003C\u002Ffont\u003E\u003C\u002Fb\u003E отправляет запрос на установление соединения к \u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003E(III)\u003C\u002Ffont\u003E\u003C\u002Fb\u003E, но не может это сделать напрямую, и просит об этом \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(I)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003E2. \u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003E(I)\u003C\u002Ffont\u003E\u003C\u002Fb\u003E перенаправляет этот запрос.\u003C\u002Fli\u003E\r\n\u003Cli\u003E3. \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(III)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E получает запрос и инициализирует HOLE PUNCH к \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(II)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E, однако пробрасывается новый случайный порт и его пока не знает \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(II)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E, зато сам \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(III)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E узнал его от STUN.\u003C\u002Fli\u003E\r\n\u003Cli\u003E4. \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(III) \u003C\u002Ffont\u003E\u003C\u002Fstrong\u003Eотправляет ответ на запрос \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(II)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E с актуальным PUNCHED-портом, перенаправляя его через \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(I)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E.\u003C\u002Fli\u003E\r\n\u003Cli\u003E5. \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(I)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E перенаправляет этот ответ.\u003C\u002Fli\u003E\r\n\u003Cli\u003E6. \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(II)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E получает ответ и инициализирует HOLE PUNCH к \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(III) \u003C\u002Ffont\u003E\u003C\u002Fstrong\u003Eна известный порт, полученный в ответе, таким образом, порты взаимно проброшены.\u003C\u002Fli\u003E\r\n\u003Cli\u003E7. Теперь \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(III)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E имеет полноправное соединение с \u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E(II)\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E, и начинается пассивный обмен информацией, как в шаге\u003Cstrong\u003E\u003Cfont color=\"#3AC1EF\"\u003E 0\u003C\u002Ffont\u003E\u003C\u002Fstrong\u003E.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EЕсть правда один нюанс — к такой сети невозможно легко присоединиться извне. Вся она основана на взаимных подключениях. Следовательно, если ты хочешь войти в сеть, ты должен найти кого-то, кто уже в ней состоит, и в ручном режиме соединиться с ним (по взаимному согласию). Далее всё сработает автоматически по схеме, приведённой выше.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E\u003Cfont color=\"#3AC1EF\"\u003EЧто мы имеем?\u003C\u002Ffont\u003E\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nМы получили теоретически рабочую оверлейную сеть, где устройства могут общаться друг с другом без каких-либо препятствий, как если бы они находились в одной LAN (за исключением свободы выбора порта).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПринцип обмена сообщениями\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EКаждое сообщение является обычной строкой.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EКаждое сообщение имеет известный и однозначный \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%A5%D0%B5%D1%88-%D1%84%D1%83%D0%BD%D0%BA%D1%86%D0%B8%D1%8F\"\u003Eхеш\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EReply на чужое сообщение осуществляется по его хешу.\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EПолучается некое подобие \u003Ca href=\"https:\u002F\u002Fhabr.com\u002Fru\u002Farticles\u002F127864\u002F\"\u003ELinkedList \u003C\u002Fa\u003Eили \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%91%D0%BB%D0%BE%D0%BA%D1%87%D0%B5%D0%B9%D0%BD\"\u003Eблокчейна\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EВесь форум — это один большой python \u003Ca href=\"https:\u002F\u002Fpython-scripts.com\u002Fsets\"\u003Eset (aka множество)\u003C\u002Fa\u003E:\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EДвух одинаковых сообщений быть не может.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EКаждый участник синхронизирует свое множество с чужими.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EСтруктуру форума можно визуализировать как дерево, где узлы это сообщения.\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EОтвечая на чужое сообщение, ты создаешь новую ветку от него.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003EПродолжая цепочку ответов, ты удлиняешь одну из веток.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003EПоскольку каждый участник хранит у себя свою версию содержимого форума, им нужно как-то договариваться об истинной версии. Но, тут всё просто: \u003Ci\u003Eистинная версия\u003C\u002Fi\u003E набора сообщений — это \u003Ci\u003Eта, которая больше\u003C\u002Fi\u003E. Другими словами, если у кого-то из твоих соседей имеются сообщения, которых нет у тебя, то ты должен их скачать и дописать себе.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F003\u002F2f6\u002F928\u002F0032f69289df30917cefdc741fe8b91f.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F003\u002F2f6\u002F928\u002F0032f69289df30917cefdc741fe8b91f.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Ci\u003E\u003Cfont color=\"#999999\"\u003EПримерная схема синхронизации данных\u003C\u002Ffont\u003E\u003C\u002Fi\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EКаждый участник хранит сет сообщений и информацию о существующих сессиях.\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\nПодбираясь к реализации, скажу, что можно просто \u003Ci\u003Eсуммировать свой сет сообщений с чужим\u003C\u002Fi\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНе забываем, что сессия NAT умрёт, если через неё несколько минут не будут передаваться данные, так что нужна будет пассивная отправка Keep Alive-пакетов.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНа этом можно закончить планирование и перейти к написанию \u003Ca href=\"https:\u002F\u002Fru.wikipedia.org\u002Fwiki\u002F%D0%9F%D1%80%D0%BE%D0%B2%D0%B5%D1%80%D0%BA%D0%B0_%D0%BA%D0%BE%D0%BD%D1%86%D0%B5%D0%BF%D1%86%D0%B8%D0%B8\"\u003EProof of Concept\u003C\u002Fa\u003E-инструментов на Python для подтверждения теории практикой.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv style=\"text-align:center;\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F24d\u002Feb3\u002F40a\u002F24deb340a3da19493ffb7f1bc2c190c9.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F24d\u002Feb3\u002F40a\u002F24deb340a3da19493ffb7f1bc2c190c9.png\"\u002F\u003E\u003C\u002Fdiv\u003E\u003Ca name=\"PYTH\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003E\u003Cfont color=\"#3AC1EF\"\u003EРеализация на Python\u003C\u002Ffont\u003E\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\nЗаранее прошу прощения у всех, кто читает с телефона. Весь код проекта вышел достаточно массивным, так что я не смогу комментировать каждую строку отдельно. Будут приводиться логически разделённые куски, которые будет не очень удобно анализировать целиком через маленькое окошко фрейма с кодом по центру вашего небольшого экрана.\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EИмпорт библиотек, логгер и небольшие формальности\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Efrom pathlib import Path\nimport time\nimport os\nimport sys\n\n\ndef cls():\n    os.system(\"cls\" if os.name == \"nt\" else \"clear\")\n\n\ntry:\n    scriptname = Path(__file__).name\nexcept:\n    scriptname = \"CnC.py\"\ntry:\n    verfrom = time.ctime(os.path.getmtime(__file__))\nexcept:\n    verfrom = \"!No time!\"\n\n\nimport threading\nimport socket\nimport random\nimport hashlib\nimport json\nimport logging\nimport pdb\n\n\nclass Debug(pdb.Pdb):\n    def __init__(self, *args, **kwargs):\n        super(Debug, self).__init__(*args, **kwargs)\n        self.prompt = \"CnC Debug Shell \u003E\u003E\u003E \"\n\n    def shell(self):\n        self.set_trace()\n\n\ndebug = Debug()\n# logging.warn(f\"Event logging is enabled. You can see it in {scriptname}.log\")\nlogging.basicConfig(\n    format=\"%(asctime)s %(message)s\", level=logging.DEBUG, filename=f\"{scriptname}.log\"\n)\nlogging.info(\"Hello world!\")\nlogging.getLogger().setLevel(logging.DEBUG)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Ca name=\"TOOL\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nТеперь нужно подготовить простые функции для упрощения дальнейшей жизни:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef dat_to_bytes(diction: dict) -\u003E bytes:\n    return json.dumps(diction).encode(\"cp866\")\n\n\ndef bytes_to_dat(byte: bytes) -\u003E dict:\n    return json.loads(byte.decode(\"cp866\"))\n\n\ndef checksum(b):\n    return hashlib.blake2s(b, digest_size=4).hexdigest()\n\n\n_alreadyused = set()\n\n\ndef randomport():\n    global _alreadyused\n    p = random.randint(16000, 65535)\n    while p in _alreadyused:\n        p = random.randint(16000, 65535)\n    _alreadyused.update({p})\n    return p\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПервые две превращают словарь в байты, и обратно.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДалее идёт взятие хэша и функция, дающая каждый раз уникальный порт.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nФункция STUN() принимает локальный порт как обязательный аргумент и отправляет из него STUN request на сервер \u003Ca href=\"http:\u002F\u002Fstun.ekiga.net\u002F\"\u003Estun.ekiga.net\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЗапрос представляет из себя фиксированную последовательность байт, так что я не вдаваясь в подробности дампнул его из \u003Ca href=\"https:\u002F\u002Fwww.wireshark.org\"\u003EWireshark\u003C\u002Fa\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВозвращает функция тот самый порт X из начала статьи.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef STUN(port, host=\"stun.ekiga.net\"):\n    logging.debug(f\"STUN request via {host}\")\n    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    sock.bind((\"0.0.0.0\", port))\n    sock.setblocking(0)\n    server = socket.gethostbyname(host)\n    work = True\n    while work:\n        sock.sendto(\n            b\"\\x00\\x01\\x00\\x00!\\x12\\xa4B\\xd6\\x85y\\xb8\\x11\\x030\\x06xi\\xdfB\",\n            (server, 3478),\n        )\n        for i in range(20):\n            try:\n                ans, addr = sock.recvfrom(2048)\n                work = False\n                break\n            except:\n                time.sleep(0.01)\n\n    sock.close()\n    return socket.inet_ntoa(ans[28:32]), int.from_bytes(ans[26:28], byteorder=\"big\")\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EПара вспомогательных функций для кодировки ip:port в одно число\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef addr2int(ip, port: int):\n    binport = bin(port)[2:].rjust(16, \"0\")\n    binip = \"\".join([bin(int(i))[2:].rjust(8, \"0\") for i in ip.split(\".\")])\n    return int(binip + binport, 2)\n\n\ndef int2addr(num):\n    num = bin(num)[2:].rjust(48, \"0\")\n    print(num)\n    num = [\n        str(int(i, 2))\n        for i in [num[0:8], num[8:16], num[16:24], num[24:32], num[32:48]]\n    ]\n    return \".\".join(num[0:4]), int(num[4])\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nDump и Load будут сохранять\u002Fзагружать текущий чекпоинт сети:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef data_dump():\n    with open(f\"{scriptname}.chat-savefile.json\", \"w\") as f:\n        json.dump(data, f)\n\n\ndef data_load():\n    global data\n    try:\n        with open(f\"{scriptname}.chat-savefile.json\", \"r\") as f:\n            data = json.load(f)\n    except:\n        logging.error(f\"No save file exists! New one created\")\n        with open(f\"{scriptname}.chat-savefile.json\", \"w\") as f:\n            json.dump({}, f)\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E\u003Cfont color=\"#3AC1EF\"\u003E▍ Основной код ноды\u003C\u002Ffont\u003E\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nКласс, описывающий поведение сессии с другой нодой:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eclass Session:\n    def __init__(self):\n        # self.prefix=\"IDL\"\n        self.immortal = False\n        self.local_port = randomport()\n        for i in range(10):\n            self.public_ip, self.public_port = STUN(self.local_port)\n        self.socket = None\n        self.client = None\n        self.thread = None\n        logging.info(f'\"{self.public_ip}\",{self.public_port}')\n\n    def make_connection(self, ip, port, timeout=10):\n        logging.debug(f\"Start waiting for handshake with {ip}:{port}\")\n        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n        sock.bind((\"0.0.0.0\", self.local_port))\n        sock.setblocking(0)\n        while True:\n            sock.sendto(b\"Con. Request!\", (ip, port))\n            time.sleep(2)\n            try:\n                ans, addr = sock.recvfrom(9999)\n                sock.sendto(b\"Con. Request!\", (ip, port))\n                sock.close()\n                sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n                sock.bind((\"0.0.0.0\", self.local_port))\n                sock.setblocking(0)\n                self.client = (ip, port)\n                self.socket = sock\n                logging.debug(f\"Hole with {self.client} punched!\")\n                break\n            except Exception as e:\n                assert timeout \u003E 0\n                timeout -= 1\n                logging.debug(f\"No handshake with {ip}:{port} yet...\")\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nИз важного — тут происходит стабилизация туннеля в NAT. Вам может резать глаза строка \u003Ccode\u003Efor i in range(10): self.public_ip, self.public_port = STUN(self.local_port)\u003C\u002Fcode\u003E, которая повторяет запрос к STUN 10 РАЗ. Это является вынужденным костылём для увеличения срока жизни NAT-сессии, ведь зачастую роутеры создают её с небольшим временем жизни (порядка 10 секунд) и вы с «другом» можете просто не успеть синхронизировать подключения. При этом таймаут до смерти сессии растёт при прохождении через неё пакетов, для этого, собственно, и нужен спам STUN-запросами. \u003Ca name=\"PROT\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E\u003Cfont color=\"#3AC1EF\"\u003E▍ Протоколы\u003C\u002Ffont\u003E\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\nДальше случится очень много кода — это реализация описанных в первой части статьи механизмов взаимодействия между клиентами.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nВведу такое понятие, как «протокол». Определяться он будет первыми 3 байтами UDP-пакета и определять, с какой целью оно было нам отправлено.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EРеализация протоколов\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cblockquote\u003E\u003Cb\u003EВнимание\u003C\u002Fb\u003E: \u003Ci\u003EВпереди может быть очень длинный if-elif-else, который можно было бы заменить на match или замутить нечто высокоуровневое, масштабируемое и абстрактное. Как вы уже могли догадаться, автор не стал этого делать...\u003C\u002Fi\u003E\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\nОписываем цикл жизни ноды:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef backlife_cycle(self, freq=1):\n    global sessions\n    if self.immortal:\n        logging.warning(f\"{self.client} session beacame immortal\")\n        self.life_cycle = aegis(self.life_cycle)\n    th = threading.Thread(target=self.life_cycle, args=(freq,))\n    th.start()\n    self.thread = th\n    logging.warning(f\"Session with {self.client} stabilized!\")\n    # sessions.append(self)\n\ndef life_cycle(self, freq=1):\n    global data\n    global sessions\n    global pool\n    c = 0\n    while 1:\n        if len(pool):\n            pref = pool.pop(0)\n        else:\n            pref = b\"KPL\"\n\n        self.socket.sendto(pref, self.client)  # Keep-alive\n        time.sleep(max(random.gauss(1 \u002F freq, 3), 0))\n\n        while True:\n            try:\n                ans, reply_addr = self.socket.recvfrom(9999)\n                logging.debug(\n                    f\"{self.client[0]}: Recieved {ans[:3].decode('cp866')} from {reply_addr}: {ans}\"\n                )\n            except:\n                break\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nКаждая итерация её жизненного цикла отправляет KPL (Keep Alive) пакет. Теперь опишем поведение при получении KPL-пакета.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНа каждый из них нам реагировать, само собой, не стоит.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cul\u003E\r\n\u003Cli\u003EРаз в 10 полученных KPL мы будем запрашивать синхронизацию датасетов. \u003C\u002Fli\u003E\r\n\u003Cli\u003EРаз в 33 полученных KPL мы будем запрашивать синхронизацию подключений.\u003C\u002Fli\u003E\r\n\u003C\u002Ful\u003E\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eif ans[:3] == b\"KPL\":\n    c += 1\n    if c % 10 == 0:\n        logging.debug(\n            f\"{self.client[0]}: Requesting Datagram     {c\u002F\u002F10}\"\n        )\n        self.socket.sendto(b\"RQD\", self.client)\n        c += 1\n    elif c % 33 == 0:\n        logging.debug(\n            f\"{self.client[0]}: Requesting Session List {c\u002F\u002F33}\"\n        )\n        self.socket.sendto(b\"RQS\", self.client)\n        c += 1\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПоротоколы, необходимые для частичной синхронизации при помощи сравнения хешей.\u003Cbr\u002F\u003E\r\nПо умолчанию я их не использовал, так как мои тесты не заходили дальше 4 устройств и десятка сообщений. Не могу быть уверен, что они отказоустойчивы, так что пока они отключены.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E\n# ----------------------------------------Hashes (keys) sync (disabled now)----------------------------------------\nelif ans[:3] == b\"RQH\":\n    logging.debug(f\"{self.client[0]}: Sending hashes\")\n    self.socket.sendto(\n        b\"HAS\" + dat_to_bytes(list(data.keys())), self.client\n    )\n\nelif ans[:3] == b\"HAS\":\n    missed_messages.update(\n        set(bytes_to_dat(ans[3:])) - set(data.keys())\n    )\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nНепосредственно протоколы синхронизации сообщений:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E# ----------------------------------------Data sync----------------------------------------\nelif ans[:3] == b\"RQD\":\n    if ans[3:] != b\"\":\n        logging.debug(f\"{self.client[0]}: Sending specific datagram\")\n        n = {}\n        r = set(bytes_to_dat(ans[3:]))\n        for i in r:\n            if i in data:\n                n.update({i: data[i]})\n        logging.debug(f\"{self.client[0]}: Sending {n}\")\n        self.socket.sendto(b\"DAT\" + dat_to_bytes(n), self.client)\n    else:\n        logging.debug(f\"{self.client[0]}: Sending datagram\")\n        self.socket.sendto(b\"DAT\" + dat_to_bytes(data), self.client)\n\nelif ans[:3] == b\"DAT\":\n    data.update(bytes_to_dat(ans[3:]))\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nОбмен списками подключений и подключение к ещё одному случайному участнику, с которым у нас пока нет сессии:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E# ----------------------------------------IP list sync-------------------------------------\nelif ans[:3] == b\"RQS\":\n    logging.debug(f\"{self.client[0]}: Sending Session List\")\n    sess = [i.client[0] if i.client else None for i in sessions]\n    sess = set(sess)\n    sess = sess - {None}\n    sess = list(sess)\n    sess.remove(self.client[0])\n    self.socket.sendto(b\"SES\" + dat_to_bytes(sess), self.client)\n\nelif ans[:3] == b\"SES\":\n    sess = [i.client[0] if i.client else None for i in sessions]\n    sess = set(sess)\n    sess = sess - {None}\n    logging.debug(\n        f\"{self.client[0]}: My sessions: {sess} Recieved: {set(bytes_to_dat(ans[3:]))} New: {list(set(bytes_to_dat(ans[3:]))-sess)}\"\n    )\n    uncon = list(set(bytes_to_dat(ans[3:])) - sess)\n    if not uncon:\n        continue\n    adr = random.choice(uncon)\n    s = Session()\n    sessions.append(s)\n    self.socket.sendto(\n        b\"HOP\"\n        + socket.inet_aton(adr)\n        + b\"CON\"\n        + s.public_ip.encode(\"cp866\")\n        + b\":\"\n        + str(s.public_port).encode(\"cp866\"),\n        self.client,\n    )\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nДля маршрутизации внутри сети я использую протокол, который назвал HOP. Он предпологает, что каждый готов послужить ретранслятором для другого.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nДопустим, есть пакет \u003Cb\u003EX\u003C\u002Fb\u003E, в котором есть заголовок (id протокола) и данные. \u003Cbr\u002F\u003E\r\nМы хотим его отправить на \u003Ccode\u003E2.2.2.2\u003C\u002Fcode\u003E, но не имеем с ним сессии. Для этого мы узнаём, кто же с ним эту самую сессию имеет (допустим \u003Ccode\u003E3.3.3.3\u003C\u002Fcode\u003E). Мы отправляем к \u003Ccode\u003E3.3.3.3\u003C\u002Fcode\u003E пакет с таким содержанием: \u003Ccode\u003EHOP+2.2.2.2+X\u003C\u002Fcode\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nОписываем принцип работы HOP:\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E# ----------------------------------------HOP Tracking-------------------------------------\nelif ans[:3] == b\"HOP\":\n    sess = [i.client[0] if i.client else None for i in sessions]\n\n    ip = socket.inet_ntoa(ans[3:7])\n    if ip in sess:\n        s = sessions[sess.index(ip)]\n        s.socket.sendto(ans[7:], s.client)\n\nelif ans[:3] == b\"CON\":\n    s = Session()\n    adr, prt = ans[3:].decode(\"cp866\").split(\":\")\n    self.socket.sendto(\n        b\"HOP\"\n        + socket.inet_aton(adr)\n        + b\"RDY\"\n        + prt.encode(\"cp866\")\n        + b\":\"\n        + s.public_ip.encode(\"cp866\")\n        + b\":\"\n        + str(s.public_port).encode(\"cp866\"),\n        self.client,\n    )\n    try:\n        s.make_connection(adr, int(prt))\n        s.backlife_cycle(1)\n        sessions.append(s)\n    except:\n        logging.error(f\"{self.client[0]}: Connect initiation timeout!\")\n\nelif ans[:3] == b\"RDY\":\n    myprt, adr, prt = ans[3:].decode(\"cp866\").split(\":\")\n    sess = [i.public_port for i in sessions]\n\n    if int(myprt) in sess:\n        s = sessions[sess.index(int(myprt))]\n        try:\n            s.make_connection(adr, int(prt))\n            s.backlife_cycle(1)\n        except:\n            logging.error(\n                f\"{self.client[0]}: Connect stabilization timeout!\"\n            )\n            sessions.remove(s)\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПоследний блок кода — отключенный механизм трекинга, который я писал до того, как придумал HOP. Извиняюсь за то, что вы его тут видите)\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E# ----------------------------------------Disabled Trash-----------------------------------\nelif ans[:3] == b\"TRK\":\n    adr, prt = ans[3:].decode(\"cp866\").split(\",\")\n    sess = [i.client[0] for i in sessions]\n    sess.remove(self.client[0])\n    s = sessions[sess.index(adr)]\n\n    s.socket.sendto(\n        b\"CN0\"\n        + f\"{self.client[0].encode('cp866')}:{prt.encode('cp866')}\",\n        s.client,\n    )\n\nelif ans[:3] == b\"CN0\":\n    s = Session()\n    self.socket.sendto(\n        b\"CN1\"\n        + f\"{s.public_ip.encode('cp866')}:{str(s.public_port).encode('cp866')}\",\n        self.client,\n    )\n    adr, prt = ans[3:].decode(\"cp866\").split(\":\")\n    s.make_connection(adr, int(prt))\n    sessions.append(s)\nelif ans[:3] == b\"TRK\":\n    pass\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nЗакрываем врата в ад из бесконечного \u003Cb\u003Eelif\u003C\u002Fb\u003E, обрабатывая любой мусор, который мы можем случайно получить при помощи \u003Cb\u003Eelse\u003C\u002Fb\u003E.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Eelse:\n    logging.warning(f\"{self.client[0]}: Malformed! !!!{ans}!!!\")\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Ci\u003EВ сухом остатке:\u003C\u002Fi\u003E в этом сниппете обрабатываются протоколы взаимодействия, такие как:\u003Cbr\u002F\u003E\r\n\u003Col\u003E\r\n\u003Cli\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003EKPL \u003C\u002Ffont\u003E\u003C\u002Fb\u003E — Keep Alive\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003ERQH \u003C\u002Ffont\u003E\u003C\u002Fb\u003E — Request hashes\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003EHAS \u003C\u002Ffont\u003E\u003C\u002Fb\u003E — Пакет с хэшами\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003ERQD \u003C\u002Ffont\u003E\u003C\u002Fb\u003E — Request dataset\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003EDAT \u003C\u002Ffont\u003E\u003C\u002Fb\u003E — пакет с сообщениями\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003ERQS \u003C\u002Ffont\u003E\u003C\u002Fb\u003E — Request Sessions\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003ESES \u003C\u002Ffont\u003E\u003C\u002Fb\u003E — пакет с сессиями\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003EHOP \u003C\u002Ffont\u003E\u003C\u002Fb\u003E — Заголовок, который означает, что пакет нужно перенаправить (после него идёт адрес и любой другой пакет)\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003ECON \u003C\u002Ffont\u003E\u003C\u002Fb\u003E — Запрос подключения\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003Cli\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003ERDY \u003C\u002Ffont\u003E\u003C\u002Fb\u003E — Ответ о готовности к взаимному подключению\u003Cbr\u002F\u003E\r\n\u003C\u002Fli\u003E\r\n\u003C\u002Fol\u003E\u003Cbr\u002F\u003E\r\n\u003Ch3\u003E\u003Cfont color=\"#3AC1EF\"\u003E▍ Интерфейс\u003C\u002Ffont\u003E\u003C\u002Fh3\u003E\u003Cbr\u002F\u003E\r\n\u003Ca name=\"UI\"\u003E\u003C\u002Fa\u003EТеперь осталось завернуть этот функционал в красивый консольный интерфейс и по максимуму убрать ручной ввод кода пользователем.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EКод милого интерфейса и визуализации сообщений в виде дерева\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003EДля начала выведем пользователю базовую информацию. Делаем что-то вроде экрана загрузки.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003Edef silent():\n    logging.disable()\n\n\nlogging.warning(\n    f\"Logger for DEBUG is running! to diable it run {scriptname.split('.')[0]}.silent()\"\n)\nprint(\n    f\" Welcome to {scriptname} version from {verfrom} - event logging here: {scriptname}.log\"\n)\nprint(\n    f\"   Your Python version is {'.'.join([str(i) for i in sys.version_info[0:3]])}, branch {sys.version_info[3].upper()}\"\n)\ntry:\n    c = STUN(12346)\n    print(f\"     Internet connection is stable on {socket.gethostname()}!\")\n    if 1:\n        import requests\n\n        r2 = requests.get(f\"http:\u002F\u002Fipinfo.io\u002F{c[0]}\").json()[\"org\"]\n        print(\n            f\"       Gray  (local)  IP is {socket.gethostbyname(socket.gethostname())}\"\n        )\n        print(f\"       While (public) IP is {c[0]} - {r2}\")\n    else:\n        print(\n            f\"       Gray  (local)  IP is {socket.gethostbyname(socket.gethostname())}\"\n        )\n        print(f\"       While (public) IP is {c[0]}\")\nexcept Exception as e:\n    logging.critical(e)\n    print(f\" No internet connection found! I cant work offline!\")\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nФункция для рекурсивного отображения нашей структуры (дерева):\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E\nimport re\n\ndef get_tree(data):\n    data = data.copy()\n    data.update({\"00000000\": \"Root\"})\n    # data.update({\"11111111\":\"Root\"})\n    data.update({\"ffffffff\": \"Lost\"})\n    dct = {}\n\n    for key, message in data.items():\n        if key + \": \" + message not in dct:\n            dct.update({key + \": \" + message: []})\n\n    for key, message in data.items():\n        rep = [i[1:] for i in re.findall(\"@+[a-z0-9]{8}\", message)]\n\n        if len(rep) \u003E 0:\n            rep = rep[0]\n        else:\n            rep = \"00000000\"\n\n        if rep not in data:\n            rep = \"ffffffff\"\n        if rep + \": \" + data[rep] in dct:\n            dct[rep + \": \" + data[rep]].append(key + \": \" + message)\n        else:\n            pass\n            # dct.update({rep+\": \"+data[rep]:[key+\": \"+message]})\n    # print(dct)\n    dct[\"00000000: Root\"].remove(\"00000000: Root\")\n    for k, v in list(dct.items()).copy():\n        if v == []:\n            dct.pop(k)\n    return dct\n\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nПишем \u003Cb\u003EMAIN\u003C\u002Fb\u003E с самим интерфейсом:\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cpre\u003E\u003Ccode class=\"python\"\u003E\nif __name__ == \"__main__\":\n    data_load()\n    print()\n    inp = input(\n        \"You must to connect with one node (friend), which is already in net. (Press Enter when you and your friend are ready)\"\n    )\n    s = Session()\n    print()\n    print(f\"Send this to your friend {addr2int(s.public_ip,int(s.public_port))}\")\n    print()\n    i, p = int2addr(int(input(\"Input the number from your friend: \")))\n    print(\"Waiting for your friend\")\n    s.make_connection(i, p)\n    sessions.append(s)\n    s.backlife_cycle(1)\n    while 1:\n        print()\n        print(\"╔════════════\u003E Connect &amp; Chan Panel &lt;═════════════\")\n        print(\"╟\u003E Type and enter your post\")\n        print(\"╟\u003E (Empty input + Enter) to see Root\")\n        print(\"╟\u003E ($00000000) to see specific thread\")\n        print(\"╟\u003E (!) for new connection\")\n        print(\"╟\u003E (#) to save checkpoint\")\n        print(\"╟\u003E (`) dev console\")\n        print(\"╚══════════════════════════\u003E\")\n        inp = input(\"Input: \")\n        print(\"&lt;════════════\u003E Connect &amp; Chan Info &lt;════════════\u003E\")\n        print(\n            f\" Connected Nodes: {len(sessions)} | Size of Chan tree: {len(dat_to_bytes(data))} bytes\\n\"\n        )\n\n        if inp == \"\":\n            ptree(\"00000000: Root\", get_tree(data))\n\n        elif inp == \"!\":\n            s = Session()\n            print(\n                f\"Send this to your friend {addr2int(s.public_ip,int(s.public_port))}\"\n            )\n            print()\n            inp = input(\"Input the number from your friend (Empty to cancel): \")\n            if inp:\n                i, p = int2addr(int(inp))\n                print(\"Waiting for your friend\")\n                try:\n                    s.make_connection(i, p)\n                    sessions.append(s)\n                    s.backlife_cycle(1)\n                except:\n                    print(\"Timeout(\")\n        elif inp == \"`\":\n            try:\n                debug.shell()\n            except:\n                pass\n        elif inp == \"#\":\n            data_dump()\n        elif inp[0] == \"$\":\n            if inp[1:] in data:\n                ptree(f\"{inp[1:]}: {data[inp[1:]]}\", get_tree(data))\n            else:\n                print(f\"There is no message with id [{inp[1:]}]\")\n        elif inp:\n            data_add(inp)\n        else:\n            ptree(\"00000000: Root\", get_tree(data))\n        input(\"\\n\\nEnter to reload page\")\n        cls()\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Ca name=\"TEST\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\nКажется, всё готово. Теперь создаём сессию в \u003Ca href=\"https:\u002F\u002Fcolab.research.google.com\u002F\"\u003Egoogle colab\u003C\u002Fa\u003E, которая будет играть роль нашего друга (тут должна быть шутка про отсутствие реальных).\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Ch2\u003E\u003Cfont color=\"#3AC1EF\"\u003EДемонстрация\u003C\u002Ffont\u003E\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EВот что видит каждый пользователь после запуска\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F942\u002F0a9\u002F523\u002F9420a9523c27131aee2e44139fd1ed72.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F942\u002F0a9\u002F523\u002F9420a9523c27131aee2e44139fd1ed72.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EОбмениваемся номерами с устройством, которое уже состоит в сети\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F777\u002F2d7\u002Fda5\u002F7772d7da5edb6388ed7466c9144d9a7e.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F777\u002F2d7\u002Fda5\u002F7772d7da5edb6388ed7466c9144d9a7e.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EТак выглядит интерфейс управления\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4d6\u002Ff44\u002F447\u002F4d6f44447b16e024d7add7900069dd32.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4d6\u002Ff44\u002F447\u002F4d6f44447b16e024d7add7900069dd32.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EПопробуем написать что-нибудь\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8f3\u002Fd87\u002Fcd3\u002F8f3d87cd3448914b0fe1bc232931e52a.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8f3\u002Fd87\u002Fcd3\u002F8f3d87cd3448914b0fe1bc232931e52a.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EВидим, что друг получил данные\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fcb6\u002Fea4\u002Fa58\u002Fcb6ea4a58a041c66dd75dc5df69b28b8.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fcb6\u002Fea4\u002Fa58\u002Fcb6ea4a58a041c66dd75dc5df69b28b8.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EОтветим на уже существующее сообщение\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe8f\u002F2ab\u002F8f8\u002Fe8f2ab8f83c296c115c701bf42c98bfd.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe8f\u002F2ab\u002F8f8\u002Fe8f2ab8f83c296c115c701bf42c98bfd.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nИ ещё отправим сообщение в ответ на фейковый 12312312 хэш.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EВидим, что наш друг видит оба (а потерянное сообщение прикрепилось к ветке Lost):\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F652\u002F378\u002Fce0\u002F652378ce0bcb57e6476dc824207cd350.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F652\u002F378\u002Fce0\u002F652378ce0bcb57e6476dc824207cd350.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EЕсли мы рано или поздно скачаем сообщение с хэшем 12312312, то оно станет родительским для нашего.\u003C\u002Fblockquote\u003E\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EМожно посмотреть конкретный трэд вместо Root:\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F922\u002F16e\u002F40e\u002F92216e40e0a374f5f03e7fcae5566758.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F922\u002F16e\u002F40e\u002F92216e40e0a374f5f03e7fcae5566758.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nЯ пробовал подключать три и более пользователей. Через некоторое время каждый был подключен к каждому и они обменивались сообщениями — мне кажется, что это успех.\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EЛоги ноды (я же зачем-то перенёс всё на логгер, верно?)\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"bash\"\u003E2023-07-27 21:05:30,651 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:05:34,622 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:05:34,622 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:05:37,502 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:05:37,502 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:05:37,502 34.74.93.102: Requesting Datagram     60\n2023-07-27 21:05:37,502 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:05:37,502 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:05:39,647 34.74.93.102: Recieved DAT from ('34.74.93.102', 26698): b'DAT{\"54b2b91c\": \"hello\", \"f41fe2a9\": \"Reply to @54b2b91c!\", \"894df995\": \"Malformed, lol @12345678\", \"1508abcd\": \"text\", \"0f0961d5\": \"#\"}'\n2023-07-27 21:05:39,647 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:05:44,532 34.74.93.102: Recieved RQD from ('34.74.93.102', 26698): b'RQD'\n2023-07-27 21:05:44,532 34.74.93.102: Sending datagram\n2023-07-27 21:05:44,532 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:05:48,152 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:05:53,749 34.74.93.102: Recieved RQD from ('34.74.93.102', 26698): b'RQD'\n2023-07-27 21:05:53,749 34.74.93.102: Sending datagram\n2023-07-27 21:05:53,749 34.74.93.102: Recieved RQS from ('34.74.93.102', 26698): b'RQS'\n2023-07-27 21:05:53,749 34.74.93.102: Sending Session List\n2023-07-27 21:05:53,750 34.74.93.102: Recieved RQD from ('34.74.93.102', 26698): b'RQD'\n2023-07-27 21:05:53,750 34.74.93.102: Sending datagram\n2023-07-27 21:05:53,750 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:01,225 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:03,857 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:03,857 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:03,857 34.74.93.102: Requesting Datagram     61\n2023-07-27 21:06:07,235 34.74.93.102: Recieved DAT from ('34.74.93.102', 26698): b'DAT{\"54b2b91c\": \"hello\", \"f41fe2a9\": \"Reply to @54b2b91c!\", \"894df995\": \"Malformed, lol @12345678\", \"1508abcd\": \"text\", \"0f0961d5\": \"#\"}'\n2023-07-27 21:06:07,235 34.74.93.102: Recieved RQD from ('34.74.93.102', 26698): b'RQD'\n2023-07-27 21:06:07,235 34.74.93.102: Sending datagram\n2023-07-27 21:06:07,235 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:11,860 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:11,860 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:14,504 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:24,636 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:24,636 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:24,636 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:24,636 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:28,006 34.74.93.102: Recieved RQD from ('34.74.93.102', 26698): b'RQD'\n2023-07-27 21:06:28,006 34.74.93.102: Sending datagram\n2023-07-27 21:06:28,006 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:28,006 34.74.93.102: Requesting Datagram     62\n2023-07-27 21:06:28,007 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:28,007 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:28,007 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:37,933 34.74.93.102: Recieved DAT from ('34.74.93.102', 26698): b'DAT{\"54b2b91c\": \"hello\", \"f41fe2a9\": \"Reply to @54b2b91c!\", \"894df995\": \"Malformed, lol @12345678\", \"1508abcd\": \"text\", \"0f0961d5\": \"#\"}'\n2023-07-27 21:06:37,933 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:37,933 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:37,933 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:37,933 34.74.93.102: Requesting Session List 19\n2023-07-27 21:06:37,933 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:37,933 34.74.93.102: Recieved KPL from ('34.74.93.102', 26698): b'KPL'\n2023-07-27 21:06:37,933 34.74.93.102: Requesting Datagram     63\n2023-07-27 21:06:47,334 34.74.93.102: Recieved SES from ('34.74.93.102', 26698): b'SES[\"34.147.33.206\"]'\n2023-07-27 21:06:47,334 34.74.93.102: My sessions: {'34.74.93.102'} Recieved: {'34.147.33.206'} New: ['34.147.33.206']\n2023-07-27 21:06:47,334 STUN request via stun.ekiga.net\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\nВидим практическое подтверждение всего, что было сказано раньше. Ноды обмениваются KPL, периодически сверяя датасеты и списки сессий.\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Ca name=\"CONC\"\u003E\u003C\u002Fa\u003E\u003Cbr\u002F\u003E\r\n\u003Ch2\u003E\u003Cfont color=\"#3AC1EF\"\u003EAs conclusion\u003C\u002Ffont\u003E\u003C\u002Fh2\u003E\u003Cbr\u002F\u003E\r\n\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3ce\u002Ff5c\u002F428\u002F3cef5c428a7ab78d8c22732fc9438a70.jpg\" alt=\"image\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3ce\u002Ff5c\u002F428\u002F3cef5c428a7ab78d8c22732fc9438a70.jpg\" data-blurred=\"true\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nПод конец можно сказать, что результат получился даже лучше, чем я изначально рассчитывал. Простая пробрасывалка портов превратилась в полноценное юзабельное приложение. На самом деле, ещё есть что доработать и прикрутить — совершенству нет предела. Как минимум можно распространять вместе со своим ip ещё и публичный ключ от асимметричной пары и передавать данные не в сыром виде, а зашифрованные этой парой так, чтобы прочитать их мог только желаемый получатель (только ваш друг). Можно прикрутить интерфейс поверх какого-нибудь \u003Ca href=\"https:\u002F\u002Fwww.electronjs.org\u002F\"\u003Eelectron\u003C\u002Fa\u003Eа и получить готовое десктопное приложение…\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EВесь исходный код CnC.py\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cpre\u003E\u003Ccode class=\"python\"\u003Efrom pathlib import Path\nimport time\nimport os\nimport sys\n\n\ndef cls():\n    os.system(\"cls\" if os.name == \"nt\" else \"clear\")\n\n\ntry:\n    scriptname = Path(__file__).name\nexcept:\n    scriptname = \"CnC.py\"\ntry:\n    verfrom = time.ctime(os.path.getmtime(__file__))\nexcept:\n    verfrom = \"!No time!\"\n\n\nimport threading\nimport socket\nimport random\nimport hashlib\nimport json\nimport logging\nimport pdb\n\n\nclass Debug(pdb.Pdb):\n    def __init__(self, *args, **kwargs):\n        super(Debug, self).__init__(*args, **kwargs)\n        self.prompt = \"CnC Debug Shell \u003E\u003E\u003E \"\n\n    def shell(self):\n        self.set_trace()\n\n\ndebug = Debug()\n# logging.warn(f\"Event logging is enabled. You can see it in {scriptname}.log\")\nlogging.basicConfig(\n    format=\"%(asctime)s %(message)s\", level=logging.DEBUG, filename=f\"{scriptname}.log\"\n)\nlogging.info(\"Hello world!\")\nlogging.getLogger().setLevel(logging.DEBUG)\n\n\ndef get_files():\n    matches = []\n    for root, dirs, files in os.walk(os.getcwd()):\n        for file in files:\n            if file.endswith(\".html\"):\n                matches.append(os.path.splitext(file)[0])\n    return matches\n\n\ndef dat_to_bytes(diction: dict) -\u003E bytes:\n    return json.dumps(diction).encode(\"cp866\")\n\n\ndef bytes_to_dat(byte: bytes) -\u003E dict:\n    return json.loads(byte.decode(\"cp866\"))\n\n\ndef checksum(b):\n    return hashlib.blake2s(b, digest_size=4).hexdigest()\n\n\n_alreadyused = set()\n\n\ndef randomport():\n    global _alreadyused\n    p = random.randint(16000, 65535)\n    while p in _alreadyused:\n        p = random.randint(16000, 65535)\n    _alreadyused.update({p})\n    return p\n\n\ndef aegis(f):\n    def wr():\n        while 1:\n            try:\n                f()\n                break\n            except Exception as e:\n                logging.critical(e)\n\n    return wr\n\n\ndef STUN(port, host=\"stun.ekiga.net\"):\n    logging.debug(f\"STUN request via {host}\")\n    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n    sock.bind((\"0.0.0.0\", port))\n    sock.setblocking(0)\n    server = socket.gethostbyname(host)\n    work = True\n    while work:\n        sock.sendto(\n            b\"\\x00\\x01\\x00\\x00!\\x12\\xa4B\\xd6\\x85y\\xb8\\x11\\x030\\x06xi\\xdfB\",\n            (server, 3478),\n        )\n        for i in range(20):\n            try:\n                ans, addr = sock.recvfrom(2048)\n                work = False\n                break\n            except:\n                time.sleep(0.01)\n\n    sock.close()\n    return socket.inet_ntoa(ans[28:32]), int.from_bytes(ans[26:28], byteorder=\"big\")\n\n\ndef addr2int(ip, port: int):\n    binport = bin(port)[2:].rjust(16, \"0\")\n    binip = \"\".join([bin(int(i))[2:].rjust(8, \"0\") for i in ip.split(\".\")])\n    return int(binip + binport, 2)\n\n\ndef int2addr(num):\n    num = bin(num)[2:].rjust(48, \"0\")\n    print(num)\n    num = [\n        str(int(i, 2))\n        for i in [num[0:8], num[8:16], num[16:24], num[24:32], num[32:48]]\n    ]\n    return \".\".join(num[0:4]), int(num[4])\n\n\npool = []  # Pool for commands to any session (like RQD to initiate data update)\n\nmissed_messages = (\n    set()\n)  # Storage for hashes of required but missed messages (to request them later)\n\ndata = {}\nsessions = []\n\n\ndef mass_command(c):\n    global pool\n    pool.append(c)\n\n\ndef data_add(item):\n    data.update({checksum(item.encode(\"cp866\")): item})\n\n\ndef data_dump():\n    with open(f\"{scriptname}.chat-savefile.json\", \"w\") as f:\n        json.dump(icm2.data, f)\n\n\ndef data_load():\n    global data\n    try:\n        with open(f\"{scriptname}.chat-savefile.json\", \"r\") as f:\n            data = json.load(f)\n    except:\n        logging.error(f\"No save file exists! New one created\")\n        with open(f\"{scriptname}.chat-savefile.json\", \"w\") as f:\n            json.dump({}, f)\n\n\nclass Session:\n    def __init__(self):\n        # self.prefix=\"IDL\"\n        self.immortal = False\n        self.local_port = randomport()\n        for i in range(10):\n            self.public_ip, self.public_port = STUN(self.local_port)\n        self.socket = None\n        self.client = None\n        self.thread = None\n        logging.info(f'\"{self.public_ip}\",{self.public_port}')\n\n    def make_connection(self, ip, port, timeout=10):\n        logging.debug(f\"Start waiting for handshake with {ip}:{port}\")\n        sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n        sock.bind((\"0.0.0.0\", self.local_port))\n        sock.setblocking(0)\n        while True:\n            sock.sendto(b\"Con. Request!\", (ip, port))\n            time.sleep(2)\n            try:\n                ans, addr = sock.recvfrom(9999)\n                sock.sendto(b\"Con. Request!\", (ip, port))\n                sock.close()\n                sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)\n                sock.bind((\"0.0.0.0\", self.local_port))\n                sock.setblocking(0)\n                self.client = (ip, port)\n                self.socket = sock\n                logging.debug(f\"Hole with {self.client} punched!\")\n                break\n            except Exception as e:\n                assert timeout \u003E 0\n                timeout -= 1\n                logging.debug(f\"No handshake with {ip}:{port} yet...\")\n\n    def backlife_cycle(self, freq=1):\n        global sessions\n        if self.immortal:\n            logging.warning(f\"{self.client} session beacame immortal\")\n            self.life_cycle = aegis(self.life_cycle)\n        th = threading.Thread(target=self.life_cycle, args=(freq,))\n        th.start()\n        self.thread = th\n        logging.warning(f\"Session with {self.client} stabilized!\")\n        # sessions.append(self)\n\n    def life_cycle(self, freq=1):\n        global data\n        global sessions\n        global pool\n        c = 0\n        while 1:\n            if len(pool):\n                pref = pool.pop(0)\n            else:\n                pref = b\"KPL\"\n\n            self.socket.sendto(pref, self.client)  # Keep-alive\n            time.sleep(max(random.gauss(1 \u002F freq, 3), 0))\n\n            while True:\n                try:\n                    ans, reply_addr = self.socket.recvfrom(9999)\n                    logging.debug(\n                        f\"{self.client[0]}: Recieved {ans[:3].decode('cp866')} from {reply_addr}: {ans}\"\n                    )\n                except:\n                    break\n\n                if ans[:3] == b\"KPL\":\n                    c += 1\n                    if c % 10 == 0:\n                        logging.debug(\n                            f\"{self.client[0]}: Requesting Datagram     {c\u002F\u002F10}\"\n                        )\n                        self.socket.sendto(b\"RQD\", self.client)\n                        c += 1\n                    elif c % 33 == 0:\n                        logging.debug(\n                            f\"{self.client[0]}: Requesting Session List {c\u002F\u002F33}\"\n                        )\n                        self.socket.sendto(b\"RQS\", self.client)\n                        c += 1\n\n                # ----------------------------------------Hashes (keys) sync (disabled now)----------------------------------------\n                elif ans[:3] == b\"RQH\":\n                    logging.debug(f\"{self.client[0]}: Sending hashes\")\n                    self.socket.sendto(\n                        b\"HAS\" + dat_to_bytes(list(data.keys())), self.client\n                    )\n\n                elif ans[:3] == b\"HAS\":\n                    missed_messages.update(\n                        set(bytes_to_dat(ans[3:])) - set(data.keys())\n                    )\n\n                # ----------------------------------------Data sync----------------------------------------\n                elif ans[:3] == b\"RQD\":\n                    if ans[3:] != b\"\":\n                        logging.debug(f\"{self.client[0]}: Sending specific datagram\")\n                        n = {}\n                        r = set(bytes_to_dat(ans[3:]))\n                        for i in r:\n                            if i in data:\n                                n.update({i: data[i]})\n                        logging.debug(f\"{self.client[0]}: Sending {n}\")\n                        self.socket.sendto(b\"DAT\" + dat_to_bytes(n), self.client)\n                    else:\n                        logging.debug(f\"{self.client[0]}: Sending datagram\")\n                        self.socket.sendto(b\"DAT\" + dat_to_bytes(data), self.client)\n\n                elif ans[:3] == b\"DAT\":\n                    data.update(bytes_to_dat(ans[3:]))\n\n                # ----------------------------------------IP list sync-------------------------------------\n                elif ans[:3] == b\"RQS\":\n                    logging.debug(f\"{self.client[0]}: Sending Session List\")\n                    sess = [i.client[0] if i.client else None for i in sessions]\n                    sess = set(sess)\n                    sess = sess - {None}\n                    sess = list(sess)\n                    sess.remove(self.client[0])\n                    self.socket.sendto(b\"SES\" + dat_to_bytes(sess), self.client)\n\n                elif ans[:3] == b\"SES\":\n                    sess = [i.client[0] if i.client else None for i in sessions]\n                    sess = set(sess)\n                    sess = sess - {None}\n                    logging.debug(\n                        f\"{self.client[0]}: My sessions: {sess} Recieved: {set(bytes_to_dat(ans[3:]))} New: {list(set(bytes_to_dat(ans[3:]))-sess)}\"\n                    )\n                    uncon = list(set(bytes_to_dat(ans[3:])) - sess)\n                    if not uncon:\n                        continue\n                    adr = random.choice(uncon)\n                    s = Session()\n                    sessions.append(s)\n                    self.socket.sendto(\n                        b\"HOP\"\n                        + socket.inet_aton(adr)\n                        + b\"CON\"\n                        + s.public_ip.encode(\"cp866\")\n                        + b\":\"\n                        + str(s.public_port).encode(\"cp866\"),\n                        self.client,\n                    )\n                # ----------------------------------------HOP Tracking-------------------------------------\n                elif ans[:3] == b\"HOP\":\n                    sess = [i.client[0] if i.client else None for i in sessions]\n\n                    ip = socket.inet_ntoa(ans[3:7])\n                    if ip in sess:\n                        s = sessions[sess.index(ip)]\n                        s.socket.sendto(ans[7:], s.client)\n\n                elif ans[:3] == b\"CON\":\n                    s = Session()\n                    adr, prt = ans[3:].decode(\"cp866\").split(\":\")\n                    self.socket.sendto(\n                        b\"HOP\"\n                        + socket.inet_aton(adr)\n                        + b\"RDY\"\n                        + prt.encode(\"cp866\")\n                        + b\":\"\n                        + s.public_ip.encode(\"cp866\")\n                        + b\":\"\n                        + str(s.public_port).encode(\"cp866\"),\n                        self.client,\n                    )\n                    try:\n                        s.make_connection(adr, int(prt))\n                        s.backlife_cycle(1)\n                        sessions.append(s)\n                    except:\n                        logging.error(f\"{self.client[0]}: Connect initiation timeout!\")\n\n                elif ans[:3] == b\"RDY\":\n                    myprt, adr, prt = ans[3:].decode(\"cp866\").split(\":\")\n                    sess = [i.public_port for i in sessions]\n\n                    if int(myprt) in sess:\n                        s = sessions[sess.index(int(myprt))]\n                        try:\n                            s.make_connection(adr, int(prt))\n                            s.backlife_cycle(1)\n                        except:\n                            logging.error(\n                                f\"{self.client[0]}: Connect stabilization timeout!\"\n                            )\n                            sessions.remove(s)\n\n                # ----------------------------------------Disabled Trash-----------------------------------\n                elif ans[:3] == b\"TRK\":\n                    adr, prt = ans[3:].decode(\"cp866\").split(\",\")\n                    sess = [i.client[0] for i in sessions]\n                    sess.remove(self.client[0])\n                    s = sessions[sess.index(adr)]\n\n                    s.socket.sendto(\n                        b\"CN0\"\n                        + f\"{self.client[0].encode('cp866')}:{prt.encode('cp866')}\",\n                        s.client,\n                    )\n\n                elif ans[:3] == b\"CN0\":\n                    s = Session()\n                    self.socket.sendto(\n                        b\"CN1\"\n                        + f\"{s.public_ip.encode('cp866')}:{str(s.public_port).encode('cp866')}\",\n                        self.client,\n                    )\n                    adr, prt = ans[3:].decode(\"cp866\").split(\":\")\n                    s.make_connection(adr, int(prt))\n                    sessions.append(s)\n                elif ans[:3] == b\"TRK\":\n                    pass\n                else:\n                    logging.warning(f\"{self.client[0]}: Malformed! !!!{ans}!!!\")\n\n\n# It is like a legacy code, bruh: (https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F51903172\u002Fhow-to-display-a-tree-in-python-similar-to-msdos-tree-command)\ndef ptree(start, tree, indent_width=4):\n    def _ptree(start, parent, tree, grandpa=None, indent=\"\"):\n        if parent != start:\n            if grandpa is None:  # Ask grandpa kids!\n                print(parent, end=\"\")\n            else:\n                print(parent)\n        if parent not in tree:\n            return \n        for child in tree[parent][:-1]:\n            print(indent + \"├\" + \"─\" * indent_width, end=\"\")\n            _ptree(start, child, tree, parent, indent + \"│\" + \" \" * 4)\n        child = tree[parent][-1]\n        print(indent + \"└\" + \"─\" * indent_width, end=\"\")\n        _ptree(start, child, tree, parent, indent + \" \" * 5)  # 4 -\u003E 5\n\n    parent = start\n    print(start)\n    _ptree(start, parent, tree)\n\n\ndef silent():\n    logging.disable()\n\n\nlogging.warning(\n    f\"Logger for DEBUG is running! to diable it run {scriptname.split('.')[0]}.silent()\"\n)\nprint(\n    f\" Welcome to {scriptname} version from {verfrom} - event logging here: {scriptname}.log\"\n)\nprint(\n    f\"   Your Python version is {'.'.join([str(i) for i in sys.version_info[0:3]])}, branch {sys.version_info[3].upper()}\"\n)\ntry:\n    c = STUN(12346)\n    print(f\"     Internet connection is stable on {socket.gethostname()}!\")\n    if 1:\n        import requests\n\n        r2 = requests.get(f\"http:\u002F\u002Fipinfo.io\u002F{c[0]}\").json()[\"org\"]\n        print(\n            f\"       Gray  (local)  IP is {socket.gethostbyname(socket.gethostname())}\"\n        )\n        print(f\"       While (public) IP is {c[0]} - {r2}\")\n    else:\n        print(\n            f\"       Gray  (local)  IP is {socket.gethostbyname(socket.gethostname())}\"\n        )\n        print(f\"       While (public) IP is {c[0]}\")\nexcept Exception as e:\n    logging.critical(e)\n    print(f\" No internet connection found! I cant work offline!\")\n\n\nimport re\n\n\ndef get_tree(data):\n    data = data.copy()\n    data.update({\"00000000\": \"Root\"})\n    # data.update({\"11111111\":\"Root\"})\n    data.update({\"ffffffff\": \"Lost\"})\n    dct = {}\n\n    for key, message in data.items():\n        if key + \": \" + message not in dct:\n            dct.update({key + \": \" + message: []})\n\n    for key, message in data.items():\n        rep = [i[1:] for i in re.findall(\"@+[a-z0-9]{8}\", message)]\n\n        if len(rep) \u003E 0:\n            rep = rep[0]\n        else:\n            rep = \"00000000\"\n\n        if rep not in data:\n            rep = \"ffffffff\"\n        if rep + \": \" + data[rep] in dct:\n            dct[rep + \": \" + data[rep]].append(key + \": \" + message)\n        else:\n            pass\n            # dct.update({rep+\": \"+data[rep]:[key+\": \"+message]})\n    # print(dct)\n    dct[\"00000000: Root\"].remove(\"00000000: Root\")\n    for k, v in list(dct.items()).copy():\n        if v == []:\n            dct.pop(k)\n    return dct\n\n\nif __name__ == \"__main__\":\n    data_load()\n    print()\n    inp = input(\n        \"You must to connect with one node (friend), which is already in net. (Press Enter when you and your friend are ready)\"\n    )\n    s = Session()\n    print()\n    print(f\"Send this to your friend {addr2int(s.public_ip,int(s.public_port))}\")\n    print()\n    i, p = int2addr(int(input(\"Input the number from your friend: \")))\n    print(\"Waiting for your friend\")\n    s.make_connection(i, p)\n    sessions.append(s)\n    s.backlife_cycle(1)\n    while 1:\n        print()\n        print(\"╔════════════\u003E Connect &amp; Chan Panel &lt;═════════════\")\n        print(\"╟\u003E Type and enter your post\")\n        print(\"╟\u003E (Empty input + Enter) to see Root\")\n        print(\"╟\u003E ($00000000) to see specific thread\")\n        print(\"╟\u003E (!) for new connection\")\n        print(\"╟\u003E (#) to save checkpoint\")\n        print(\"╟\u003E (`) dev console\")\n        print(\"╚══════════════════════════\u003E\")\n        inp = input(\"Input: \")\n        print(\"&lt;════════════\u003E Connect &amp; Chan Info &lt;════════════\u003E\")\n        print(\n            f\" Connected Nodes: {len(sessions)} | Size of Chan tree: {len(dat_to_bytes(data))} bytes\\n\"\n        )\n\n        if inp == \"\":\n            ptree(\"00000000: Root\", get_tree(data))\n\n        elif inp == \"!\":\n            s = Session()\n            print(\n                f\"Send this to your friend {addr2int(s.public_ip,int(s.public_port))}\"\n            )\n            print()\n            inp = input(\"Input the number from your friend (Empty to cancel): \")\n            if inp:\n                i, p = int2addr(int(inp))\n                print(\"Waiting for your friend\")\n                try:\n                    s.make_connection(i, p)\n                    sessions.append(s)\n                    s.backlife_cycle(1)\n                except:\n                    print(\"Timeout(\")\n        elif inp == \"`\":\n            try:\n                debug.shell()\n            except:\n                pass\n        elif inp == \"#\":\n            data_dump()\n        elif inp[0] == \"$\":\n            if inp[1:] in data:\n                ptree(f\"{inp[1:]}: {data[inp[1:]]}\", get_tree(data))\n            else:\n                print(f\"There is no message with id [{inp[1:]}]\")\n        elif inp:\n            data_add(inp)\n        else:\n            ptree(\"00000000: Root\", get_tree(data))\n        input(\"\\n\\nEnter to reload page\")\n        cls()\u003C\u002Fcode\u003E\u003C\u002Fpre\u003E\u003Cbr\u002F\u003E\r\n\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nХотя останавливаться тоже нужно уметь. \u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\nНа этом я, пожалуй, поблагодарю вас за выделенное время на эту статью. Не уверен, что досюда все дочитали, особенно если вникали во весь код и объяснения. Если же ты, мой дорогой читатель, действительно ещё здесь…\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cdiv class=\"spoiler\" role=\"button\" tabindex=\"0\"\u003E\n                        \u003Cb class=\"spoiler_title\"\u003EДержи милые обои на рабочий стол\u003C\u002Fb\u003E\n                        \u003Cdiv class=\"spoiler_text\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Fru\u002Fhh\u002Fob\u002Fruhhobvxnh2haqrwru6ejkipwcs.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fru\u002Fhh\u002Fob\u002Fruhhobvxnh2haqrwru6ejkipwcs.png\"\u002F\u003E\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003EИли тизер следующей моей статьи по ML, тут как знать...\u003C\u002Fblockquote\u003E\u003C\u002Fdiv\u003E\n                    \u003C\u002Fdiv\u003E\u003Cbr\u002F\u003E\r\nСамо собой, feedback и здравая критика в комментариях приветствуются. Спасибо!\u003Cbr\u002F\u003E\r\n\u003Cbr\u002F\u003E\r\n\u003Cblockquote\u003E\u003Cb\u003E\u003Cfont color=\"#3AC1EF\"\u003E\u003Ca href=\"https:\u002F\u002Ft.me\u002Fruvds_community\"\u003ETelegram-канал с розыгрышами призов, новостями IT и постами о ретроиграх 🕹️\u003C\u002Fa\u003E\u003C\u002Ffont\u003E\u003C\u002Fb\u003E\u003C\u002Fblockquote\u003E\u003Ca href=\"http:\u002F\u002Fruvds.com\u002Fru-rub?utm_source=habr&amp;utm_medium=article&amp;utm_campaign=CodeDroidX&amp;utm_content=p2p_forum_s_nulya_ot_nat_hole_punching_do_avtonomnoj_i_polnostyu_decentralizovannoj_seti\"\u003E\u003Cimg src=\"https:\u002F\u002Fhabrastorage.org\u002Fr\u002Fw1560\u002Fwebt\u002Ftp\u002Fsk\u002Fz-\u002Ftpskz-7w7a8e74isoowuep40xeg.png\" data-src=\"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Ftp\u002Fsk\u002Fz-\u002Ftpskz-7w7a8e74isoowuep40xeg.png\"\u002F\u003E\u003C\u002Fa\u003E\u003C\u002Fdiv\u003E","tags":[{"titleHtml":"ruvds_статьи"},{"titleHtml":"python"},{"titleHtml":"ip"},{"titleHtml":"p2p-сети"},{"titleHtml":"overlay"},{"titleHtml":"network"},{"titleHtml":"peer-to-peer"},{"titleHtml":"nat"},{"titleHtml":"mikrotik"},{"titleHtml":"socket"},{"titleHtml":"holepunch"}],"metadata":{"stylesUrls":[],"scriptUrls":[],"shareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Flu\u002F3o\u002Ffx\u002Flu3ofxdzbsu1jqvgd0ojccnstdg.png","shareImageWidth":1200,"shareImageHeight":630,"vkShareImageUrl":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Flu\u002F3o\u002Ffx\u002Flu3ofxdzbsu1jqvgd0ojccnstdg.png","schemaJsonLd":"{\"@context\":\"http:\\\u002F\\\u002Fschema.org\",\"@type\":\"Article\",\"mainEntityOfPage\":{\"@type\":\"WebPage\",\"@id\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fruvds\\\u002Farticles\\\u002F761188\\\u002F\"},\"headline\":\"P2P-форум с нуля | от NAT hole punching до автономной и полностью децентрализованной сети\",\"datePublished\":\"2023-10-02T12:00:01+03:00\",\"dateModified\":\"2023-10-02T12:51:29+03:00\",\"author\":{\"@type\":\"Person\",\"name\":\"Andрeй ✅\"},\"publisher\":{\"@type\":\"Organization\",\"name\":\"Habr\",\"logo\":{\"@type\":\"ImageObject\",\"url\":\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fa_\\\u002Flk\\\u002F9m\\\u002Fa_lk9mjkccjox-zccjrpfolmkmq.png\"}},\"description\":\"Многие, кто работают с интернет-сокетами в любой сфере IT, задаются вопросом о&nbsp;пробросе портов. Связано это с тем, что практически во всех домашних\\\u002Fобщественных...\",\"url\":\"https:\\\u002F\\\u002Fhabr.com\\\u002Fru\\\u002Fcompanies\\\u002Fruvds\\\u002Farticles\\\u002F761188\\\u002F#post-content-body\",\"about\":[\"c_ruvds\",\"h_p2p\",\"h_programming\",\"h_network_technologies\",\"h_network_hardware\",\"f_develop\",\"f_admin\",\"f_popsci\"],\"image\":[\"https:\\\u002F\\\u002Fhabr.com\\\u002Fshare\\\u002Fpublication\\\u002F761188\\\u002Fdc2014b9191dc9141dbe0746a3b4e114\\\u002F\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fgo\\\u002Fc6\\\u002Ffb\\\u002Fgoc6fbxehf6l6rs6ihvnw5mmzy8.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F9d0\\\u002F5cc\\\u002Fd7f\\\u002F9d05ccd7f8d094bf11c465bce5a31c35.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fdfb\\\u002F6e2\\\u002Fdcb\\\u002Fdfb6e2dcbbbf0da859fb48c9b207ec44.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F7dc\\\u002F221\\\u002F10e\\\u002F7dc22110e3b7ebd066822f89721ff616.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fdcc\\\u002Fd20\\\u002F948\\\u002Fdccd209484c3a3ae8cc4dad708bb284d.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F926\\\u002Ffd0\\\u002F9a6\\\u002F926fd09a660ca1bacfa93c7b3f18ca00.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F6e1\\\u002Fe0e\\\u002F813\\\u002F6e1e0e81328a8ae4818cd8ffd87f7134.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fd54\\\u002Fab6\\\u002Fe9c\\\u002Fd54ab6e9cb36f45ca8feb98bef4b8a46.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F94e\\\u002F048\\\u002F8e7\\\u002F94e0488e73dada360316e8d4639f297e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F5ac\\\u002F41b\\\u002Fec1\\\u002F5ac41bec16497fec1fbdd48eb7815187.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F034\\\u002F2a4\\\u002F6bc\\\u002F0342a46bc10d56745bbd8979638b4e41.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F003\\\u002F2f6\\\u002F928\\\u002F0032f69289df30917cefdc741fe8b91f.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F24d\\\u002Feb3\\\u002F40a\\\u002F24deb340a3da19493ffb7f1bc2c190c9.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F942\\\u002F0a9\\\u002F523\\\u002F9420a9523c27131aee2e44139fd1ed72.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F777\\\u002F2d7\\\u002Fda5\\\u002F7772d7da5edb6388ed7466c9144d9a7e.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F4d6\\\u002Ff44\\\u002F447\\\u002F4d6f44447b16e024d7add7900069dd32.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F8f3\\\u002Fd87\\\u002Fcd3\\\u002F8f3d87cd3448914b0fe1bc232931e52a.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fcb6\\\u002Fea4\\\u002Fa58\\\u002Fcb6ea4a58a041c66dd75dc5df69b28b8.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002Fe8f\\\u002F2ab\\\u002F8f8\\\u002Fe8f2ab8f83c296c115c701bf42c98bfd.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F652\\\u002F378\\\u002Fce0\\\u002F652378ce0bcb57e6476dc824207cd350.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F922\\\u002F16e\\\u002F40e\\\u002F92216e40e0a374f5f03e7fcae5566758.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fr\\\u002Fw1560\\\u002Fgetpro\\\u002Fhabr\\\u002Fupload_files\\\u002F3ce\\\u002Ff5c\\\u002F428\\\u002F3cef5c428a7ab78d8c22732fc9438a70.jpg\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Fru\\\u002Fhh\\\u002Fob\\\u002Fruhhobvxnh2haqrwru6ejkipwcs.png\",\"https:\\\u002F\\\u002Fhabrastorage.org\\\u002Fwebt\\\u002Ftp\\\u002Fsk\\\u002Fz-\\\u002Ftpskz-7w7a8e74isoowuep40xeg.png\"]}","metaDescription":"Многие, кто работают с интернет-сокетами в любой сфере IT, задаются вопросом о  пробросе портов . Связано это с тем, что практически во всех домашних\u002Fобщественных\u002Fкорпоративных роутерах реализован...","mainImageUrl":null,"amp":false,"customTrackerLinks":[]},"polls":[],"commentsEnabled":{"status":true,"reason":null},"rulesRemindEnabled":false,"votesEnabled":true,"status":"published","plannedPublishTime":null,"checked":null,"hasPinnedComments":false,"format":"tutorial","banner":null,"multiwidget":null,"readingTime":32,"complexity":"medium","isEditorial":false}},"articlesIds":{},"isLoading":false,"pagesCount":{},"route":{},"reasonsList":null,"postReasonsList":null,"view":"list","lastVisitedRoute":{},"ssrCommentsArticleIds":[""],"viewedPosts":[],"karma":{"userReasonsList":null}},"authorContribution":{"authors":{}},"betaTest":{"currentAnnouncement":null,"announcements":{},"announcementCards":null,"announcementComments":{},"announcementCommentThreads":{},"announcementCommentingStatuses":{},"archivedList":[]},"authorStatistics":{"articleRefs":{},"articleIds":{},"pagesCount":{},"route":{},"viewsCount":[],"maxStatsCount":{}},"career":{"seoLandings":[],"hubs":""},"comments":{"articleComments":{},"articlePinnedComments":{},"searchCommentsResults":null,"pagesCount":null,"commentAccess":{},"scrollParents":{},"pageArticleComments":{"lastViewedComment":0,"postId":null,"lastCommentTimestamp":"","moderated":[],"moderatedIds":[],"commentRoute":""}},"companies":{"companyRefs":{"ruvds":{"alias":"ruvds","imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fcompany\u002F027\u002Fb19\u002Fcea\u002F027b19cea984722a8d806edcc56c2c00.png","titleHtml":"RUVDS.com","descriptionHtml":"VDS\u002FVPS-хостинг. Скидка 15% по коду \u003Cb\u003EHABR15\u003C\u002Fb\u003E","relatedData":null,"statistics":{"subscribersCount":84410,"rating":1905.55,"invest":null,"postsCount":3141,"threadsCount":0,"newsCount":148,"vacanciesCount":0,"employeesCount":68,"careerRating":null},"foundationDate":{"year":"2015","month":"07","day":"27"},"location":{"city":{"id":"447159","title":"Москва"},"region":{"id":"1885","title":"Москва и Московская обл."},"country":{"id":"168","title":"Россия"}},"siteUrl":"https:\u002F\u002Fruvds.com","staffNumber":"11–30 человек","registrationDate":"2016-03-18T05:43:01+00:00","representativeUser":{"alias":"ruvds","fullname":null},"contacts":[{"title":"Telegram","url":"https:\u002F\u002Ftelegram.me\u002Fruvds_community","siteTitle":"Telegram: Contact @ruvds_community","favicon":"https:\u002F\u002Ftelegram.org\u002Fimg\u002Fwebsite_icon.svg?4"},{"title":"ВКонтакте","url":"https:\u002F\u002Fvk.com\u002Fru_vds","siteTitle":"VK | VK","favicon":"https:\u002F\u002Fm.vk.com\u002Fimages\u002Ficons\u002Ffavicons\u002Ffav_logo.ico?8"},{"title":"Twitter","url":"https:\u002F\u002Ftwitter.com\u002Fru_vds","siteTitle":null,"favicon":null}],"settings":{"analyticsSettings":[{"type":"ym","trackingId":"33905479"}],"branding":{"imageUrl":"\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fbranding\u002F0fd\u002F0cd\u002F3f6\u002F0fd0cd3f63dac0cb6ac8359cac986779.jpg","linkUrl":"https:\u002F\u002Fruvds.com\u002Fru\u002Fwindows\u002F?utm_source=habr&utm_medium=banner&utm_campaign=promo&utm_content=link&?erid=LjN8KAR3S","pixelUrl":"https:\u002F\u002Fmc.yandex.ru\u002Fpixel\u002F6846806368140084213?rnd=%252525aw_random%252525"},"status":"active","isStartup":false,"hasActivePolls":false},"metadata":{"titleHtml":"RUVDS.com, Москва - VDS\u002FVPS-хостинг. Скидка 15% по коду \u003Cb\u003EHABR15\u003C\u002Fb\u003E с 27 июля 2015 г.","title":"RUVDS.com, Москва - VDS\u002FVPS-хостинг. Скидка 15% по коду HABR15 с 27 июля 2015 г.","keywords":["Читальный зал","Научно-популярное","DIY или Сделай сам","Программирование","Электроника для начинающих","ruvds_статьи","ruvds_перевод","разработка","ruvds_статьи_выходного_дня","ruvds_новости","linux","игры","diy","ruvds","системное администрирование","программирование","arduino","javascript","ruvds_переводы","хабрахабр","python","unix","raspberry pi","информационная безопасность","css"],"descriptionHtml":"3 141 статья от авторов компании RUVDS.com","description":"3 141 статья от авторов компании RUVDS.com"},"aDeskSettings":null,"careerAlias":"ruvds","schoolAlias":null}},"companyIds":{},"companyTopIds":{},"pagesCount":{},"companyProfiles":{},"companiesCategories":[],"companiesCategoriesTotalCount":0,"companiesWidgets":{},"companiesWorkers":{},"companiesFans":{},"multiwidgets":{},"route":{},"isLoading":false,"companyWorkersLoading":false,"companyFansLoading":false,"multiwidgetLoading":false,"vacancies":{},"companiesGalleries":{},"companiesBanners":{},"companiesLandingVacancies":{},"companiesTechnologies":{},"workplaceInfo":null},"companyAdmin":{"companyInfo":null,"companyInfoLoading":false,"faqArticles":null,"brandingPreviewImageUrl":null,"jivoStatus":0,"adminNotifications":null},"companiesContribution":{"hubs":{},"flows":{},"companyRefs":{}},"companyHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"conversation":{"messages":[],"respondent":null,"isLoadMore":false},"conversations":{"conversations":[],"unreadCount":0,"pagesCount":0},"docs":{"menu":{},"articles":{},"mainMenu":[],"loading":{"main":false,"dropdown":false,"article":false}},"feature":{"isProbablyVisible":true},"flows":{"updates":{"countNewPostsBySubscription":null,"countNewThreadsBySubscription":null,"countNewNewsBySubscription":null,"countNewPostsAll":30,"countNewNewsAll":9,"countNewThreadsAll":8},"flows":[{"alias":"develop","id":"1","route":{"name":"FLOW_PAGE","params":{"flowName":"develop"}}},{"alias":"admin","id":"6","route":{"name":"FLOW_PAGE","params":{"flowName":"admin"}}},{"alias":"design","id":"2","route":{"name":"FLOW_PAGE","params":{"flowName":"design"}}},{"alias":"management","id":"3","route":{"name":"FLOW_PAGE","params":{"flowName":"management"}}},{"alias":"marketing","id":"4","route":{"name":"FLOW_PAGE","params":{"flowName":"marketing"}}},{"alias":"popsci","id":"7","route":{"name":"FLOW_PAGE","params":{"flowName":"popsci"}}}]},"global":{"isPwa":false,"device":"mobile","isHabrCom":true},"hubs":{"hubRefs":{},"hubIds":{},"pagesCount":{},"isLoading":false,"route":{}},"hubsBlock":{"hubRefs":{},"hubIds":{}},"i18n":{"fl":"ru","hl":"ru"},"info":{"welcomePage":{},"isLoading":true},"location":{"urlStruct":{"protocol":null,"slashes":null,"auth":null,"host":null,"port":null,"hostname":null,"hash":null,"search":null,"query":{},"pathname":null,"path":null,"href":""}},"me":{"user":null,"uuid":null,"ppgDemanded":false,"karmaResetInfo":{"canReincarnate":null,"wasReincarnated":null,"currentScore":null},"notes":null},"modal":{"modals":[]},"mostReadingList":{"mostReadingListIds":[],"mostReadingListRefs":null,"promoPost":null},"ppa":{"articles":{},"card":null,"transactions":null,"totalTransactions":null,"isAccessible":null},"projectsBlocks":{"activeBlocks":{}},"promoData":{"isLoading":false,"hasLoaded":false,"featurer":null,"megaposts":null,"promoLinks":null,"promoPosts":null},"pullRefresh":{"shouldRefresh":false},"sandbox":{"articleIds":[],"articleRefs":{},"pagesCount":null,"route":{},"lastVisitedRoute":{},"isLoading":false},"search":{"searchQueryError":null},"settingsOther":{"inputs":{"uiLang":{"errors":[],"ref":null,"value":""},"articlesLangEnglish":{"errors":[],"ref":null,"value":false},"articlesLangRussian":{"errors":[],"ref":null,"value":false},"agreement":{"errors":[],"ref":null,"value":false},"email":{"errors":[],"ref":null,"value":true},"digest":{"errors":[],"ref":null,"value":true}}},"similarList":{"similarListIds":[],"similarListRefs":null},"ssr":{"error":null,"isDataLoaded":false,"isDataLoading":false,"isHydrationFailed":false,"isServer":false},"stories":{"stories":[{"id":"story-590","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F45b\u002F799\u002F86e\u002F45b79986ec96f34a155b11bba319ed84.png","title":"Хабр Карьера","link":"https:\u002F\u002Fu.habr.com\u002FprmWX"},"title":"Менторство в IT","lang":"ru","startTime":"2023-10-06T17:24:00+03:00","finishTime":"2023-10-22T17:24:00+03:00","slides":[{"id":"story-590_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1ef\u002F0aa\u002F928\u002F1ef0aa9286c8638b203681aa110799f5.png","button":null},{"id":"story-590_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa1a\u002F9c4\u002F3c7\u002Fa1a9c43c7da0e2d76855970e15be5e73.png","button":null},{"id":"story-590_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fdc5\u002Fc06\u002F3ca\u002Fdc5c063ca2973e961474f6b765110c98.png","button":null},{"id":"story-590_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4a1\u002Fc7b\u002Fad8\u002F4a1c7bad8af84a38abfa09416eeb5a5c.png","button":{"title":"Узнать больше","link":"https:\u002F\u002Fu.habr.com\u002FprmWX","colorType":"light"}}]},{"id":"story-588","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F41a\u002Fc52\u002F5a8\u002F41ac525a8029b479529b8503d76d9047.png","title":"Хабр","link":null},"title":"Каким был Хабр в сентябре","lang":"ru","startTime":"2023-10-05T10:30:32+03:00","finishTime":"2023-10-11T15:50:32+03:00","slides":[{"id":"story-588_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9fe\u002F263\u002F650\u002F9fe263650210435186a27468e839d5b7.jpg","button":null},{"id":"story-588_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F959\u002F7fd\u002F520\u002F9597fd520792a128d3f0a5f8399aaab3.jpg","button":{"title":"Читать длинный текст","link":"https:\u002F\u002Fu.habr.com\u002Fsept_01","colorType":"light"}},{"id":"story-588_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F196\u002F6ed\u002F16d\u002F1966ed16db086c4deac770f546aeb3f2.jpg","button":{"title":"К статье","link":"https:\u002F\u002Fu.habr.com\u002Fsept_02","colorType":"light"}},{"id":"story-588_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc82\u002Fa27\u002F574\u002Fc82a27574b20c501cbb7fd9a224fac49.jpg","button":{"title":"Заглянуть в комменты","link":"https:\u002F\u002Fu.habr.com\u002Fsept_03","colorType":"light"}},{"id":"story-588_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1d1\u002F0b9\u002Fc31\u002F1d10b9c31d1dfe7e85fcdeee20a223cb.jpg","button":{"title":"Приобщиться","link":"https:\u002F\u002Fu.habr.com\u002Fsept_04","colorType":"light"}},{"id":"story-588_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F2a4\u002F34e\u002F059\u002F2a434e059e65c60e662b76cd893eb63c.jpg","button":{"title":"Тоже посмотреть","link":"https:\u002F\u002Fu.habr.com\u002Fsept_05","colorType":"light"}},{"id":"story-588_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe03\u002F90b\u002F133\u002Fe0390b133eb647be045c3642f460e925.jpg","button":null}]},{"id":"story-586","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F8b0\u002F35e\u002Fe84\u002F8b035ee84c821bb85556a8b89ba9f672.png","title":"Хабр","link":null},"title":"По ту сторону собеседований","lang":"ru","startTime":"2023-10-04T14:10:00+03:00","finishTime":"2023-10-11T14:10:39+03:00","slides":[{"id":"story-586_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F350\u002F1f7\u002Fab0\u002F3501f7ab0f70539f72ad397ea8122ef0.jpg","button":null},{"id":"story-586_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe23\u002F8a8\u002F6f3\u002Fe238a86f32a15604c570ca284ad26e3e.jpg","button":{"title":"Графики и списки","link":"https:\u002F\u002Fu.habr.com\u002Fsbs_01","colorType":"light"}},{"id":"story-586_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F80b\u002Fb54\u002F353\u002F80bb54353c634c1c8d768f6af0d104ca.jpg","button":{"title":"Всего понемногу","link":"https:\u002F\u002Fu.habr.com\u002Fsbs_02","colorType":"light"}},{"id":"story-586_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc14\u002F77e\u002F168\u002Fc1477e1680b319a46d2395a84ef6d1f2.jpg","button":{"title":"Итоги расследования","link":"https:\u002F\u002Fu.habr.com\u002Fsbs_03","colorType":"light"}},{"id":"story-586_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9d7\u002F688\u002Febb\u002F9d7688ebb2263441d0ccd2fc127dc613.jpg","button":{"title":"Взгляд наоборот","link":"https:\u002F\u002Fu.habr.com\u002Fsbs_04","colorType":"dark"}},{"id":"story-586_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F63f\u002F365\u002F9da\u002F63f3659da279130b2b8fe34f2cf36de2.jpg","button":{"title":"Ускориться","link":"https:\u002F\u002Fu.habr.com\u002Fsbs_05","colorType":"light"}},{"id":"story-586_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fc24\u002F06e\u002F414\u002Fc2406e4146c063fd59f1ea1be5e0a857.jpg","button":{"title":"История жизни","link":"https:\u002F\u002Fu.habr.com\u002Fsbs_06","colorType":"light"}},{"id":"story-586_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fcc7\u002F940\u002F74f\u002Fcc794074f387758a0e93249178bf5c2b.jpg","button":{"title":"Анти-топ","link":"https:\u002F\u002Fu.habr.com\u002Fsbs_07","colorType":"light"}}]},{"id":"story-582","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe3c\u002F24c\u002F3d0\u002Fe3c24c3d0b5dac995250df3f74978d73.png","title":"Хабр Карьера","link":"https:\u002F\u002Fu.habr.com\u002F64zR3"},"title":"Битва пет-проектов","lang":"ru","startTime":"2023-10-02T10:12:00+03:00","finishTime":"2023-10-29T10:12:00+03:00","slides":[{"id":"story-582_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F4a6\u002Fe99\u002F23e\u002F4a6e9923e404eef0499c779430af3d18.png","button":{"title":"Подробнее","link":"https:\u002F\u002Fu.habr.com\u002F64zR3","colorType":"light"}},{"id":"story-582_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff74\u002F2ca\u002F5a8\u002Ff742ca5a85f2e6c068e19de292221317.png","button":null},{"id":"story-582_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff95\u002F019\u002F16b\u002Ff9501916bf81d95b1f699e48c9e7f562.png","button":null},{"id":"story-582_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F966\u002Fbdd\u002F415\u002F966bdd4151319973765f9c86577e0456.png","button":{"title":"Следить за битвой","link":"https:\u002F\u002Fu.habr.com\u002F64zR3","colorType":"light"}}]},{"id":"story-580","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa55\u002Faae\u002F1b5\u002Fa55aae1b596e0c38f0764914d2148a41.png","title":"Хабр","link":null},"title":"Лица SmartDev 2023","lang":"ru","startTime":"2023-09-28T08:01:00+03:00","finishTime":"2023-10-08T23:59:00+03:00","slides":[{"id":"story-580_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fbf1\u002Fd90\u002F57b\u002Fbf1d9057b296d0f3e2d00160c0998ac7.jpg","button":null},{"id":"story-580_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F363\u002F4f1\u002Ff13\u002F3634f1f13ab20010261c0e78ad41602d.png","button":{"title":"Развитие DevOps","link":"https:\u002F\u002Fu.habr.com\u002Fsmdv_01","colorType":"dark"}},{"id":"story-580_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F928\u002F71d\u002Fa63\u002F92871da63ccebb2d53e6fbb732ab7910.png","button":{"title":"Грани LLM","link":"https:\u002F\u002Fu.habr.com\u002Fsmdv_02","colorType":"dark"}},{"id":"story-580_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F3a6\u002F823\u002F61c\u002F3a682361c28562a924d4678b6b90a4eb.png","button":{"title":"Мультимодальные ИИ","link":"https:\u002F\u002Fu.habr.com\u002Fsmdv_03","colorType":"dark"}},{"id":"story-580_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F75d\u002Faba\u002F926\u002F75daba92654ba4f698629eb4e4216d71.png","button":{"title":"Смотреть интервью","link":"https:\u002F\u002Fu.habr.com\u002Fsmdv_04","colorType":"dark"}},{"id":"story-580_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Ff57\u002Fd81\u002F1a7\u002Ff57d811a7df706c40cd5ce19cc804c83.png","button":{"title":"На новый рынок","link":"https:\u002F\u002Fu.habr.com\u002Fsmdv_05","colorType":"dark"}},{"id":"story-580_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Faec\u002Fbb7\u002Ff73\u002Faecbb7f73f1a75983c4df5c8d1ef4b26.png","button":{"title":"Антихрупкость","link":"https:\u002F\u002Fu.habr.com\u002Fsmdv_06","colorType":"dark"}},{"id":"story-580_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F9b2\u002F816\u002Feb8\u002F9b2816eb849d048ef5e91aaee7d90759.png","button":{"title":"Внедрение AppSec","link":"https:\u002F\u002Fu.habr.com\u002Fsmdv_07","colorType":"dark"}},{"id":"story-580_9","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F784\u002F602\u002Ffe7\u002F784602fe7cc437c0a794b6a8dec8b08d.png","button":{"title":"Синтетические данные","link":"https:\u002F\u002Fu.habr.com\u002Fsmdv_08","colorType":"dark"}}]},{"id":"story-036","author":{"logo":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fa0c\u002F355\u002F563\u002Fa0c355563809fa85dbc88c1792e60682.png","title":"Хабр","link":"https:\u002F\u002Fu.habr.com\u002FywfBl"},"title":"Почему программисты пишут?","lang":"ru","startTime":"2023-09-25T11:00:00+03:00","finishTime":"2023-10-08T23:59:00+03:00","slides":[{"id":"story-036_1","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F780\u002Fb8c\u002F5cb\u002F780b8c5cb305a046ba9aae5c16eea6aa.jpg","button":null},{"id":"story-036_2","image":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fif\u002Fqz\u002Fc6\u002Fifqzc6m-9o6x0iqo6miwf4oug3m.jpeg","button":null},{"id":"story-036_3","image":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fqc\u002Fog\u002Fva\u002Fqcogvahks1_jii9r3xtkpgin4sq.jpeg","button":null},{"id":"story-036_4","image":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fcd\u002Fcy\u002Fnb\u002Fcdcynb5jekmbcm60qmarzydroli.jpeg","button":null},{"id":"story-036_5","image":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002Fli\u002F7a\u002Fne\u002Fli7anevj8eheziz7bpglee4gyjy.jpeg","button":null},{"id":"story-036_6","image":"https:\u002F\u002Fhabrastorage.org\u002Fwebt\u002F8a\u002Fib\u002Fjh\u002F8aibjh3bsnjoc67lt-vm8eadhus.jpeg","button":null},{"id":"story-036_7","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fddf\u002F87f\u002Faa2\u002Fddf87faa2d7006cd8ebad14cf9ca625c.jpg","button":null},{"id":"story-036_8","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1cc\u002Fb99\u002F7e3\u002F1ccb997e34a625188e24c87d0a39c7f2.jpg","button":null},{"id":"story-036_9","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002Fe4e\u002Ff1b\u002F86a\u002Fe4ef1b86aa9e1e78a4a84c8b7cf9267b.jpg","button":null},{"id":"story-036_10","image":"https:\u002F\u002Fhabrastorage.org\u002Fgetpro\u002Fhabr\u002Fupload_files\u002F1b9\u002Fbd7\u002Fdeb\u002F1b9bd7debdd0b09ab08783502de1a746.jpg","button":{"title":"Узнать все мотивы","link":"https:\u002F\u002Fu.habr.com\u002FywfBl","colorType":"light"}}]}]},"technotext":{"years":[],"technotextDocForNominees":null,"technotextDocForWinners":null,"technotextInfo":{},"technotextInfoLoading":false,"technotextWinners":{},"technotextWinnersLoading":false},"userHubsContribution":{"contributionRefs":{"hubRefs":{},"hubIds":{}}},"userInvites":{"availableInvites":0,"usedInvitesIds":[],"usedInvitesRefs":{},"usedInvitesPagesCount":0,"unusedInvitesIds":[],"unusedInvitesRefs":{},"unusedInvitesPagesCount":0},"userVotes":{"karmaVotesList":[],"karmaVotesPagesCount":null,"karmaVotesListLoading":false,"commentsVotesList":[],"commentsVotesPagesCount":null,"commentsVotesListLoading":false,"postsVotesList":[],"postsVotesPagesCount":null,"postsVotesListLoading":false,"userVotesList":[],"userVotesPagesCount":null,"userVotesListLoading":false},"users":{"authorRefs":{},"authorIds":{},"pagesCount":{},"authorProfiles":{},"userHubs":{},"userInvitations":{},"authorFollowers":{},"authorFollowed":{},"userSpecialization":{},"karmaStats":[],"statistics":null,"isLoading":false,"authorFollowersLoading":false,"authorFollowedLoading":false,"userHubsLoading":false,"userInvitationsLoading":false,"route":{}},"viewport":{"prevScrollY":{},"scrollY":0,"width":0},"tracker":{"notificationsLoading":false,"notificationsList":[],"notificationsPageCount":0,"pendingMarkNotificationsRead":[],"publicationsLoading":true,"publicationsList":[],"publicationsPageCount":0,"pendingDeletePublications":false,"pendingMarkPublicationsRead":false},"events":{"events":[{"id":"events_46","titleHtml":"Битва пет-проектов","startDay":"2023-09-25","finishDay":"2023-11-30","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fq4\u002Fbl\u002Ftl\u002Fq4bltl5nykwetj_aaaauhdaow6u.png","eventUrl":"https:\u002F\u002Fpet-project.habr.com\u002F?utm_source=special&utm_medium=calendar&utm_campaign=pet_project","geo":[],"isOnline":true,"descriptionHtml":"\u003Cp\u003EСобрали две команды стажеров и&#160;джунов, которые будут работать над пет-проектами под кураторством опытных менторов. А&#160;определять победителей, которые получат стажировку в&#160;компании, будете&#160;вы.\u003C\u002Fp\u003E\u003Cp\u003EВнутри много движухи для зрителей: воркшопы по&#160;разработке, разборы резюме, публичные собеседования, Q&#38;A-сессии и&#160;даже чат, где можно найти себе команду и&#160;запилить какой-нибудь крутой пет-проект. \u003C\u002Fp\u003E\u003Cp xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EЕсть отличный бонус для начинающих: будем собирать стажировки и&#160;джуновские вакансии с&#160;рынка для еженедельной рассылки в&#160;рамках битвы. \u003C\u002Fp\u003E\u003Cp xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EРегистрируйтесь, чтобы ничего не&#160;пропустить!\u003C\u002Fp\u003E\u003Cbr \u002F\u003E"},{"id":"events_45","titleHtml":"Joker","startDay":"2023-10-09","finishDay":"2023-10-14","startTime":"16:00","finishTime":"19:30","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fxo\u002Fvw\u002Fd6\u002Fxovwd6picvqcupuizlayrlxiqcq.jpeg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_jkr","geo":["Санкт-Петербург"],"isOnline":true,"descriptionHtml":"\u003Cp\u003EБольшая Java-конференция. 9&#8211;10 октября&#160;&#8212; онлайн часть, 13&#8211;14 октября&#160;&#8212; часть в&#160;Санкт-Петербурге с&#160;возможностью удалённого подключения.\u003C\u002Fp\u003E\u003Cp\u003EВ&#160;программе, как обычно, полезная Java-разработчикам техническая конкретика: инструменты, фреймворки, JVM, языковые нововведения и&#160;не&#160;только.\u003C\u002Fp\u003E\u003Cbr \u002F\u003E"},{"id":"events_55","titleHtml":"Открытый урок «Адаптивная верстка сложных интерфейсов»","startDay":"2023-10-10","finishDay":"2023-10-10","startTime":"20:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002F90\u002Fgm\u002Fmn\u002F90gmmni0i-cteiqeexjhahz7ifo.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_otsflt","geo":[],"isOnline":true,"descriptionHtml":"\u003Cp\u003EНаучитесь создавать адаптивные пользовательские интерфейсы за&nbsp;пару часов.\u003C\u002Fp\u003E\u003Cp\u003EЗанятие пройдёт 10&nbsp;октября в&nbsp;20:00 мск в&nbsp;рамках курса &laquo;Flutter Mobile Developer&raquo; на&nbsp;бесплатном открытом уроке &laquo;Адаптивная верстка сложных интерфейсов&raquo; от&nbsp;OTUS.\u003C\u002Fp\u003E\u003Cp\u003EПеред вами откроются новые профессиональные возможности:\u003C\u002Fp\u003E \u003Cul\u003E\u003Cli\u003EРазберёмся, как создавать адаптивные пользовательские интерфейсы, которые могут эффективно масштабироваться и&nbsp;отображаться на&nbsp;разных устройствах.\u003C\u002Fli\u003E \u003Cli\u003EРассмотрим виджеты CustomMultiChildLayout, CustomSingleChildLayout и&nbsp;FlowDelegate, которые позволяют более гибко управлять размещением и&nbsp;позиционированием дочерних виджетов в&nbsp;основном виджете.\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EПреподаватель: Дмитрий Золотов&nbsp;&mdash; Flutter+Kotlin Developer в&nbsp;Yandex.\u003C\u002Fp\u003E\u003Cp\u003EЭто отличная возможность совершенно бесплатно протестировать формат обучения и&nbsp;задать преподавателю любые вопросы в&nbsp;режиме реального времени. Пройдите бесплатное вступительное тестирование прямо сейчас и&nbsp;зарегистрируйтесь на&nbsp;событие.\u003C\u002Fp\u003E"},{"id":"events_61","titleHtml":"Вебинар «Запускаем сайт на Linux Ubuntu 22.04»","startDay":"2023-10-10","finishDay":"2023-10-10","startTime":"19:00","finishTime":"20:30","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002F_6\u002Fei\u002Ftl\u002F_6eitlnsnpntc7xka1flj0-5gko.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_otuslnx","geo":[],"isOnline":true,"descriptionHtml":"\u003Cp\u003EНа&#160;занятии разберём полный процесс запуска популярной CMS Wordpress на&#160;чистой системе с&#160;Ubuntu&#160;22.04. Установим и&#160;настроим все необходимые компоненты. В&#160;результате получим полнофункциональный сайт\u003C\u002Fp\u003E\u003Cbr \u002F\u003E"},{"id":"events_63","titleHtml":"Вебинар «Обзор основных парадигм программирования и их использование в С#»","startDay":"2023-10-11","finishDay":"2023-10-11","startTime":"20:00","finishTime":"21:30","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fi2\u002Fgy\u002F14\u002Fi2gy14re31zlhk46iu3mysjbvno.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_otuscsh","geo":[],"isOnline":true,"descriptionHtml":"\u003Cp\u003EНа&#160;занятии рассмотрим 5&#160;ключевых программных парадигм в&#160;C#: процедурное, объектно-ориентированное, функциональное, событийное и&#160;компонентно-ориентированное программирование. Мы&#160;рассмотрим основные характеристики каждого подхода, их&#160;преимущества и&#160;недостатки, а&#160;также примеры их&#160;применения на&#160;практике.\u003C\u002Fp\u003E\u003Cp\u003EВ&#160;результате вы&#160;сможете:\u003C\u002Fp\u003E\u003Cul xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cli\u003Eразличать и&#160;понимать ключевые концепции каждой парадигмы;\u003C\u002Fli\u003E\u003Cli\u003Eопределить, какая парадигма лучше всего подходит для решения конкретной задачи;\u003C\u002Fli\u003E\u003Cli\u003Eприменять знания на&#160;практике, выбирая правильный подход при разработке программ на&#160;C#;\u003C\u002Fli\u003E\u003Cli\u003Eоценить преимущества и&#160;недостатки каждого подхода в&#160;различных контекстах разработки.\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cbr \u002F\u003E"},{"id":"events_41","titleHtml":"Deep cloud dive. Первая дискуссионная конференция beeline cloud","startDay":"2023-10-12","finishDay":"2023-10-12","startTime":"11:00","finishTime":"14:10","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fsk\u002Fem\u002Fiu\u002Fskemiuqjpev6azkn-imzs2lxasi.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_blndcd","geo":[],"isOnline":true,"descriptionHtml":"\u003Cp\u003EНа&nbsp;одной площадке встретятся эксперты ведущих компаний рынка, чтобы обсудить тренды, затронуть наболевшие проблемы и&nbsp;наметить пути их&nbsp;решения.\u003C\u002Fp\u003E\u003Cp\u003EТри дискуссионных блока:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003ECloud. Локализация рынка облаков, проблематика отечественных продуктов&nbsp;&mdash; что нас ждет дальше?\u003C\u002Fli\u003E\u003Cli\u003EData. Демократизация ИИ&nbsp;и&nbsp;больших данных: примеры внедрений, перспективы развития\u003C\u002Fli\u003E\u003Cli\u003ESecurity. Кибербезопасность: актуальные угрозы, прогнозы и&nbsp;ожидания на&nbsp;2024 год\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EПрограмма мероприятия:\u003Cbr\u003E11:00&nbsp;&mdash; 11:10 Открытие конференции\u003Cbr\u003E11:10&nbsp;&mdash; 12:00 Локализация в&nbsp;сфере Cloud: миграция в&nbsp;российское облако\u003Cbr\u003E12:50&nbsp;&mdash; 13:20 Большие данные и&nbsp;искусственный интеллект: перспективы развития\u003Cbr\u003E13:20&nbsp;&mdash; 14:10&nbsp;Кибербезопасность, ИТ-аутсорсинг: что нас ждет в&nbsp;2024 году\u003C\u002Fp\u003E\u003Cp\u003EДля кого:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003ECTO и&nbsp;руководители бизнеса\u003C\u002Fli\u003E\u003Cli\u003EИТ- и&nbsp;ИБ-директора, топ-менеджеры\u003C\u002Fli\u003E\u003Cli\u003EАрхитекторы, профильные ИТ-специалисты\u003C\u002Fli\u003E\u003Cli\u003EАналитики данных, дата-инженеры\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EНе&nbsp;пропустите интерактивный диалог о&nbsp;рынке ИТ. Мероприятие бесплатное.\u003C\u002Fp\u003E\u003Cp\u003EРегистрируйтесь и&nbsp;мы&nbsp;пришлем вам ссылку на&nbsp;онлайн-трансляцию.\u003C\u002Fp\u003E"},{"id":"event_34","titleHtml":"Курс «Архитектура программного обеспечения» от Яндекс Практикума","startDay":"2023-10-16","finishDay":"2023-10-16","startTime":"09:00","finishTime":"23:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fjw\u002Fiy\u002Fj2\u002Fjwiyj2kplvp4rn8uiog74md1xes.jpeg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_yprarch","geo":[],"isOnline":true,"descriptionHtml":"\u003Cp\u003EКурс для опытных разработчиков уровня Middle и&nbsp;Senior, которые хотят научиться создавать с&nbsp;нуля архитектуру сервисов и&nbsp;приложений. Вас ждет много практических заданий, прокачка насмотренности в&nbsp;области архитектуры&nbsp;ПО и&nbsp;экспертиза от&nbsp;техлидов Яндекса и&nbsp;других технологических компаний.\u003C\u002Fp\u003E\u003Cp\u003EЧему вы научитесь:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003Eопределять, какую архитектуру приложения применять&nbsp;&mdash; монолитную или микросервисную;\u003C\u002Fli\u003E\u003Cli\u003Eвыбирать тип хранения данных, формат и&nbsp;протокол обмена данными&nbsp;&mdash; в&nbsp;зависимости от&nbsp;типа вашего приложения;\u003C\u002Fli\u003E\u003Cli\u003Eразбираться в&nbsp;вертикальном и&nbsp;горизонтальном масштабировании, балансировке нагрузки и&nbsp;стратегиях кеширования.\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EГлавное про курс:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003Eвозможность повысить свой грейд, а&nbsp;соответственно&nbsp;&mdash; ценность на&nbsp;рынке;\u003C\u002Fli\u003E\u003Cli\u003E+5&nbsp;новых архитектур в&nbsp;портфолио;\u003C\u002Fli\u003E\u003Cli\u003Eнаставничество и&nbsp;код-ревью от&nbsp;экспертов с&nbsp;большим опытом проектирования архитектуры;\u003C\u002Fli\u003E\u003Cli\u003Eпрограмма длительностью 6&nbsp;месяцев: учёбе нужно уделять от&nbsp;15&nbsp;часов в&nbsp;неделю;\u003C\u002Fli\u003E\u003Cli\u003Eподойдёт для разработчиков с&nbsp;опытом коммерческой бэкенд-разработки от&nbsp;2&nbsp;лет.\u003C\u002Fli\u003E\u003C\u002Ful\u003E"},{"id":"events_54","titleHtml":"Открытый урок «Kafka Streams»","startDay":"2023-10-16","finishDay":"2023-10-16","startTime":"10:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Ff0\u002Ffk\u002F7g\u002Ff0fk7gsmss4dhnx_v3mdios0o1a.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_otskfk","geo":[],"isOnline":true,"descriptionHtml":"\u003Cp\u003EДля чего используют Kafka Streams? Она позволяет быстро и&nbsp;просто писать код Java\u002FScala на&nbsp;стороне клиента, при этом разворачивать и&nbsp;использовать распределенное приложение на&nbsp;сервере Kafka в&nbsp;соответствии с&nbsp;DevOps-подходом.\u003C\u002Fp\u003E\u003Cp\u003EИзучите этот инструмент на&nbsp;бесплатном открытом уроке &laquo;Kafka Streams&raquo; от&nbsp;OTUS.\u003C\u002Fp\u003E\u003Cp\u003EВы&nbsp;узнаете: \u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003Eкак создать граф обработчиков с&nbsp;использованием DSL;\u003C\u002Fli\u003E \u003Cli\u003E как читать сообщения из&nbsp;топика;\u003C\u002Fli\u003E \u003Cli\u003E как фильтровать и&nbsp;преобразовывать сообщения;\u003C\u002Fli\u003E \u003Cli\u003E что происходит при изменении ключа;\u003C\u002Fli\u003E \u003Cli\u003E как организовать роутинг сообщений;\u003C\u002Fli\u003E \u003Cli\u003E как работать с&nbsp;состоянием, какие при этом возникают нюансы;\u003C\u002Fli\u003E \u003Cli\u003E как работает join потоков сообщений.\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EЗанятие пройдёт 16&nbsp;октября в&nbsp;20:00 мск в&nbsp;рамках курса &laquo;Apache Kafka&raquo;. Это отличная возможность совершенно бесплатно протестировать формат обучения и&nbsp;задать преподавателю любые вопросы в&nbsp;режиме реального времени.\u003C\u002Fp\u003E\u003Cp\u003EПройдите бесплатное вступительное тестирование прямо сейчас и&nbsp;зарегистрируйтесь на&nbsp;событие.\u003C\u002Fp\u003E"},{"id":"events_60","titleHtml":"Вебинар онлайн-курса «DevOps 1C»","startDay":"2023-10-16","finishDay":"2023-10-16","startTime":"20:00","finishTime":"21:30","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002F-b\u002Fcm\u002F6t\u002F-bcm6tlbmwy1ux3chxa_w5p5sj4.jpeg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_otus1c","geo":[],"isOnline":true,"descriptionHtml":"\u003Cp\u003EНа&nbsp;бесплатном вебинаре &laquo;Переезжаем в&nbsp;EDT из&nbsp;Конфигуратора&raquo; мы&nbsp;обсудим:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003EПочему из&nbsp;Конфигуратора в&nbsp;EDT можно переходить уже сейчас.\u003C\u002Fli\u003E \u003Cli\u003EВозможности, которые в&nbsp;корне изменят ваш процесс разработки.\u003C\u002Fli\u003E \u003Cli\u003EПрактику работы в&nbsp;EDT в&nbsp;Git.\u003C\u002Fli\u003E \u003Cli\u003EУмение эффективно работать с&nbsp;ветками и&nbsp;лаконичное оформление истории своей работы в&nbsp;Git.\u003C\u002Fli\u003E\u003C\u002Ful\u003E \u003Cp\u003EПосле вебинара вы&nbsp;сможете продолжить обучение на&nbsp;курсе по&nbsp;спеццене, в&nbsp;том числе в&nbsp;рассрочку.\u003C\u002Fp\u003E"},{"id":"events_47","titleHtml":"Семинар «Engee – российская платформа для разработки сложных технических систем»","startDay":"2023-10-18","finishDay":"2023-10-18","startTime":"10:00","finishTime":"15:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fax\u002Fek\u002Fha\u002Faxekhakoitd28x3e-yf5xg96nlc.jpeg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_xpn","geo":["Москва"],"isOnline":false,"descriptionHtml":"\u003Cp\u003EEngee&#160;&#8212; самая новая платформа на&#160;российском рынке, предназначенная для разработки сложных технических систем. Она позволяет инженерам и&#160;конструкторам предприятий наукоемкой отрасли создавать качественные и&#160;эффективные продукты в&#160;высокотехнологичном программном окружении.\u003C\u002Fp\u003E\u003Cp\u003EНа&#160;семинаре технические специалисты ЦИТМ Экспонента проведут подробную демонстрацию возможностей нашей среды. Вы&#160;увидите актуальные промышленные возможности использования платформы, узнаете, как работать с&#160;интерактивными скриптами и&#160;с&#160;графическими инструментами для построения динамических моделей.\u003C\u002Fp\u003E\u003Cp xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EНаш семинар будет полезен специалистам, решающим широкий спектр задач, затрагивающих в&#160;своей работе машинное обучение, оптимизацию и&#160;искусственный интеллект, ТАУ, цифровую обработку сигналов, радиосвязь и&#160;многое другое\u003C\u002Fp\u003E\u003Cbr \u002F\u003E"},{"id":"events_56","titleHtml":"Вебинар онлайн-курса «Team Lead разработки»","startDay":"2023-10-18","finishDay":"2023-10-18","startTime":"20:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fqk\u002Fdq\u002Few\u002Fqkdqewxgmbulrf5hbjxe2l-fp-m.jpeg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_otusvbtml","geo":[],"isOnline":true,"descriptionHtml":"\u003Cp\u003EОтпуск... Двухнедельный... Звучит как мечта для многих управленцев. Но&nbsp;почему она так недостижима? Что мешает тимлиду уйти в&nbsp;отпуск? Где внутренние причины, где внешние? Узнайте на&nbsp;бесплатном вебинаре онлайн-курса &laquo;Team Lead разработки&raquo; 18&nbsp;октября в&nbsp;20:00&nbsp;ч мск&nbsp;&mdash; &laquo;Готовь сани летом.. или Почему тимлиду нужно начинать готовить команду к&nbsp;своему отпуску еще с&nbsp;осени&raquo;.\u003C\u002Fp\u003E\u003Cp\u003EНа&nbsp;занятии обсудим:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003EКогда можно уйти в&nbsp;отпуск, а&nbsp;когда всё&nbsp;же не&nbsp;стоит?\u003C\u002Fli\u003E \u003Cli\u003EКак подготовить команду и&nbsp;заказчика к&nbsp;своему отпуску?\u003C\u002Fli\u003E \u003Cli\u003EПочему длительный отпуск важен для руководителя?\u003C\u002Fli\u003E \u003Cli\u003EКак переключаться в&nbsp;режим отдыха?\u003C\u002Fli\u003E \u003Cli\u003EКак включиться в&nbsp;работу после?\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EВебинар будет полезен:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003EНачинающим тимлидам и&nbsp;тем, кто близок к&nbsp;выгоранию.\u003C\u002Fli\u003E \u003Cli\u003EУставшим менеджерам, которых окружают безответственные работники.\u003C\u002Fli\u003E\u003C\u002Ful\u003E"},{"id":"events_51","titleHtml":"Питч-сессия pravo (tech) impulse","startDay":"2023-10-19","finishDay":"2023-10-19","startTime":"15:45","finishTime":"17:30","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002F9n\u002Fcx\u002F0q\u002F9ncx0qfe5ovxbbdywoet7scq5za.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_prt","geo":["Москва"],"isOnline":false,"descriptionHtml":"\u003Cp\u003EКомпания PravoTech — разработчик решений для автоматизации бизнес-процессов, пионер LegalTech в России — запускает конкурс IT-проектов pravo (tech) impulse в рамках форума pravo (tech) — крупнейшего делового события в Европе, посвященного LegalTech и цифровой трансформации юридической функции.\u003C\u002Fp\u003E\u003Cp\u003EУчастники, создающие решения в сферах LegalTech, FinTech (FPM), InsurTech, ITSM, ERP (CRM, HRM), CLM (контрактный менеджмент), могут подать заявки до 4 октября. Организаторы принимают проекты на любой стадии: от идеи с описанием технологии, принципов работы и экономического эффекта до готового продукта с выстроенными продажами.\u003C\u002Fp\u003E\u003Cp\u003EВыбор победителя будет происходить в два этапа: заочный отбор заявок и питч-сессия. Эксперты конкурса будут обращать внимание на новизну идеи, актуальность и перспективность применения технологии в своей сфере.\u003C\u002Fp\u003E\u003Cp\u003EВо время питч-сессии стартапы представят свои идеи и проекты жюри и участникам мероприятия, среди которых руководители юридических департаментов корпораций, директора по трансформации бизнеса и IT, консультанты и интеграторы, LegalOps-специалисты, практикующие юристы.\u003C\u002Fp\u003E\u003Cp\u003EАвторы лучшего проекта гарантированно получат денежный приз, а также — при условии взаимного интереса жюри и самого конкурсанта — возможность для дальнейшего коммерческого сотрудничества с PravoTech. Условия такого взаимодействия будут определены индивидуально.\u003C\u002Fp\u003E\u003Cp\u003EЖюри конкурса: \u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003EАлексей Пелевин, CEO и основатель PravoTech;  \u003C\u002Fli\u003E\u003Cli\u003EКирилл Фадеев, коммерческий директор PravoTech;  \u003C\u002Fli\u003E\u003Cli\u003EИлья Королев, партнер и управляющий портфелем ФРИИ, бизнес-ангел.\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EЗаявку можно подать до&nbsp;10&nbsp;октября в&nbsp;электронном виде на&nbsp;сайте конкурса.&nbsp;13&nbsp;октября организаторы объявят проекты-финалисты, которые представят свои идеи 19&nbsp;октября в&nbsp;рамках форума pravo (tech).\u003C\u002Fp\u003E"},{"id":"events_59","titleHtml":"Вебинар «Разработка бэкенда на Clojure»","startDay":"2023-10-24","finishDay":"2023-10-24","startTime":"20:00","finishTime":"21:30","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fa2\u002Fwg\u002F7a\u002Fa2wg7ai6rwmnjibfydenz0p8bbs.jpeg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_otusbcclj","geo":[],"isOnline":true,"descriptionHtml":"\u003Cp\u003EПринципы, на&nbsp;которых основана концепция чистой архитектуры, хорошо описаны и&nbsp;знакомы многим разработчикам. Уникальность этой концепции заключается в&nbsp;том, что её&nbsp;реализация не&nbsp;привязана к&nbsp;какому-либо языку программирования или набору инструментов в&nbsp;том или ином технологическом стеке.\u003C\u002Fp\u003E\u003Cp\u003E24&nbsp;октября в&nbsp;20:00 мск в&nbsp;течение бесплатного вебинара онлайн-курса &laquo;Clojure Developer&raquo;&nbsp;&mdash; &laquo;Duct и&nbsp;Clean Architecture в&nbsp;Clojure&raquo;&nbsp;&mdash; мы&nbsp;попрактикуемся применять эти принципы с&nbsp;использованием языка программирования Clojure и&nbsp;фреймворка Duct. Познакомимся с&nbsp;его модульной системой, реализуем DI-контейнер, подключим адаптеры во&nbsp;все порты и&nbsp;вообще сделаем все, как дедушка Боб нам завещал.\u003C\u002Fp\u003E\u003Cp\u003EЭкспертизой поделится руководитель программы и&nbsp;практик Сергей Ткаченко (Clojure Software developer&nbsp;\u002F Team Lead).\u003C\u002Fp\u003E"},{"id":"event_31","titleHtml":"Russia Risk Conference 2023 — 19-я конференция по риск-менеджменту","startDay":"2023-10-25","finishDay":"2023-10-26","startTime":"10:00","finishTime":"19:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fhz\u002Ftg\u002F9k\u002Fhztg9k1w_eanhcx-7f184wdouri.jpeg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_rskcnf","geo":["Москва"],"isOnline":true,"descriptionHtml":"\u003Cp\u003E25&ndash;26 октября состоится Russia Risk Conference 2023&nbsp;&mdash; ключевая конференция по&nbsp;управлению рисками в&nbsp;финансовой сфере.\u003C\u002Fp\u003E\u003Cp\u003EПрограмма конференции включает темы:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003EТехнологии искусственного интеллекта в&nbsp;управлении рисками: LLM, применение&nbsp;ML, управление модельным риском, Reject Inference, Muti-head graph attention-сети, Reinforcement Learning\u003C\u002Fli\u003E\u003Cli\u003EОбсуждение макроэкономических трендов, кредитно-денежной и&nbsp;регуляторной политики. Прогнозирование тенденций риска\u003C\u002Fli\u003E\u003Cli\u003EКредитные риски: тенденции в&nbsp;управлении кредитными рисками в&nbsp;новых условиях. Моделирование отклика клиента на&nbsp;действия кредитора. Оптимизация стратегий кредитования\u003C\u002Fli\u003E\u003Cli\u003EКомплексное управление рисками. Блиц-интервью с&nbsp;директорами по&nbsp;рискам страховых, лизинговых, микрофинансовых и&nbsp;других компаний&nbsp;&mdash; представителей финансового сектора\u003C\u002Fli\u003E\u003Cli\u003EОперационные риски и&nbsp;кибербезопасность\u003C\u002Fli\u003E\u003Cli\u003EЦифровые финансовые активы (ЦФА): риски и&nbsp;возможности цифрового рубля\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EДля кого: CRO, топ-менеджеров, курирующих управление рисками, специалистов по&nbsp;мониторингу и&nbsp;валидации рисков, риск-менеджеров и&nbsp;риск-аналитиков, data scientists, экспертов-практиков в&nbsp;области управления кредитными, рыночными и&nbsp;операционными рисками, специалистов управлений количественного анализа и&nbsp;моделирования рисков.\u003C\u002Fp\u003E"},{"id":"events_62","titleHtml":"«Спокойно, договоримся!» — тренинг по переговорам и отношениям с клиентами в B2B","startDay":"2023-11-03","finishDay":"2023-11-04","startTime":"10:00","finishTime":"18:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Ffb\u002F-d\u002F8o\u002Ffb-d8oidhievh0ye-lnmndawdaa.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_hfltr","geo":["Москва"],"isOnline":false,"descriptionHtml":"\u003Cp\u003EПрокачаем навыки переговорщика и&#160;научим, как пересобрать отношения с&#160;клиентами в&#160;B2B. Мы&#160;не&#160;коучи, а&#160;топ-менеджеры с&#160;реальным опытом в&#160;большом бизнесе. За&#160;10+&#160;лет работы мы&#160;научились дружить с&#160;клиентами не&#160;только на&#160;начальном этапе, но&#160;и&#160;развивать зрелые проекты. \u003C\u002Fp\u003E\u003Cp\u003EТренинг будет полезен вам, если:\u003Cem\u003E \u003C\u002Fem\u003E\u003C\u002Fp\u003E\u003Cul xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cli\u003Eвы&#160;отвечаете за&#160;отношения с&#160;клиентами, ведение проектов и&#160;управление людьми;\u003C\u002Fli\u003E\u003Cli\u003Eвы&#160;много и&#160;тесно работаете с&#160;заказчиками&#160;&#8212; внешними и&#160;внутренними;\u003C\u002Fli\u003E\u003Cli\u003Eвы&#160;работаете в&#160;b2b-продажах в&#160;IT.\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EКто проведет: \u003C\u002Fp\u003E\u003Cul xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003E\u003Cli\u003EКонстантин Степанов, исполнительный директор HFLabs. За&#160;три года привлек 14&#160;крупных клиентов.\u003C\u002Fli\u003E\u003Cli\u003EНикита Назаров, технический директор HFLabs. Умеет делать так, чтобы клиент становился постоянным клиентом.\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp xmlns=\"http:\u002F\u002Fwww.w3.org\u002F1999\u002Fxhtml\"\u003EСтань участником закрытого клуба по&#160;переговорам с&#160;разбором личных кейсов и&#160;поддержкой экспертов.\u003C\u002Fp\u003E\u003Cbr \u002F\u003E"},{"id":"events_57","titleHtml":"IT Recruiting – HR Forum 2023","startDay":"2023-11-08","finishDay":"2023-11-10","startTime":"9:00","finishTime":"18:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fu-\u002Fc5\u002Fds\u002Fu-c5dsndgew3qdycfdjbzu7pn94.jpeg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_ithrfrm","geo":["Москва"],"isOnline":false,"descriptionHtml":"\u003Cp\u003EКак выглядит новый ландшафт рынка IT-кадров? Что сейчас в&nbsp;приоритете у&nbsp;востребованных специалистов? Как выстроить систему обучения внутри компании? Как выиграть конкуренцию за&nbsp;кадры у&nbsp;ведущих IT-компаний?\u003C\u002Fp\u003E \u003Cp\u003E8, 9, 10&nbsp;ноября на&nbsp;iT&nbsp;Recruiting Forum 2023 руководители сферы&nbsp;HR из&nbsp;компаний крупного и&nbsp;среднего бизнеса соберутся для обсуждения лучших практик привлечения, адаптации и&nbsp;развития IT-персонала. В&nbsp;течение трех дней эксперты поделятся реальными кейсами, проанализируют ошибки и&nbsp;трудности, возникшие при реализации новых практик, а&nbsp;также представят аудитории алгоритмы решения актуальных задач.\u003C\u002Fp\u003E \u003Cp\u003E8&nbsp;ноября в&nbsp;рамках форума пройдет день мастер-классов, где эксперты помогут на&nbsp;практике отработать ключевые навыки и&nbsp;зарядиться новыми идеями в&nbsp;рамках групповой работы с&nbsp;коллегами.\u003C\u002Fp\u003E"},{"id":"events_49","titleHtml":"Онлайн IT HR-конференция HR42","startDay":"2023-11-17","finishDay":"2023-11-18","startTime":"10:00","finishTime":"14:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fq1\u002Fts\u002Fcv\u002Fq1tscv1wzys8-zdrvnumhwz0ely.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_hr42","geo":[],"isOnline":true,"descriptionHtml":"\u003Cp\u003EHR42&nbsp;&mdash; онлайн-конференция про управление международными и&nbsp;распределенными командами в&nbsp;IT.\u003C\u002Fp\u003E"},{"id":"events_53","titleHtml":"HighLoad++ 2023","startDay":"2023-11-27","finishDay":"2023-11-28","startTime":"9:00","finishTime":"20:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fxo\u002F6u\u002Fw1\u002Fxo6uw1o3hf9y9tsxzq4pvya719y.jpeg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_hld","geo":["Москва"],"isOnline":true,"descriptionHtml":"\u003Cp\u003EHighLoad++ 2023&nbsp;&mdash; юбилейная, 20-я конференция HighLoad++. И&nbsp;это будет больше, чем конференция: 3000&nbsp;участников, 120+&nbsp;спикеров, 11&nbsp;залов, 5+&nbsp;мастер-классов.\u003C\u002Fp\u003E \u003Cp\u003EВ&nbsp;этом году в&nbsp;рамках HighLoad++ 2023 пройдет Golang Conf 2023&nbsp;&mdash; конференция для Go-разработчиков. Поговорим о&nbsp;лучших практиках, технологиях, архитектуре и&nbsp;фреймворках, добавим хардкора. И, конечно, 2&nbsp;дня живого общения с&nbsp;единомышленниками и&nbsp;коллегами, нетворкинг, интересные кейсы, последние новости индустрии и&nbsp;современные подходы в&nbsp;разработке высоконагруженных систем.\u003C\u002Fp\u003E \u003Cp\u003EЖдем вас 27&nbsp;и&nbsp;28&nbsp;ноября в&nbsp;Москве на&nbsp;HighLoad 2023&nbsp;&mdash; мероприятии с&nbsp;самой высокой концентрацией IT- профессионалов страны.\u003C\u002Fp\u003E"},{"id":"events_50","titleHtml":"Курс «Разработка высокоскоростных устройств и систем передачи данных»","startDay":"2023-12-09","finishDay":"2023-12-11","startTime":"10:00","finishTime":"17:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fsc\u002Fie\u002Ffp\u002Fsciefp-fox1b1kyqn9bwa5ll2um.png","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_nish","geo":["Москва"],"isOnline":false,"descriptionHtml":"\u003Cp\u003EНовая Инженерная Школа проводит курс повышения квалификации, рассчитанный на&nbsp;инженеров-схемотехников, а&nbsp;также системных инженеров, занимающихся разработкой высокоскоростных устройств.\u003C\u002Fp\u003E\u003Cp\u003EИзучение курса позволит слушателям осознанно подходить к&nbsp;разработке, используя определенный маршрут проектирования, в&nbsp;частности:\u003C\u002Fp\u003E\u003Cul\u003E\u003Cli\u003Eпонимать сущность высокоскоростных сигналов;\u003C\u002Fli\u003E\u003Cli\u003Eпонимать проблемы и&nbsp;риски, возникающие при разработке высокоскоростных устройств;\u003C\u002Fli\u003E\u003Cli\u003Eпрогнозировать и&nbsp;нивелировать проблемы на&nbsp;этапе эскизной разработки;\u003C\u002Fli\u003E\u003Cli\u003Eанализировать и&nbsp;устранять проблемы на&nbsp;этапе верификации разработанного устройства;\u003C\u002Fli\u003E\u003Cli\u003Eпроверять прототипы с&nbsp;использованием современной измерительной аппаратуры.\u003C\u002Fli\u003E\u003C\u002Ful\u003E\u003Cp\u003EТемы курса:\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003EВведение. История развития проблем целостности сигналов и&nbsp;питания.\u003C\u002Fli\u003E\u003Cli\u003EОсновные положения.\u003C\u002Fli\u003E\u003Cli\u003EИдеальная линия передач.\u003C\u002Fli\u003E\u003Cli\u003EПерекрестные помехи.\u003C\u002Fli\u003E\u003Cli\u003EРеальные проводники.\u003C\u002Fli\u003E\u003Cli\u003EДиэлектрики.\u003C\u002Fli\u003E\u003Cli\u003EОсновы теории цепей.\u003C\u002Fli\u003E\u003Cli\u003EСхемотехника.\u003C\u002Fli\u003E\u003Cli\u003EЭквализация.\u003C\u002Fli\u003E\u003Cli\u003EБюджет.\u003C\u002Fli\u003E\u003Cli\u003EПримеры высокоскоростных интерфейсов.\u003C\u002Fli\u003E\u003Cli\u003EЦелостность питания.\u003C\u002Fli\u003E\u003Cli\u003EИзмерения и&nbsp;моделирование.\u003C\u002Fli\u003E\u003C\u002Fol\u003E"},{"id":"events_58","titleHtml":"Курс «Обеспечение электромагнитной совместимости изделий современной техники»","startDay":"2023-12-18","finishDay":"2023-12-20","startTime":"10:00","finishTime":"17:00","imageUrl":"https:\u002F\u002Fhsto.org\u002Fwebt\u002Fsl\u002Flv\u002Fe0\u002Fsllve0c9tpnoqnc20iidt7p9ue8.jpeg","eventUrl":"https:\u002F\u002Fu.habr.com\u002Fcldr_nsh","geo":["Москва"],"isOnline":false,"descriptionHtml":"\u003Cp\u003EНовая Инженерная Школа проводит курс повышения квалификации, направленный на&nbsp;формирование или совершенствование профессиональных компетенций в&nbsp;области внутрисистемной электромагнитной совместимости (ЭМС) изделий современной техники для конструкторов радиоэлектронных средств (РЭС).\u003C\u002Fp\u003E \u003Cp\u003EНастоящая программа рассчитана на&nbsp;инженерно-технических работников с&nbsp;высшим профессиональным образованием, занимающихся конструкторским и&nbsp;технологическим проектированием радиоэлектронной, электронно-вычислительной аппаратуры, систем автоматики и&nbsp;управления и&nbsp;т.п. различного назначения, а&nbsp;также на&nbsp;руководителей среднего звена проектных организаций.\u003C\u002Fp\u003E \u003Cp\u003EТемы курса:\u003C\u002Fp\u003E\u003Col\u003E\u003Cli\u003EВведение в&nbsp;проблему ЭМС.\u003C\u002Fli\u003E \u003Cli\u003EСертификационные требования ЭМС.\u003C\u002Fli\u003E \u003Cli\u003EСхемотехнические методы обеспечения ЭМС.\u003C\u002Fli\u003E \u003Cli\u003EПомехи в&nbsp;межсоединениях.\u003C\u002Fli\u003E \u003Cli\u003EЭкранирование аппаратуры.\u003C\u002Fli\u003E \u003Cli\u003EМощные электромагнитные воздействия на&nbsp;технические средства и&nbsp;методы защиты.\u003C\u002Fli\u003E \u003Cli\u003EОбеспечение радиационной стойкости современной РЭА.\u003C\u002Fli\u003E\u003C\u002Fol\u003E"}]}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script>
<script src="https://assets.habr.com/habr-web/js/chunk-vendors.62e21544.js" defer></script><script src="https://assets.habr.com/habr-web/js/7298.c8f1d73c.js" defer></script><script src="https://assets.habr.com/habr-web/js/app.5e6fa0f9.js" defer></script>



    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S28W1WC23F"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
    </script>
  
  <script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(24049213, "init", {
      defer:true,
      trackLinks:true,
      accurateTrackBounce:true,
      webvisor:false,
    });
  </script>
  <noscript>
    <div>
      <img src="https://mc.yandex.ru/watch/24049213" style="position:absolute; left:-9999px;" alt="" />
    </div>
  </noscript>
  
    <script type="text/javascript">
      window.addEventListener('load', function () {
        setTimeout(() => {
          const img = new Image();
          img.src = 'https://vk.com/rtrg?p=VK-RTRG-421343-57vKE';
        }, 0);
      });
    </script>
  
<script src="/js/ads.js" onload="window['zhY4i4nJ9K'] = true"></script>
</body>
</html>
